function pace(a){var b=a.behaviorVars.pace.left,c=a.behaviorVars.pace.right;0==a.xvel&&(a.xvel=1,a.yvel=1),a.x>c&&(a.xvel=-1),a.x<b&&(a.xvel=1)}function zpace(a){if(null==a.behaviorVars.zpace){a.behaviorVars.zpace=new Object;var b;b=Math.random()>.5?!0:!1,a.behaviorVars.zpace.away=b,a.behaviorVars.zpace.increment=.01}a.behaviorVars.zpace.away?(a.z+=a.behaviorVars.zpace.increment,a.z>2&&(a.behaviorVars.zpace.away=!1)):(a.z-=a.behaviorVars.zpace.increment,a.z<0&&(a.behaviorVars.zpace.away=!0))}function setRandomTextColor(a){var b=Math.floor(10*Math.random()),c=Math.floor(10*Math.random()),d=Math.floor(10*Math.random());a.color="#"+b+c+d}function cycleThroughTextAlignments(a){switch(null==a.behaviorVars.cycleThroughTextAlignments&&(a.behaviorVars.cycleThroughTextAlignments=new Object,a.behaviorVars.cycleThroughTextAlignments.index=0),a.behaviorVars.cycleThroughTextAlignments.index++,a.behaviorVars.cycleThroughTextAlignments.index){case 0:a.alignment="left";break;case 1:a.alignment="center";break;case 2:a.alignment="right";break;default:a.alignment="left",a.behaviorVars.cycleThroughTextAlignments.index=0}}function cycleThroughTextSizes(a){switch(null==a.behaviorVars.cycleThroughTextSizes&&(a.behaviorVars.cycleThroughTextSizes=new Object,a.behaviorVars.cycleThroughTextSizes.index=0),a.behaviorVars.cycleThroughTextSizes.index++,a.behaviorVars.cycleThroughTextSizes.index){case 0:a.size=8;break;case 1:a.size=10;break;case 2:a.size=12;break;case 3:a.size=18;break;case 4:a.size=24;break;case 4:a.size=36;break;case 5:a.size=48;break;default:a.size=8,a.behaviorVars.cycleThroughTextSizes.index=0}}function cycleThroughTextFonts(a){switch(null==a.behaviorVars.cycleThroughTextFonts&&(a.behaviorVars.cycleThroughTextFonts=new Object,a.behaviorVars.cycleThroughTextFonts.index=0),a.behaviorVars.cycleThroughTextFonts.index++,a.behaviorVars.cycleThroughTextFonts.index){case 0:a.font="";break;case 1:a.font="Verdana";break;case 2:a.font="Hymmnos";break;case 3:a.font="Courier New";break;default:a.font="",a.behaviorVars.cycleThroughTextFonts.index=0}}function applyRandomColorFilter(a){var b=Math.floor(255*Math.random()),c=Math.floor(255*Math.random()),d=Math.floor(255*Math.random());a.applyColorFilter(b,c,d,.5)}function spin(a){a.rotation++}function growAndShrink(a){null==a.behaviorVars.growAndshrink&&(a.behaviorVars.growAndshrink=new Object,a.behaviorVars.growAndshrink.growing=!0),a.behaviorVars.growAndshrink.growing?(a.scaleX+=.02,a.scaleX>2&&(a.behaviorVars.growAndshrink.growing=!1),a.scaleY=a.scaleX):(a.scaleX-=.02,a.scaleX<.05&&(a.behaviorVars.growAndshrink.growing=!0),a.scaleY=a.scaleX)}function poke(a){CANVASMANAGER.mouseMoveEvent.x>a.x-a.width/2&&CANVASMANAGER.mouseMoveEvent.x<a.x+a.width/2&&CANVASMANAGER.mouseMoveEvent.y>a.y-a.height/2&&CANVASMANAGER.mouseMoveEvent.y<a.y+a.height/2&&LOG.write("poked you!",LOG.VERBOSE)}function angularVelUpdate(a){null==a.behaviorVars.angularVelUpdate&&(a.behaviorVars.angularVelUpdate=new Object);var b=a.behaviorVars.angularVelUpdate.angle,c=a.behaviorVars.angularVelUpdate.speed;void 0==b&&(b=360*Math.random(),a.behaviorVars.angularVelUpdate.angle=b),void 0==c&&(c=5,a.behaviorVars.angularVelUpdate.speed=c);for(var d=0,e=0;b>360;)b-=360;for(;0>b;)b+=360;e=b>=0&&180>b?1:-1,d=b>=90&&270>b?-1:1,b>270?(b-=180,b=180-b):b>180?b-=180:b>90&&(b=180-b);var f=b*Math.PI/180;a.xvel=d*c*Math.cos(f),a.yvel=e*c*Math.sin(f),a.x+=a.xvel,a.y+=a.yvel,a.x=Math.round(a.x),a.y=Math.round(a.y),a.rotation=a.behaviorVars.angularVelUpdate.angle}function wanderWithinBoundaries(a){var b=!1,c=!1,d=!1,e=!1;void 0!=a.constraintVars.checkForCrossedBoundaries&&(b=a.constraintVars.checkForCrossedBoundaries.leftBoundaryCrossed,c=a.constraintVars.checkForCrossedBoundaries.rightBoundaryCrossed,d=a.constraintVars.checkForCrossedBoundaries.topBoundaryCrossed,e=a.constraintVars.checkForCrossedBoundaries.bottomBoundaryCrossed);var f=a.behaviorVars.wanderWithinBoundaries.chanceToTurn,g=a.behaviorVars.wanderWithinBoundaries.chanceToAccelerate,h=a.behaviorVars.wanderWithinBoundaries.maxTurnAngle,i=a.behaviorVars.wanderWithinBoundaries.maxTurnFrames,j=a.behaviorVars.wanderWithinBoundaries.maxAcceleration,k=a.behaviorVars.wanderWithinBoundaries.maxAccelerationFrames,l=a.behaviorVars.wanderWithinBoundaries.returnAngle,m=a.behaviorVars.wanderWithinBoundaries.framesToTurn,n=a.behaviorVars.wanderWithinBoundaries.turnAngle,o=a.behaviorVars.wanderWithinBoundaries.framesToAccelerate,p=a.behaviorVars.wanderWithinBoundaries.acceleration;if(b||c||d||e){0!=m&&(m=0,n=0),o=0;for(var q=a.behaviorVars.angularVelUpdate.angle;0>q;)q+=360;for(;q>360;)q-=360;b?q>0&&10>q||q>350&&360>q||(0==n&&(n=q>180?l:-l),a.behaviorVars.angularVelUpdate.angle+=n):c?q>170&&190>q||(0==n&&(n=180>q?l:-l),a.behaviorVars.angularVelUpdate.angle+=n):e?q>260&&280>q||(0==n&&(n=q>90&&270>q?l:-l),a.behaviorVars.angularVelUpdate.angle+=n):d&&(q>80&&100>q||(0==n&&(n=270>q&&q>90?-l:l),a.behaviorVars.angularVelUpdate.angle+=n))}else void 0==m||0==m?Math.random()<f&&(m=Math.ceil(Math.random()*i),n=Math.round(Math.random()*h*2-h)):(m--,a.behaviorVars.angularVelUpdate.angle+=n),void 0==o||0==o?Math.random()<g&&(o=Math.ceil(Math.random()*k),p=Math.round(Math.random()*j*2-j)):(o--,a.behaviorVars.angularVelUpdate.speed+=p,a.behaviorVars.angularVelUpdate.speed<0&&(a.behaviorVars.angularVelUpdate.speed=0));a.behaviorVars.wanderWithinBoundaries.framesToTurn=m,a.behaviorVars.wanderWithinBoundaries.turnAngle=n,a.behaviorVars.wanderWithinBoundaries.framesToAccelerate=o,a.behaviorVars.wanderWithinBoundaries.acceleration=p}function applyRandomSingleColorFilter(a){var b,c,d,e=a.behaviorVars.applyRandomSingleColorFilter.color,f=a.behaviorVars.applyRandomSingleColorFilter.lowerRange,g=a.behaviorVars.applyRandomSingleColorFilter.upperRange,h=Math.random()*(g-f)+f;switch(e){case"red":.5>h?(b=255*h*2,c=0,d=0):(b=255,c=255*(1-h)*2,d=255*(1-h)*2);break;case"green":.5>h?(b=0,c=255*h*2,d=0):(b=255*(1-h)*2,c=255,d=255*(1-h)*2);break;case"blue":.5>h?(b=0,c=0,d=255*h*2):(b=255*(1-h)*2,c=255*(1-h)*2,d=255);break;default:b=255*h,c=255*h,d=255*h}a.setColorFilter(b,c,d),a.removeBehavior(applyRandomSingleColorFilter)}function addRedFilter(a){null==a.behaviorVars.addRedFilter&&(a.behaviorVars.addRedFilter=new Object,a.behaviorVars.addRedFilter.isRed=!1),a.behaviorVars.addRedFilter.isRed?(a.behaviorVars.addRedFilter.isRed=!1,a.resetFilters()):(a.behaviorVars.addRedFilter.isRed=!0,a.setColorFilter(255))}function addMoreRedFilter(a){a.addColorFilter(255,0,0,1)}function resetFilter(a){a.resetFilters()}function toggleRandomFilter(a){null==a.behaviorVars.toggleRandomFilter&&(a.behaviorVars.toggleRandomFilter=new Object,a.behaviorVars.toggleRandomFilter.addFilter=!0),a.behaviorVars.toggleRandomFilter.addFilter?a.addColorFilter(255*Math.random(),255*Math.random(),255*Math.random(),.4):a.resetFilters(),a.behaviorVars.toggleRandomFilter.addFilter=!a.behaviorVars.toggleRandomFilter.addFilter}function addRandomFilter(a){a.resetFilters(),a.addColorFilter(255*Math.random(),255*Math.random(),255*Math.random(),1)}function addRandomFilterToHelper(a){a.children[0].resetFilters(),a.children[0].addColorFilter(255*Math.random(),255*Math.random(),255*Math.random(),.2)}function createButterfly(a,b){if(null==a.behaviorVars.createButterfly&&(a.behaviorVars.createButterfly=new Object,a.behaviorVars.createButterfly.maxButterflies=50,a.behaviorVars.createButterfly.butterflyCount=0),a.behaviorVars.createButterfly.butterflyCount<a.behaviorVars.createButterfly.maxButterflies){var c=new MovieBlock("Butterfly1","Butterfly1","Butterfly2","Butterfly2","Butterfly3","Butterfly3","Butterfly2","Butterfly2");c.addConstraint(checkForCrossedBoundaries,{leftMostX:-CANVASMANAGER.width/2+300,rightMostX:CANVASMANAGER.width/2-200,topMostY:0,bottomMostY:CANVASMANAGER.height/2-200}),c.addBehavior(angularVelUpdate),c.addBehavior(wanderWithinBoundaries,{chanceToTurn:.1,chanceToAccelerate:.05,maxTurnAngle:8,maxTurnFrames:25,maxAcceleration:.1,maxAccelerationFrames:10,returnAngle:4});var d=Math.floor(255*Math.random()),e=Math.floor(255*Math.random()),f=Math.floor(255*Math.random());c.addColorFilter(d,e,f,255),c.addBehavior(zpace),c.addMouseClickReaction(addRandomFilter),c.x=b.x-CANVASMANAGER.width/2,c.y=b.y-CANVASMANAGER.height/2,c.z=2*Math.tan(CANVASMANAGER.fov*(Math.PI/180)/2),a.adoptChild(c),a.behaviorVars.createButterfly.butterflyCount++}}function gravitateToMouse(a){var b={x:CANVASMANAGER.mouseMoveEvent.x,y:CANVASMANAGER.mouseMoveEvent.y},c=b.x-a.globalX(),d=b.y-a.globalY(),e=Math.sqrt(c*c+d*d);0==e&&(e=1e-4),a.xacc=c/e/5,a.yacc=d/e/5,a.xvel+=a.xacc,a.yvel+=a.yacc,a.x+=a.xvel,a.y+=a.yvel}function fleeAndReturn(a){PARAMS.initializeValidation(),a.behaviorVars.fleeAndReturn=PARAMS.validateVariableObject(a.behaviorVars.fleeAndReturn,["fleeDistance","fleeAcc","returnAcc"],[PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],[100,5,2]);var b=a.parent.transformMouseEventToLocalCoordinates(CANVASMANAGER.mouseMoveEvent),c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d);if(0==e&&(e=1e-4),e<a.behaviorVars.fleeAndReturn.fleeDistance)a.xacc=-c/e*a.behaviorVars.fleeAndReturn.fleeAcc,a.yacc=-d/e*a.behaviorVars.fleeAndReturn.fleeAcc,a.xvel+=a.xacc,a.yvel+=a.yacc,a.x+=a.xvel,a.y+=a.yvel;else{var f=a.homeX-a.x,g=a.homeY-a.y,h=Math.sqrt(f*f+g*g);if(0==h&&(h=1e-4),a.xacc=f/h*a.behaviorVars.fleeAndReturn.returnAcc,a.yacc=g/h*a.behaviorVars.fleeAndReturn.returnAcc,a.xvel+=a.xacc,a.yvel+=a.yacc,h>10){var i=1-1/Math.log(h);a.xvel=a.xvel*i,a.yvel=a.yvel*i,a.x+=a.xvel,a.y+=a.yvel}else a.xvel=0,a.yvel=0,a.x=a.homeX,a.y=a.homeY}}function addFleeBehaviors(a){a.shattered||(a.shatter(8),a.addBehavior(unshatterWhenChildrenAreHome,{}),a.addBehaviorToChildren(fleeAndReturn,{}))}function fleeFromMouseIfNear(a){var b=a.parent.transformMouseEventToLocalCoordinates(CANVASMANAGER.mouseMoveEvent),c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d);0==e&&(e=1e-4),100>e&&(a.xacc+=-c/e*.2,a.yacc+=-d/e*.2)}function unshatterWhenChildrenAreHome(a){if(null==a.behaviorVars.unshatterWhenChildrenAreHome&&(a.behaviorVars.unshatterWhenChildrenAreHome=new Object,a.behaviorVars.unshatterWhenChildrenAreHome.hasStarted=!1),a.shattered&&a.behaviorVars.unshatterWhenChildrenAreHome.hasStarted){for(var b=!0,c=0;c<a.children.length;c++)if(a.children[c].x!=a.children[c].homeX||a.children[c].y!=a.children[c].homeY)return void(b=!1);b&&(a.removeBehavior(fleeAndReturn),a.unshatter(),a.behaviorVars.unshatterWhenChildrenAreHome.hasStarted=!1,a.removeBehavior(unshatterWhenChildrenAreHome))}else a.behaviorVars.unshatterWhenChildrenAreHome.hasStarted||(a.behaviorVars.unshatterWhenChildrenAreHome.hasStarted=!0)}function gravitateToHome(a){var b=a.homeX-a.x,c=a.homeY-a.y,d=Math.sqrt(b*b+c*c);0==d&&(d=1e-4),a.xacc+=b/d*.01,a.yacc+=c/d*.01}function returnHomeByLog(a){var b=Math.sqrt((a.homeX-a.x)*(a.homeX-a.x)+(a.homeY-a.y)*(a.homeY-a.y));b>0&&(a.x=a.homeX-(b-2*Math.log(b))*((a.homeX-a.x)/b),a.y=a.homeY-(b-2*Math.log(b))*((a.homeY-a.y)/b))}function returnHomeByFraction(a){null==a.behaviorVars.returnHomeByFraction&&(a.behaviorVars.returnHomeByFraction=new Object,a.behaviorVars.returnHomeByFraction.mag=0,a.behaviorVars.returnHomeByFraction.fraction=0,a.behaviorVars.returnHomeByFraction.decrement=.01,a.behaviorVars.returnHomeByFraction.unitX=1,a.behaviorVars.returnHomeByFraction.unitY=1),0==a.behaviorVars.returnHomeByFraction.fraction&&(a.behaviorVars.returnHomeByFraction.fraction=1,a.behaviorVars.returnHomeByFraction.mag=Math.sqrt((a.homeX-a.x)*(a.homeX-a.x)+(a.homeY-a.y)*(a.homeY-a.y)),0==a.behaviorVars.returnHomeByFraction.mag&&(a.behaviorVars.returnHomeByFraction.mag=.001),a.behaviorVars.returnHomeByFraction.unitX=(a.homeX-a.x)/a.behaviorVars.returnHomeByFraction.mag,a.behaviorVars.returnHomeByFraction.unitY=(a.homeY-a.y)/a.behaviorVars.returnHomeByFraction.mag),a.behaviorVars.returnHomeByFraction.fraction-=a.behaviorVars.returnHomeByFraction.decrement,a.x=a.homeX-a.behaviorVars.returnHomeByFraction.mag*a.behaviorVars.returnHomeByFraction.fraction*a.behaviorVars.returnHomeByFraction.unitX,a.y=a.homeY-a.behaviorVars.returnHomeByFraction.mag*a.behaviorVars.returnHomeByFraction.fraction*a.behaviorVars.returnHomeByFraction.unitY,a.behaviorVars.returnHomeByFraction.fraction<=0&&(a.behaviorVars.returnHomeByFraction.fraction=0,a.removeBehavior("returnHomeByFraction"))}function followMouseThenReturnHome(a){null==a.behaviorVars.followMouseThenReturnHome&&(a.behaviorVars.followMouseThenReturnHome=new Object,a.behaviorVars.followMouseThenReturnHome.count=0,a.behaviorVars.followMouseThenReturnHome.increment=0),0==a.behaviorVars.followMouseThenReturnHome.count?(a.behaviorVars.followMouseThenReturnHome.increment=1,a.removeBehavior(returnHomeByFraction),a.addBehavior(gravitateToMouse)):200==a.behaviorVars.followMouseThenReturnHome.count&&(a.behaviorVars.followMouseThenReturnHome.increment=-1,a.addBehavior(returnHomeByFraction),a.removeBehavior(gravitateToMouse)),a.behaviorVars.followMouseThenReturnHome.count+=a.behaviorVars.followMouseThenReturnHome.increment}function togglePause(a){a.isPlaying=!a.isPlaying}function startMovingLeft(a){null==a.behaviorVars.startMovingLeft&&(a.behaviorVars.startMovingLeft=new Object,a.behaviorVars.startMovingLeft.speed=5),a.xvel=-a.behaviorVars.startMovingLeft.speed}function stopMoving(a){a.xvel=0,a.yvel=0}function startMovingRight(a){null==a.behaviorVars.startMovingRight&&(a.behaviorVars.startMovingRight=new Object,a.behaviorVars.startMovingRight.speed=5),a.xvel=a.behaviorVars.startMovingRight.speed}function applyForceLeft(a){LOG.write("Applying Left Force",LOG.INFO),null==a.behaviorVars.applyForceLeft&&(a.behaviorVars.applyForceLeft=new Object,a.behaviorVars.applyForceLeft.force=2),a.xacc+=-a.behaviorVars.applyForceLeft.force}function removeForceLeft(a){LOG.write("Removing Left Force",LOG.INFO),null==a.behaviorVars.removeForceLeft&&(a.behaviorVars.removeForceLeft=new Object,a.behaviorVars.removeForceLeft.force=2),a.xacc-=-a.behaviorVars.removeForceLeft.force}function stopForces(a){LOG.write("Stopping Forces",LOG.INFO),a.xacc=0,a.yacc=0,a.zacc=0}function applyForceRight(a){LOG.write("Applying Right Force",LOG.INFO),null==a.behaviorVars.applyForceRight&&(a.behaviorVars.applyForceRight=new Object,a.behaviorVars.applyForceRight.force=2),a.xacc+=a.behaviorVars.applyForceRight.force}function removeForceRight(a){LOG.write("Stopping Right Force",LOG.INFO),null==a.behaviorVars.removeForceRight&&(a.behaviorVars.removeForceRight=new Object,a.behaviorVars.removeForceRight.force=2),a.xacc-=a.behaviorVars.removeForceRight.force}function applyForceToward(a){LOG.write("Applying Toward Force",LOG.INFO),null==a.behaviorVars.applyForceToward&&(a.behaviorVars.applyForceToward=new Object,a.behaviorVars.applyForceToward.force=.01),a.zacc+=-a.behaviorVars.applyForceToward.force}function removeForceToward(a){LOG.write("Stopping Toward Force",LOG.INFO),null==a.behaviorVars.removeForceToward&&(a.behaviorVars.removeForceToward=new Object,a.behaviorVars.removeForceToward.force=.01),a.zacc-=-a.behaviorVars.removeForceToward.force}function applyForceAway(a){LOG.write("Applying Away Force",LOG.INFO),null==a.behaviorVars.applyForceAway&&(a.behaviorVars.applyForceAway=new Object,a.behaviorVars.applyForceAway.force=.01),a.zacc+=a.behaviorVars.applyForceAway.force}function removeForceAway(a){LOG.write("Stopping Away Force",LOG.INFO),null==a.behaviorVars.removeForceAway&&(a.behaviorVars.removeForceAway=new Object,a.behaviorVars.removeForceAway.force=.01),a.zacc-=a.behaviorVars.removeForceAway.force}function applyForceCW(a){LOG.write("Applying CW Force",LOG.INFO),null==a.behaviorVars.applyForceCW&&(a.behaviorVars.applyForceCW=new Object,a.behaviorVars.applyForceCW.force=1),a.rotationAcc+=a.behaviorVars.applyForceCW.force}function removeForceCW(a){LOG.write("Applying CW Force",LOG.INFO),null==a.behaviorVars.removeForceCW&&(a.behaviorVars.removeForceCW=new Object,a.behaviorVars.removeForceCW.force=1),a.rotationAcc-=a.behaviorVars.removeForceCW.force}function applyForceCCW(a){LOG.write("Applying CCW Force",LOG.INFO),null==a.behaviorVars.applyForceCCW&&(a.behaviorVars.applyForceCCW=new Object,a.behaviorVars.applyForceCCW.force=1),a.rotationAcc-=a.behaviorVars.applyForceCCW.force}function removeForceCCW(a){LOG.write("Applying CCW Force",LOG.INFO),null==a.behaviorVars.removeForceCCW&&(a.behaviorVars.removeForceCCW=new Object,a.behaviorVars.removeForceCCW.force=1),a.rotationAcc+=a.behaviorVars.removeForceCCW.force}function playBirdLeft(a){LOG.write("NowPlaying: BirdLeft"),a.play("BirdLeft")}function playBirdRight(a){LOG.write("NowPlaying: BirdRight"),a.play("BirdRight")}function playHelperLeft(a){a.children[0].play("Walk_Left"),a.children[1].play("Walk_Left")}function playHelperRight(a){a.children[0].play("Walk_Right"),a.children[1].play("Walk_Right")}function helper_ManageState(a){PARAMS.initializeValidation(),a.behaviorVars.helper_ManageState=PARAMS.validateVariableObject(a.behaviorVars.helper_ManageState,["state","previousState"],[PARAMS.STRING,PARAMS.STRING],["Idle1_Left",""]),a.behaviorVars.helper_ManageState.previousState=a.behaviorVars.helper_ManageState.state;var b=a.behaviorVars.helper_ManageState.previousState;switch(b){case"Idle1_Right":case"Idle2_Right":case"Idle3_Right":0!=a.xvel?(a.xvel>0&&(a.behaviorVars.helper_ManageState.state="Walk_Right"),a.xvel<0&&(a.behaviorVars.helper_ManageState.state="Walk_Left")):(0!=a.yvel||0!=a.zvel)&&(a.behaviorVars.helper_ManageState.state="Walk_Right");break;case"Idle1_Left":case"Idle2_Left":case"Idle3_Left":0!=a.xvel?(a.xvel>0&&(a.behaviorVars.helper_ManageState.state="Walk_Right"),a.xvel<0&&(a.behaviorVars.helper_ManageState.state="Walk_Left")):(0!=a.yvel||0!=a.zvel)&&(a.behaviorVars.helper_ManageState.state="Walk_Left");break;case"Walk_Right":0==a.xvel&&0==a.yvel&&0==a.zvel&&(a.behaviorVars.helper_ManageState.state="Idle1_Right");break;case"Walk_Left":0==a.xvel&&0==a.yvel&&0==a.zvel&&(a.behaviorVars.helper_ManageState.state="Idle1_Left")}}function helper_ApplyState(a){PARAMS.initializeValidation(),a.behaviorVars.helper_ApplyState=PARAMS.validateVariableObject(a.behaviorVars.helper_ApplyState,["stateTransitions"],[PARAMS.OBJECT],[{Idle1_Left:[["Idle1_Left","Idle1_Left",200],["Idle1ToIdle1_Left","Idle1_Left",30],["Idle1ToIdle2_Left","Idle2_Left",20],["Idle1ToIdle3_Left","Idle3_Left",20]],Idle2_Left:[["Idle2_Left","Idle2_Left",200],["Idle2ToIdle1_Left","Idle1_Left",20],["Idle2ToIdle3_Left","Idle3_Left",20]],Idle3_Left:[["Idle3_Left","Idle3_Left",200],["Idle3ToIdle2_Left","Idle2_Left",20],["Idle3ToIdle1_Left","Idle1_Left",20]],Idle1_Right:[["Idle1_Right","Idle1_Right",200],["Idle1ToIdle1_Right","Idle1_Right",30],["Idle1ToIdle2_Right","Idle2_Right",20],["Idle1ToIdle3_Right","Idle3_Right",30]],Idle2_Right:[["Idle2_Right","Idle2_Right",200],["Idle2ToIdle1_Right","Idle1_Right",20],["Idle2ToIdle3_Right","Idle3_Right",20]],Idle3_Right:[["Idle3_Right","Idle3_Right",200],["Idle3ToIdle2_Right","Idle2_Right",20],["Idle3ToIdle1_Right","Idle1_Right",20]],Walk_Left:[["Walk_Left","Walk_Left",50]],Walk_Right:[["Walk_Right","Walk_Right",50]]}]);var b=a.behaviorVars.helper_ManageState.previousState,c=a.behaviorVars.helper_ManageState.state;if(b==c){if(a.children[0].isLastMovieFrame()){for(var d=0,e=[],f=0;f<a.behaviorVars.helper_ApplyState.stateTransitions[c].length;f++)d+=a.behaviorVars.helper_ApplyState.stateTransitions[c][f][2],e[f]=d;for(var g=Math.floor(Math.random()*d),h=0,i=0;i<e.length;i++)if(g<e[i]){h=i;break}var j=a.behaviorVars.helper_ApplyState.stateTransitions[c][h][0],k=a.behaviorVars.helper_ApplyState.stateTransitions[c][h][1];a.behaviorVars.helper_ManageState.state=k,a.children[0].play(j),a.children[1].play(j)}}else a.children[0].play(c),a.children[1].play(c)}function simplePhysicsUpdate(a){a.xvel+=a.xacc,a.yvel+=a.yacc,a.zvel+=a.zacc,a.x+=a.xvel,a.y+=a.yvel,a.z+=a.zvel,a.rotationVel+=a.rotationAcc,a.rotation+=a.rotationVel}function forcefulPhysicsUpdate(a){a.xvel+=a.xacc,a.yvel+=a.yacc,a.zvel+=a.zacc,a.x+=a.xvel,a.y+=a.yvel,a.z+=a.zvel,a.rotationVel+=a.rotationAcc,a.rotation+=a.rotationVel,a.xacc=0,a.yacc=0}function playStageClear(){var a=CANVASMANAGER.getAudioAsset("StageClear");a.play(!0)}function playBossStageClear(){var a=CANVASMANAGER.getAudioAsset("BossStageClear");a.play(!0)}function pauseStageClear(){var a=CANVASMANAGER.getAudioAsset("StageClear");a.pause()}function decreaseStageClearVolume(){var a=CANVASMANAGER.getAudioAsset("StageClear"),b=a.getVolume();LOG.write("Old Volume: "+b),a.setVolume(b-10),LOG.write("New Volume: "+a.getVolume())}function increaseStageClearVolume(){var a=CANVASMANAGER.getAudioAsset("StageClear"),b=a.getVolume();LOG.write("Old Volume: "+b),a.setVolume(b+10),LOG.write("New Volume: "+a.getVolume())}function toggleTypeable(a){null==a.behaviorVars.toggleTypeable&&(a.behaviorVars.toggleTypeable=new Object,a.behaviorVars.toggleTypeable.typeable=!1),a.behaviorVars.toggleTypeable.typeable=a.behaviorVars.toggleTypeable.typeable?!1:!0}function typeIntoObject(a,b){null!=a.behaviorVars.toggleTypeable&&a.behaviorVars.toggleTypeable.typeable&&(KEYCODES.isKeyCodeAlphabetic(b.lastKeyCodePress)?a.setText(a.text+b.lastKeyNamePress):b.lastKeyCodePress==KEYCODES.SPACE?a.setText(a.text+" "):b.lastKeyCodePress==KEYCODES.BACKSPACE&&a.text.length>0&&a.setText(a.text.slice(0,a.text.length-1)))}function toggleObjectSleepState(a){a.awake?a.sleep():(a.wake(),a.xacc=0,a.yacc=0,a.zacc=0),a.isPlaying=!a.isPlaying}function toggleVideoObjectSleepState(a){a.awake?a.sleep():(a.wake(),a.xacc=0,a.yacc=0,a.zacc=0),a.isPlaying=!a.isPlaying}function moveObjectInTime(a,b){b.lastKeyCodePress==KEYCODES.TWO&&(a.recallEarlierMemory(),a.recallEarlierMemory()),b.lastKeyCodePress==KEYCODES.THREE&&(a.recallLaterMemory(),a.recallLaterMemory())}function moveVideoObjectInTime(a,b){b.lastKeyCodePress==KEYCODES.TWO&&a.recallEarlierMemory(),b.lastKeyCodePress==KEYCODES.THREE&&a.recallLaterMemory()}function setVolumeBasedOnZ(a){var b=100-5*a.globalZ();a.setVolume(b)}function toggleObjectDebugDisplay(a){a.toggleDebugDisplay(!1)}function playBlock(a){a.play()}function pauseBlock(a){a.pause()}function unpauseBlock(a){a.unpause()}function playPauseBlock(a){a.playPause()}function stopBlock(a){a.stop()}function toggleFontSize(a){null==a.behaviorVars.toggleFontSize&&(a.behaviorVars.toggleFontSize=new Object,a.behaviorVars.toggleFontSize.isBig=!1,a.behaviorVars.toggleFontSize.initSize=a.size),a.size=a.behaviorVars.toggleFontSize.isBig?a.behaviorVars.toggleFontSize.initSize:60,a.behaviorVars.toggleFontSize.isBig=!a.behaviorVars.toggleFontSize.isBig}function toggleCircleDrawingCommand(a){PARAMS.initializeValidation(),a.behaviorVars.toggleCircleDrawingCommand=PARAMS.validateVariableObject(a.behaviorVars.toggleCircleDrawingCommand,["originalCommands","isCircleAdded"],[PARAMS.ARRAYOFOBJECT,PARAMS.BOOLEAN],[a.getDrawingCommands(),!1]),a.behaviorVars.toggleCircleDrawingCommand.isCircleAdded?(a.clearDrawingCommands(),a.setDrawingCommands(a.behaviorVars.toggleCircleDrawingCommand.originalCommands)):(a.addDrawingCommand("setFillStyle",["rgba(50,100,255,1)"]),a.addDrawingCommand("beginPath"),a.addDrawingCommand("arc",[75,75,50,0,2*Math.PI]),a.addDrawingCommand("closePath"),a.addDrawingCommand("fill")),a.behaviorVars.toggleCircleDrawingCommand.isCircleAdded=!a.behaviorVars.toggleCircleDrawingCommand.isCircleAdded}function rotate90Degrees(a){a.rotation+=90}function bounceOffBoundaries(a){var b=a.constraintVars.bounceOffBoundaries.leftedge-a.width/2,c=a.constraintVars.bounceOffBoundaries.rightedge+a.width/2,d=a.constraintVars.bounceOffBoundaries.topedge+a.height/2,e=a.constraintVars.bounceOffBoundaries.bottomedge-a.height/2;a.x<b&&(a.x=b,a.xvel=-1*a.xvel),a.x>c&&(a.x=c,a.xvel=-1*a.xvel),a.y<d&&(a.y=d,a.yvel=-1*a.yvel),a.y>e&&(a.y=e,a.yvel=-1*a.yvel)}function checkForCrossedBoundaries(a){var b=a.constraintVars.checkForCrossedBoundaries.leftMostX-a.width/2,c=a.constraintVars.checkForCrossedBoundaries.rightMostX+a.width/2,d=a.constraintVars.checkForCrossedBoundaries.topMostY+a.height/2,e=a.constraintVars.checkForCrossedBoundaries.bottomMostY-a.width/2,f=!1,g=!1,h=!1,i=!1;a.x<b&&(f=!0),a.x>c&&(g=!0),a.y<d&&(h=!0),a.y>e&&(i=!0),a.constraintVars.checkForCrossedBoundaries.leftBoundaryCrossed=f,a.constraintVars.checkForCrossedBoundaries.rightBoundaryCrossed=g,a.constraintVars.checkForCrossedBoundaries.topBoundaryCrossed=h,a.constraintVars.checkForCrossedBoundaries.bottomBoundaryCrossed=i}function dampVelocity(a){null==a.behaviorVars.dampVelocity&&(a.behaviorVars.dampVelocity=new Object,a.behaviorVars.dampVelocity.damper=.2),0==a.xacc&&0!=a.xvel&&(a.xvel*=1-a.behaviorVars.dampVelocity.damper,Math.abs(a.xvel)<1&&(a.xvel=0)),0==a.yacc&&0!=a.yvel&&(a.yvel*=1-a.behaviorVars.dampVelocity.damper,Math.abs(a.yvel)<1&&(a.yvel=0)),0==a.zacc&&0!=a.zvel&&(a.zvel*=1-a.behaviorVars.dampVelocity.damper,Math.abs(a.zvel)<.001&&(a.zvel=0))}function limitVelocityToHome(a){if(Math.abs(a.xvel)>0||Math.abs(a.yvel)>0){var b=a.homeX-a.x,c=a.homeY-a.y,d=Math.sqrt(b*b+c*c);if(0==d&&(d=1e-4),d>1){var e=1-1/d;a.xvel=a.xvel*e,a.yvel=a.yvel*e}else a.xvel=0,a.yvel=0,a.x=0,a.y=0}}function stopIfNearHome(a){var b=a.homeX-a.x,c=a.homeY-a.y,d=Math.sqrt(b*b+c*c);0==d&&(d=1e-4),1>d&&(a.xacc=0,a.yacc=0,a.xvel=0,a.yvel=0,a.x=a.homeX,a.y=a.homeY)}function forcefulPhysicsConstraint(a){a.xacc=0,a.yacc=0,a.zacc=0}var Log=function(){this.logThreshold=0,this.displayObjects=!1,this.displayBlocks=!1,this.VERBOSE=0,this.INFO=1,this.WARN=2,this.ERROR=3,this.FATAL=4,this.NONE=999};Log.prototype.setLogThreshold=function(a){switch(a){case this.VERBOSE:case this.INFO:case this.WARN:case this.ERROR:case this.FATAL:case this.NONE:this.logThreshold=a;break;default:this.logThreshold=this.VERBOSE}},Log.prototype.setDisplayObjects=function(a){this.displayObjects=a},Log.prototype.setDisplayBlocks=function(a){this.displayBlocks=a},Log.prototype.write=function(a,b){var c=this.VERBOSE,d="";switch(b){case this.VERBOSE:c=b,d+="VERBOSE: ";break;case this.INFO:c=b,d+="INFO: ";break;case this.WARN:c=b,d+="WARN: ";break;case this.ERROR:c=b,d+="ERROR: ";break;case this.FATAL:c=b,d+="FATAL: "}c>=this.logThreshold&&console.log(d+a)},Log.prototype.writeObject=function(a,b){if(this.displayObjects){var c=this.VERBOSE,d="";switch(b){case this.VERBOSE:c=b,d+="VERBOSE: ";break;case this.INFO:c=b,d+="INFO: ";break;case this.WARN:c=b,d+="WARN: ";break;case this.ERROR:c=b,d+="ERROR: ";break;case this.FATAL:c=b,d+="FATAL: "}c>=this.logThreshold&&console.log(a)}},Log.prototype.writeBlock=function(a,b,c){if(this.displayBlocks){var d=this.VERBOSE,e="";switch(b){case this.VERBOSE:d=b,e+="VERBOSE: ";break;case this.INFO:d=b,e+="INFO: ";break;case this.WARN:d=b,e+="WARN: ";break;case this.ERROR:d=b,e+="ERROR: ";break;case this.FATAL:d=b,e+="FATAL: "}d>=this.logThreshold&&(void 0==c?console.log(a):a.identity==c&&console.log(a))}};var LOG=new Log,KeyCodes=function(){this.A=65,this.B=66,this.C=67,this.D=68,this.E=69,this.F=70,this.G=71,this.H=72,this.I=73,this.J=74,this.K=75,this.L=76,this.M=77,this.N=78,this.O=79,this.P=80,this.Q=81,this.R=82,this.S=83,this.T=84,this.U=85,this.V=86,this.W=87,this.X=88,this.Y=89,this.Z=90,this.uppercaseKeyCodes=[this.A,this.B,this.C,this.D,this.E,this.F,this.G,this.H,this.I,this.J,this.K,this.L,this.M,this.N,this.O,this.P,this.Q,this.R,this.S,this.T,this.U,this.V,this.W,this.X,this.Y,this.Z],this.a=97,this.b=98,this.c=99,this.d=100,this.e=101,this.f=102,this.g=103,this.h=104,this.i=105,this.j=106,this.k=107,this.l=108,this.m=109,this.n=110,this.o=111,this.p=112,this.q=113,this.r=114,this.s=115,this.t=116,this.u=117,this.v=118,this.w=119,this.x=120,this.y=121,this.z=122,this.lowercaseKeyCodes=[this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p,this.q,this.r,this.s,this.t,this.u,this.v,this.w,this.x,this.y,this.z],this.ZERO=48,this.ONE=49,this.TWO=50,this.THREE=51,this.FOUR=52,this.FIVE=53,this.SIX=54,this.SEVEN=55,this.EIGHT=56,this.NINE=57,this.numericKeyCodes=[this.ZERO,this.ONE,this.TWO,this.THREE,this.FOUR,this.FIVE,this.SIX,this.SEVEN,this.EIGHT,this.NINE],this.SPACE=32,this.ENTER=13,this.BACKSPACE=8,this.SHIFT=16,this.specialKeyCodes=[this.SPACE,this.ENTER,this.BACKSPACE,this.SHIFT],this.LEFT=37,this.UP=38,this.RIGHT=39,this.DOWN=40,this.arrowKeyCodes=[this.LEFT,this.UP,this.RIGHT,this.DOWN],this.ANYKEY=999};KeyCodes.prototype.getKeyCodeFromString=function(a){var b=this[a];return void 0==b&&(b=0),b},KeyCodes.prototype.getKeyCodesFromString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a.charAt(c);return b},KeyCodes.prototype.getStringFromKeyCode=function(a){for(var b in this)if(this[b]==a)return b;return""},KeyCodes.prototype.getStringFromKeyCodes=function(a){var b="";a.sort();for(var c=new Array,d=0;d<a.length;d++)-1==c.indexOf(a[d])&&(c.push(a[d]),b+=this.getStringFromKeyCode(a[d]));return b},KeyCodes.prototype.isKeyCodeUppercase=function(a){for(var b=0;b<this.uppercaseKeyCodes.length;b++)if(this.uppercaseKeyCodes[b]==a)return!0;return!1},KeyCodes.prototype.isKeyCodeLowercase=function(a){for(var b=0;b<this.lowercaseKeyCodes.length;b++)if(this.lowercaseKeyCodes[b]==a)return!0;return!1},KeyCodes.prototype.isKeyCodeAlphabetic=function(a){return this.isKeyCodeUppercase(a)||this.isKeyCodeLowercase(a)},KeyCodes.prototype.isKeyCodeNumeric=function(a){for(var b=0;b<this.numericKeyCodes.length;b++)if(this.numericKeyCodes[b]==a)return!0;return!1},KeyCodes.prototype.isKeyCodeSpecial=function(a){for(var b=0;b<this.specialKeyCodes.length;b++)if(this.specialKeyCodes[b]==a)return!0;return!1},KeyCodes.prototype.isKeyCodeArrow=function(a){for(var b=0;b<this.arrowKeyCodes.length;b++)if(this.arrowKeyCodes[b]==a)return!0;return!1};var KEYCODES=new KeyCodes,Common=function(){};Common.prototype.getFunctionName=function(a){var b=String(a),c=b.indexOf(" ")+1,d=b.indexOf("(");return b.substring(c,d)},Common.prototype.copyArray=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b},Common.prototype.extend=function(a,b){for(var c in a)b[c]=a[c]},Common.prototype.extendInternalProperties=function(a,b){for(var c in a)"_"!=c.charAt(0)&&(a[c]instanceof Function||"function"==typeof a[c])||(b[c]=a[c])};var COMMON=new Common,TextHelper=function(){this.span=document.createElement("span"),this.block=document.createElement("div"),this.block.style.display="inline-block",this.block.width="1px",this.block.height="0px",this.div=document.createElement("div"),this.div.appendChild(this.span),this.div.appendChild(this.block),this.div.style.display="none"};TextHelper.prototype.measureTextHeight=function(a,b,c){this.div.parentNode!=document.body&&document.body.appendChild(this.div),this.div.style.display="inline",this.span.style.font=c+"px "+b,this.span.textContent=a;var d={};try{this.block.style.verticalAlign="baseline",d.ascent=this.block.offsetTop-this.span.offsetTop,this.block.style.verticalAlign="bottom",d.height=this.block.offsetTop-this.span.offsetTop,d.descent=d.height-d.ascent}finally{this.div.style.display="none"}return d};var TEXTHELPER=new TextHelper,Matrix=function(){this.transformations=new Array,this.result={x:0,y:0,z:0}};Matrix.prototype.addTranslation=function(a,b){var c=new Object;c.r0c0=1,c.r0c1=0,c.r0c2=a,c.r1c0=0,c.r1c1=1,c.r1c2=b,c.r2c0=0,c.r2c1=0,c.r2c2=1,this.transformations.push(c)},Matrix.prototype.addScale=function(a,b){var c=new Object;c.r0c0=a,c.r0c1=0,c.r0c2=0,c.r1c0=0,c.r1c1=b,c.r1c2=0,c.r2c0=0,c.r2c1=0,c.r2c2=1,this.transformations.push(c)},Matrix.prototype.addRotation=function(a){var b=a*Math.PI/180,c=new Object;c.r0c0=Math.cos(b),c.r0c1=-Math.sin(b),c.r0c2=0,c.r1c0=Math.sin(b),c.r1c1=Math.cos(b),c.r1c2=0,c.r2c0=0,c.r2c1=0,c.r2c2=1,this.transformations.push(c)},Matrix.prototype.clearTransformations=function(){this.transformations.splice(0,this.transformations.length)},Matrix.prototype.applyTransformation=function(a,b){for(var c,d=this.transformations.pop();this.transformations.length>0;){c=this.transformations.pop();var e=d.r0c0*c.r0c0+d.r0c1*c.r1c0+d.r0c2*c.r2c0,f=d.r0c0*c.r0c1+d.r0c1*c.r1c1+d.r0c2*c.r2c1,g=d.r0c0*c.r0c2+d.r0c1*c.r1c2+d.r0c2*c.r2c2,h=d.r1c0*c.r0c0+d.r1c1*c.r1c0+d.r1c2*c.r2c0,i=d.r1c0*c.r0c1+d.r1c1*c.r1c1+d.r1c2*c.r2c1,j=d.r1c0*c.r0c2+d.r1c1*c.r1c2+d.r1c2*c.r2c2,k=d.r2c0*c.r0c0+d.r2c1*c.r1c0+d.r2c2*c.r2c0,l=d.r2c0*c.r0c1+d.r2c1*c.r1c1+d.r2c2*c.r2c1,m=d.r2c0*c.r0c2+d.r2c1*c.r1c2+d.r2c2*c.r2c2;
d.r0c0=e,d.r0c1=f,d.r0c2=g,d.r1c0=h,d.r1c1=i,d.r1c2=j,d.r2c0=k,d.r2c1=l,d.r2c2=m}return this.transformations.push(d),this.result.x=a*d.r0c0+b*d.r0c1+1*d.r0c2,this.result.y=a*d.r1c0+b*d.r1c1+1*d.r1c2,this.result.z=a*d.r2c0+b*d.r2c1+1*d.r2c2,{x:this.result.x,y:this.result.y,z:this.result.z}},Matrix.prototype.debugApplyTransformation=function(a,b){var c,d,e,f=this.transformations.shift();for(c=a*f.r0c0+b*f.r0c1+1*f.r0c2,d=a*f.r1c0+b*f.r1c1+1*f.r1c2,e=a*f.r2c0+b*f.r2c1+1*f.r2c2,oldX=c,oldY=d,oldZ=e;this.transformations.length>0;)f=this.transformations.shift(),c=oldX*f.r0c0+oldY*f.r0c1+1*f.r0c2,d=oldX*f.r1c0+oldY*f.r1c1+1*f.r1c2,e=oldX*f.r2c0+oldY*f.r2c1+1*f.r2c2,oldX=c,oldY=d,oldZ=e;return{x:c,y:d,z:e}};var MATRIX=new Matrix,Params=function(){this.NONE=-1,this.BOOLEAN=0,this.UNSIGNEDINTEGER=1,this.INTEGER=2,this.NUMBER=3,this.STRING=4,this.FUNCTION=5,this.OBJECT=6,this.CANVAS2DCONTEXT=7,this.TRAITS=8,this.MEMORY=9,this.MATRIX=10,this.EVENT=11,this.BLOCKEVENT=12,this.MOUSEEVENT=13,this.KEYBOARDEVENT=14,this.CANVASFRAME=15,this.BLOCK=20,this.ACTORBLOCK=21,this.PLAYERBLOCK=22,this.SOUNDBLOCK=23,this.STEREOBLOCK=24,this.VIDEOBLOCK=25,this.MOVIEBLOCK=26,this.CINEMABLOCK=27,this.TEXTBLOCK=28,this.PARAGRAPHBLOCK=29,this.IMAGETEXTBLOCK=30,this.IMAGEPARAGRAPHBLOCK=31,this.ARRAY=49,this.ARRAYOFBOOLEAN=50,this.ARRAYOFUNSIGNEDINTEGER=51,this.ARRAYOFINTEGER=52,this.ARRAYOFNUMBER=53,this.ARRAYOFSTRING=54,this.ARRAYOFFUNCTION=55,this.ARRAYOFOBJECT=56,this.ARRAYOFCANVAS2DCONTEXT=57,this.ARRAYOFTRAITS=58,this.ARRAYOFMEMORY=59,this.ARRAYOFMATRIX=60,this.ARRAYOFBLOCK=61,this.ARRAYOFACTORBLOCK=62,this.ARRAYOFPLAYERBLOCK=63,this.ARRAYOFSOUNDBLOCK=64,this.ARRAYOFSTEREOBLOCK=65,this.ARRAYOFVIDEOBLOCK=66,this.ARRAYOFMOVIEBLOCK=67,this.ARRAYOFCINEMABLOCK=68,this.ARRAYOFTEXTBLOCK=69,this.ARRAYOFPARAGRAPHBLOCK=70,this.ARRAYOFIMAGETEXTBLOCK=71,this.ARRAYOFIMAGEPARAGRAPHBLOCK=72,this.REST=99,this.typeNames=new Object,this.typeNames[this.NONE]="NONE",this.typeNames[this.BOOLEAN]="Boolean",this.typeNames[this.UNSIGNEDINTEGER]="UnsignedInteger",this.typeNames[this.INTEGER]="Integer",this.typeNames[this.NUMBER]="Number",this.typeNames[this.STRING]="String",this.typeNames[this.FUNCTION]="Function",this.typeNames[this.OBJECT]="Object",this.typeNames[this.CANVAS2DCONTEXT]="Canvas2DContext",this.typeNames[this.TRAITS]="Traits",this.typeNames[this.MEMORY]="Memory",this.typeNames[this.MATRIX]="Matrix",this.typeNames[this.EVENT]="Event",this.typeNames[this.BLOCKEVENT]="BlockEvent",this.typeNames[this.MOUSEEVENT]="MouseEvent",this.typeNames[this.KEYBOARDEVENT]="KeyboardEvent",this.typeNames[this.CANVASFRAME]="CanvasFrame",this.typeNames[this.BLOCK]="Block",this.typeNames[this.ACTORBLOCK]="ActorBlock",this.typeNames[this.PLAYERBLOCK]="PlayerBlock",this.typeNames[this.SOUNDBLOCK]="SoundBlock",this.typeNames[this.STEREOBLOCK]="StereoBlock",this.typeNames[this.VIDEOBLOCK]="VideoBlock",this.typeNames[this.MOVIEBLOCK]="MovieBlock",this.typeNames[this.CINEMABLOCK]="CinemaBlock",this.typeNames[this.TEXTBLOCK]="TextBlock",this.typeNames[this.PARAGRAPHBLOCK]="ParagraphBlock",this.typeNames[this.IMAGETEXTBLOCK]="ImageTextBlock",this.typeNames[this.IMAGEPARAGRAPHBLOCK]="ImageParagraphBlock",this.typeNames[this.ARRAY]="Array",this.typeNames[this.ARRAYOFBOOLEAN]="Array of Booleans",this.typeNames[this.ARRAYOFUNSIGNEDINTEGER]="Array of UnsignedIntegers",this.typeNames[this.ARRAYOFINTEGER]="Array of Integers",this.typeNames[this.ARRAYOFNUMBER]="Array of Numbers",this.typeNames[this.ARRAYOFSTRING]="Array of Strings",this.typeNames[this.ARRAYOFFUNCTION]="Array of Functions",this.typeNames[this.ARRAYOFOBJECT]="Array of Objects",this.typeNames[this.ARRAYOFCANVAS2DCONTEXT]="Array of Canvas2DContexts",this.typeNames[this.ARRAYOFTRAITS]="Array of Traits",this.typeNames[this.ARRAYOFMEMORY]="Array of Memorys",this.typeNames[this.ARRAYOFMATRIX]="Array of Matrixs",this.typeNames[this.ARRAYOFBLOCK]="Array of Blocks",this.typeNames[this.ARRAYOFACTORBLOCK]="Array of ActorBlocks",this.typeNames[this.ARRAYOFPLAYERBLOCK]="Array of PlayerBlocks",this.typeNames[this.ARRAYOFSOUNDBLOCK]="Array of SoundBlocks",this.typeNames[this.ARRAYOFSTEREOBLOCK]="Array of StereoBlocks",this.typeNames[this.ARRAYOFVIDEOBLOCK]="Array of VideoBlocks",this.typeNames[this.ARRAYOFMOVIEBLOCK]="Array of MovieBlocks",this.typeNames[this.ARRAYOFCINEMABLOCK]="Array of CinemaBlocks",this.typeNames[this.ARRAYOFTEXTBLOCK]="Array of TextBlocks",this.typeNames[this.ARRAYOFPARAGRAPHBLOCK]="Array of ParagraphBlocks",this.typeNames[this.ARRAYOFIMAGETEXTBLOCK]="Array of ImageTextBlocks",this.typeNames[this.ARRAYOFIMAGEPARAGRAPHBLOCK]="Array of ImageParagraphBlocks",this.typeDefaults=new Object,this.typeDefaults[this.NONE]=void 0,this.typeDefaults[this.BOOLEAN]=!1,this.typeDefaults[this.UNSIGNEDINTEGER]=0,this.typeDefaults[this.INTEGER]=0,this.typeDefaults[this.NUMBER]=0,this.typeDefaults[this.STRING]="",this.typeDefaults[this.FUNCTION]=null,this.typeDefaults[this.OBJECT]=null,this.typeDefaults[this.CANVAS2DCONTEXT]=null,this.typeDefaults[this.TRAITS]=null,this.typeDefaults[this.MEMORY]=null,this.typeDefaults[this.MATRIX]=null,this.typeDefaults[this.EVENT]=null,this.typeDefaults[this.BLOCKEVENT]=null,this.typeDefaults[this.MOUSEEVENT]=null,this.typeDefaults[this.KEYBOARDEVENT]=null,this.typeDefaults[this.CANVASFRAME]=null,this.typeDefaults[this.BLOCK]=null,this.typeDefaults[this.ACTORBLOCK]=null,this.typeDefaults[this.PLAYERBLOCK]=null,this.typeDefaults[this.SOUNDBLOCK]=null,this.typeDefaults[this.STEREOBLOCK]=null,this.typeDefaults[this.VIDEOBLOCK]=null,this.typeDefaults[this.MOVIEBLOCK]=null,this.typeDefaults[this.CINEMABLOCK]=null,this.typeDefaults[this.TEXTBLOCK]=null,this.typeDefaults[this.PARAGRAPHBLOCK]=null,this.typeDefaults[this.IMAGETEXTBLOCK]=null,this.typeDefaults[this.IMAGEPARAGRAPHBLOCK]=null,this.typeDefaults[this.ARRAYOFBOOLEAN]=null,this.typeDefaults[this.ARRAYOFUNSIGNEDINTEGER]=null,this.typeDefaults[this.ARRAYOFINTEGER]=null,this.typeDefaults[this.ARRAYOFNUMBER]=null,this.typeDefaults[this.ARRAYOFSTRING]=null,this.typeDefaults[this.ARRAYOFFUNCTION]=null,this.typeDefaults[this.ARRAYOFOBJECT]=null,this.typeDefaults[this.ARRAYOFCANVAS2DCONTEXT]=null,this.typeDefaults[this.ARRAYOFTRAITS]=null,this.typeDefaults[this.ARRAYOFMEMORY]=null,this.typeDefaults[this.ARRAYOFMATRIX]=null,this.typeDefaults[this.ARRAY]=null,this.typeDefaults[this.ARRAYOFBLOCK]=null,this.typeDefaults[this.ARRAYOFACTORBLOCK]=null,this.typeDefaults[this.ARRAYOFPLAYERBLOCK]=null,this.typeDefaults[this.ARRAYOFSOUNDBLOCK]=null,this.typeDefaults[this.ARRAYOFSTEREOBLOCK]=null,this.typeDefaults[this.ARRAYOFVIDEOBLOCK]=null,this.typeDefaults[this.ARRAYOFMOVIEBLOCK]=null,this.typeDefaults[this.ARRAYOFCINEMABLOCK]=null,this.typeDefaults[this.ARRAYOFTEXTBLOCK]=null,this.typeDefaults[this.ARRAYOFPARAGRAPHBLOCK]=null,this.typeDefaults[this.ARRAYOFIMAGETEXTBLOCK]=null,this.typeDefaults[this.ARRAYOFIMAGEPARAGRAPHBLOCK]=null,this.associatedTypes=new Object,this.associatedTypes[this.ARRAYOFBOOLEAN]=this.BOOLEAN,this.associatedTypes[this.ARRAYOFUNSIGNEDINTEGER]=this.UNSIGNEDINTEGER,this.associatedTypes[this.ARRAYOFINTEGER]=this.INTEGER,this.associatedTypes[this.ARRAYOFNUMBER]=this.NUMBER,this.associatedTypes[this.ARRAYOFSTRING]=this.STRING,this.associatedTypes[this.ARRAYOFFUNCTION]=this.FUNCTION,this.associatedTypes[this.ARRAYOFOBJECT]=this.OBJECT,this.associatedTypes[this.ARRAYOFCANVAS2DCONTEXT]=this.CANVAS2DCONTEXT,this.associatedTypes[this.ARRAYOFTRAITS]=this.TRAITS,this.associatedTypes[this.ARRAYOFMEMORY]=this.MEMORY,this.associatedTypes[this.ARRAYOFMATRIX]=this.MATRIX,this.associatedTypes[this.ARRAYOFBLOCK]=this.BLOCK,this.associatedTypes[this.ARRAYOFACTORBLOCK]=this.ACTORBLOCK,this.associatedTypes[this.ARRAYOFPLAYERBLOCK]=this.PLAYERBLOCK,this.associatedTypes[this.ARRAYOFSOUNDBLOCK]=this.SOUNDBLOCK,this.associatedTypes[this.ARRAYOFSTEREOBLOCK]=this.STEREOBLOCK,this.associatedTypes[this.ARRAYOFVIDEOBLOCK]=this.VIDEOBLOCK,this.associatedTypes[this.ARRAYOFMOVIEBLOCK]=this.MOVIEBLOCK,this.associatedTypes[this.ARRAYOFCINEMABLOCK]=this.CINEMABLOCK,this.associatedTypes[this.ARRAYOFTEXTBLOCK]=this.TEXTBLOCK,this.associatedTypes[this.ARRAYOFPARAGRAPHBLOCK]=this.PARAGRAPHBLOCK,this.associatedTypes[this.ARRAYOFIMAGETEXTBLOCK]=this.IMAGETEXTBLOCK,this.associatedTypes[this.ARRAYOFIMAGEPARAGRAPHBLOCK]=this.IMAGEPARAGRAPHBLOCK,this.currentFunctionName="",this.currentParamIndex=0};Params.prototype.getCallerClassNameFunctionName=function(){var a=new Error("");return null==a.stack?" . ":a.stack.indexOf("    at ")>=0?a.stack.split("    at ")[3].split(" ")[0]:a.stack.indexOf("@")>=0?a.stack.split(/\s/)[2].split("@")[0]:" . "},Params.prototype.getCallerFunctionName=function(){return getCallerClassNameFunctionName().split(".")[1]},Params.prototype.getDefaultOrNullValue=function(a){return"undefined"!=typeof a?a:null},Params.prototype.createParamValidationMessage=function(a,b,c){return void 0==c&&(c=""),"Function '"+this.currentFunctionName+"' was expecting a value of type {"+this.typeNames[a]+"} for parameter ("+this.currentParamIndex+"), but the value '"+b+"' was passed in."+c},Params.prototype.createArrayParamValidationMessage=function(a,b,c){return void 0==c&&(c=""),"Function '"+this.currentFunctionName+"' was expecting a value of type {"+this.typeNames[a]+"} for parameter ("+this.currentParamIndex+"), but the value '["+b+"]' was passed in."+c},Params.prototype.createArrayParamInnerValidationMessage=function(a,b,c){return"\n		Function '"+this.currentFunctionName+"' was expecting a value of type {"+this.typeNames[a]+"} for parameter ("+this.currentParamIndex+"), but the element value at index ["+b+"]  was '"+c+"'. "},Params.prototype.createArrayParamHeaderValidationMessage=function(){return"\n	Array validation results: "},Params.prototype.initializeValidation=function(a){this.currentFunctionName=void 0==a?LOG.logThreshold<=LOG.WARN?this.getCallerClassNameFunctionName():"":a,this.currentParamIndex=0},Params.prototype.isTypeOf=function(a,b){switch(b){case this.BOOLEAN:return"boolean"==typeof a;case this.UNSIGNEDINTEGER:return"number"==typeof a?a%1==0&&a>=0:!1;case this.INTEGER:return"number"==typeof a?a%1==0:!1;case this.NUMBER:return"number"==typeof a;case this.STRING:return a instanceof String||"string"==typeof a;case this.FUNCTION:return a instanceof Function||"function"==typeof a;case this.OBJECT:return a instanceof Object&&"object"==typeof a;case this.CANVAS2DCONTEXT:return a instanceof CanvasRenderingContext2D;case this.TRAITS:return a.prototype instanceof Traits;case this.MEMORY:return a instanceof Memory;case this.MATRIX:return a instanceof Matrix;case this.EVENT:return a instanceof Event;case this.BLOCKEVENT:return a instanceof BlockEvent;case this.MOUSEEVENT:;return a instanceof MouseEvent;case this.KEYBOARDEVENT:return a instanceof KeyboardEvent;case this.CANVASFRAME:return a instanceof CanvasFrame;case this.BLOCK:return a instanceof Block;case this.ACTORBLOCK:return a instanceof ActorBlock;case this.PLAYERBLOCK:return a instanceof PlayerBlock;case this.SOUNDBLOCK:return a instanceof SoundBlock;case this.STEREOBLOCK:return a instanceof StereoBlock;case this.VIDEOBLOCK:return a instanceof VideoBlock;case this.MOVIEBLOCK:return a instanceof MovieBlock;case this.CINEMABLOCK:return a instanceof CinemaBlock;case this.TEXTBLOCK:return a instanceof TextBlock;case this.PARAGRAPHBLOCK:return a instanceof ParagraphBlock;case this.IMAGETEXTBLOCK:return a instanceof ImageTextBlock;case this.IMAGEPARAGRAPHBLOCK:return a instanceof ImageParagraphBlock;case this.ARRAY:return a instanceof Array}},Params.prototype.validateValue=function(a,b,c){var d,e="";return this.isTypeOf(b,a)?d=b:(d=c,e=this.createParamValidationMessage(a,b)),{validatedValue:d,message:e}},Params.prototype.validateArray=function(a,b,c){var d,e="",f="";if(b instanceof Array){for(var g=!0,h=0;h<b.length;h++)this.isTypeOf(b[h],a)||(g=!1,f+=this.createArrayParamInnerValidationMessage(a,h,b[h]));""!=f&&(f=this.createArrayParamHeaderValidationMessage()+f),g?d=b:(d=c,e=this.createArrayParamValidationMessage(a,b,f))}else d=c,e=this.createParamValidationMessage(a,b);return{validatedValue:d,message:e}},Params.prototype.validateParam=function(a,b,c){var d,e,f="",g="",h=!1;switch(a){case this.BOOLEAN:case this.NUMBER:case this.STRING:case this.FUNCTION:case this.OBJECT:case this.CANVAS2DCONTEXT:case this.MEMORY:case this.TRAITS:case this.MATRIX:case this.EVENT:case this.BLOCKEVENT:case this.MOUSEEVENT:case this.KEYBOARDEVENT:case this.CANVASFRAME:case this.BLOCK:case this.ACTORBLOCK:case this.PLAYERBLOCK:case this.SOUNDBLOCK:case this.STEREOBLOCK:case this.VIDEOBLOCK:case this.MOVIEBLOCK:case this.CINEMABLOCK:case this.TEXTBLOCK:case this.PARAGRAPHBLOCK:case this.IMAGETEXTBLOCK:case this.IMAGEPARAGRAPHBLOCK:case this.ARRAY:var e=this.validateValue(a,b,c);d=e.validatedValue,f=e.message;break;case this.UNSIGNEDINTEGER:"number"==typeof b?b%1==0&&b>=0?d=b:(d=Math.abs(Math.round(b)),f=this.createParamValidationMessage(a,b)):(d=c,f=this.createParamValidationMessage(a,b));break;case this.INTEGER:"number"==typeof b?b%1==0?d=b:(d=Math.round(b),f=this.createParamValidationMessage(a,b)):(d=c,f=this.createParamValidationMessage(a,b));break;case this.ARRAYOFBOOLEAN:case this.ARRAYOFNUMBER:case this.ARRAYOFSTRING:case this.ARRAYOFFUNCTION:case this.ARRAYOFOBJECT:case this.ARRAYOFCANVAS2DCONTEXT:case this.ARRAYOFMEMORY:case this.ARRAYOFTRAITS:case this.ARRAYOFMATRIX:case this.ARRAYOFBLOCK:case this.ARRAYOFACTORBLOCK:case this.ARRAYOFPLAYERBLOCK:case this.ARRAYOFSOUNDBLOCK:case this.ARRAYOFSTEREOBLOCK:case this.ARRAYOFVIDEOBLOCK:case this.ARRAYOFMOVIEBLOCK:case this.ARRAYOFCINEMABLOCK:case this.ARRAYOFTEXTBLOCK:case this.ARRAYOFPARAGRAPHBLOCK:case this.ARRAYOFIMAGETEXTBLOCK:case this.ARRAYOFIMAGEPARAGRAPHBLOCK:var e=this.validateArray(this.associatedTypes[a],b,c);d=e.validatedValue,f=e.message;break;case this.ARRAYOFUNSIGNEDINTEGER:if(b instanceof Array){for(var i=!0,j=0;j<b.length;j++)"number"==typeof b[j]?b[j]%1==0&&b[j]>=0||(""==f&&(f=this.createArrayParamValidationMessage(a,b)),g+=this.createArrayParamInnerValidationMessage(a,j,b[j]),b[j]=Math.abs(Math.round(b[j])),h=!0):(i=!1,g+=this.createArrayParamInnerValidationMessage(a,j,b[j]));""!=g&&(g=this.createArrayParamHeaderValidationMessage()+g),i?(d=b,""!=g&&(f=f+" {Number} values will be rounded to {Integer} values and signed values will be stripped of their signs."+g)):(d=c,f=this.createArrayParamValidationMessage(a,b,g))}else d=c,f=this.createParamValidationMessage(a,b);break;case this.ARRAYOFINTEGER:if(b instanceof Array){for(var i=!0,j=0;j<b.length;j++)"number"==typeof b[j]?b[j]%1==0||(""==f&&(f=this.createArrayParamValidationMessage(a,b)),g+=this.createArrayParamInnerValidationMessage(a,j,b[j]),b[j]=Math.round(b[j]),h=!0):(i=!1,g+=this.createArrayParamInnerValidationMessage(a,j,b[j]));""!=g&&(g=this.createArrayParamHeaderValidationMessage()+g),i?(d=b,""!=g&&(f=f+" {Number} values will be rounded to {Integer} values."+g)):(d=c,f=this.createArrayParamValidationMessage(a,b,g))}else d=c,f=this.createParamValidationMessage(a,b)}return""!=f&&("undefined"==typeof d&&(d=a<this.ARRAYOFBOOLEAN?this.typeDefaults[a]:[]),(b!=d||d==c||h)&&(a<this.ARRAYOFBOOLEAN?f=f+" Using a value of '"+d+"' instead.":d instanceof Array?0==d.length?f+="\n	Using a value of '[]' for Array object instead.":f=f+"\n	Using a value of '["+d+"]' for Array object instead.":f=f+"\n	Using a value of '"+d+"' for Array object instead."),LOG.write(f,LOG.WARN)),this.currentParamIndex++,d},Params.prototype.validateArguments=function(a,b,c){c="undefined"!=typeof c?c:[];for(var d=(LOG.logThreshold<=LOG.WARN?this.getCallerClassNameFunctionName():"",0),e=0,f=0,g=Math.max(a.indexOf(this.REST)<0?a.length:a.length-1,b.length,c.length),h=0;g>h;h++)a[e]==this.REST&&(e++,d=e),b[h]=this.validateParam(a[e],b[h],f>=c.length?void 0:c[f]),e++,e>=a.length&&(e=d),f++,f>=c.length&&(f=d-1)},Params.prototype.validateVariableObject=function(a,b,c,d){if(a="undefined"!=typeof a?a:{},void 0==typeof b||void 0==typeof c||void 0==typeof d||b.length!=c.length||c.length!=d.length)return a;for(var e=0;e<b.length;e++)a[b[e]]=this.validateParam(c[e],a[b[e]],d[e]);return a};var PARAMS=new Params,AudioTrack=function(){LOG.write("AudioTrack constructor called",LOG.VERBOSE),this.audio=document.createElement("audio"),this.name="",this.onload=null};AudioTrack.prototype.getName=function(){return this.name},AudioTrack.prototype.setName=function(a){this.name=a,this.audio.name=a},AudioTrack.prototype.load=function(a){this.audio.addEventListener("canplaythrough",this.onload),this.audio.src=a,this.audio.load()},AudioTrack.prototype.play=function(){this.audio.currentTime=0,this.audio.play()},AudioTrack.prototype.pause=function(){this.audio.pause()},AudioTrack.prototype.unpause=function(){this.audio.unpause()},AudioTrack.prototype.playPause=function(){this.audio.paused?this.audio.play():this.audio.pause()},AudioTrack.prototype.getVolume=function(){return 100*this.audio.volume},AudioTrack.prototype.setVolume=function(a){var b=0;b=a>=100?1:0>=a?0:a/100,this.audio.volume=b},AudioTrack.prototype.setLooping=function(a){this.audio.loop=a};var Video=function(){LOG.write("Video constructor called",LOG.VERBOSE),this.video=document.createElement("video"),this.name="",this.onload=null,this.onloadEventListenerAdded=!1};Video.prototype.getName=function(){return this.name},Video.prototype.setName=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.name=a,this.video.name=a},Video.prototype.addSource=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.STRING,b),this.onloadEventListenerAdded||(this.video.addEventListener("canplaythrough",this.onload),this.onloadEventListenerAdded=!0);var c=document.createElement("source");c.src=a,c.type=b,this.video.appendChild(c)},Video.prototype.play=function(){this.video.currentTime=0,this.video.play()},Video.prototype.pause=function(){this.video.pause()},Video.prototype.unpause=function(){this.video.play()},Video.prototype.playPause=function(){this.video.paused?this.video.play():this.video.pause()},Video.prototype.getVolume=function(){return 100*this.video.volume},Video.prototype.setVolume=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.NUMBER,a);var b=0;b=a>=100?1:0>=a?0:a/100,this.video.volume=b},Video.prototype.setLooping=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a),this.video.loop=a},Video.prototype.getCurrentTime=function(){return this.video.currentTime},Video.prototype.setCurrentTime=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.NUMBER,a),this.video.pause(),this.video.currentTime=a},Video.prototype.destroy=function(){this.video&&(this.video.pause(),this.onloadEventListenerAdded&&this.video.removeEventListener("canplaythrough",this.onload),delete this.video,this.video=void 0),this.name=void 0,this.onload=void 0,this.onloadEventListenerAdded=void 0};var Memory=function(){},Traits=function(){},Event=function(){this.subscribedFunctions=new Array};Event.prototype.fireEvent=function(){for(var a=0;a<this.subscribedFunctions.length;a++)this.subscribedFunctions[a](this)},Event.prototype.subscribe=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),-1==this.subscribedFunctions.indexOf(a)&&this.subscribedFunctions.push(a),LOG.write("# of subscriptions:"+this.subscribedFunctions.length,LOG.VERBOSE)},Event.prototype.unsubscribe=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=this.subscribedFunctions.indexOf(a);b>-1&&this.subscribedFunctions.splice(b,1)},Event.prototype.unsubscribeAll=function(){this.subscribedFunctions.splice(0,this.subscribedFunctions.length)};var BlockEvent=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.subscribedBlocks=new Array,this.eventName=a,this.reactFunctionName="reactTo"+a};BlockEvent.prototype.fireEvent=function(){for(var a=0;a<this.subscribedBlocks.length;a++)this.subscribedBlocks[a][this.reactFunctionName](this)},BlockEvent.prototype.subscribe=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),-1==this.subscribedBlocks.indexOf(a)&&this.subscribedBlocks.push(a),LOG.write("# of subscriptions:"+this.subscribedBlocks.length,LOG.VERBOSE)},BlockEvent.prototype.unsubscribe=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a);var b=this.subscribedBlocks.indexOf(a);b>-1&&this.subscribedBlocks.splice(b,1)},BlockEvent.prototype.unsubscribeAll=function(){this.subscribedBlocks.splice(0,this.subscribedBlocks.length)};var MouseEvent=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),BlockEvent.call(this,a),this.x=0,this.y=0};MouseEvent.prototype=new BlockEvent,MouseEvent.prototype.consumeEvent=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),this.x=a,this.y=b},MouseEvent.prototype.fireEvent=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a,null),b=PARAMS.validateParam(PARAMS.INTEGER,b,null),null!=a&&(this.x=a),null!=b&&(this.y=b),this.subscribedBlocks.sort(function(a,b){return a.globalZ()-b.globalZ()});for(var c=0;c<this.subscribedBlocks.length;c++)if(this.subscribedBlocks[c][this.reactFunctionName](this))return;for(var c=0;c<this.subscribedBlocks.length;c++)if(this.subscribedBlocks[c][this.reactFunctionName](this))return};var KeyboardEvent=function(){this.keyPressSubscribedBlocks=new Object,this.keyDownSubscribedBlocks=new Object,this.keyUpSubscribedBlocks=new Object,this.keysDown=new Array,this.lastKeyCodePress=0,this.lastKeyCodeDown=0,this.lastKeyCodeUp=0,this.lastKeyNamePress="",this.lastKeyNameDown="",this.lastKeyNameUp="",this.KEYPRESSEVENT="KeyPressEvent",this.KEYDOWNEVENT="KeyDownEvent",this.KEYUPEVENT="KeyUpEvent"};KeyboardEvent.prototype=new BlockEvent,KeyboardEvent.prototype.keysDown=new Array,KeyboardEvent.prototype.fireEvent=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.STRING,b);var c=this.keysDown.indexOf(a),d=KEYCODES.getStringFromKeyCode(a),e=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);if(b==this.KEYDOWNEVENT){if(this.lastKeyCodeDown=a,this.lastKeyNameDown=d,-1==c){if(this.keysDown.push(a),this.keysDown.length>1){var f=KEYCODES.getStringFromKeyCodes(this.keysDown);if(void 0!=this.keyDownSubscribedBlocks[f])for(var g=0;g<this.keyDownSubscribedBlocks[f].length;g++)this.keyDownSubscribedBlocks[f][g]["reactTo"+this.KEYDOWNEVENT](this,d)}if(void 0!=this.keyDownSubscribedBlocks[d])for(var g=0;g<this.keyDownSubscribedBlocks[d].length;g++)this.keyDownSubscribedBlocks[d][g]["reactTo"+this.KEYDOWNEVENT](this,d);if(void 0!=this.keyDownSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)])for(var g=0;g<this.keyDownSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)].length;g++)this.keyDownSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)][g]["reactTo"+this.KEYDOWNEVENT](this,e)}}else if(b==this.KEYUPEVENT){if(this.lastKeyCodeUp=a,this.lastKeyNameUp=d,-1!=c&&this.keysDown.splice(c,1),void 0!=this.keyUpSubscribedBlocks[d])for(var g=0;g<this.keyUpSubscribedBlocks[d].length;g++)this.keyUpSubscribedBlocks[d][g]["reactTo"+this.KEYUPEVENT](this,d);if(void 0!=this.keyUpSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)])for(var g=0;g<this.keyUpSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)].length;g++)this.keyUpSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)][g]["reactTo"+this.KEYUPEVENT](this,e)}else if(b==this.KEYPRESSEVENT){if(this.lastKeyCodePress=a,this.lastKeyNamePress=d,void 0!=this.keyPressSubscribedBlocks[d])for(var g=0;g<this.keyPressSubscribedBlocks[d].length;g++)this.keyPressSubscribedBlocks[d][g]["reactTo"+this.KEYPRESSEVENT](this,d);if(void 0!=this.keyPressSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)])for(var g=0;g<this.keyPressSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)].length;g++)this.keyPressSubscribedBlocks[KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY)][g]["reactTo"+this.KEYPRESSEVENT](this,e)}},KeyboardEvent.prototype.subscribeToKeyPress=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,0);var c;c=KEYCODES.getStringFromKeyCode(0==b?KEYCODES.ANYKEY:b),void 0==this.keyPressSubscribedBlocks[c]&&(this.keyPressSubscribedBlocks[c]=new Array),-1==this.keyPressSubscribedBlocks[c].indexOf(a)&&this.keyPressSubscribedBlocks[c].push(a)},KeyboardEvent.prototype.unsubscribeFromKeyPressForKeyCode=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,0);var c;if(c=KEYCODES.getStringFromKeyCode(0==b?KEYCODES.ANYKEY:b),void 0!=this.keyPressSubscribedBlocks[c]){var d=this.keyPressSubscribedBlocks[c].indexOf(a);-1!=d&&this.keyPressSubscribedBlocks[c].splice(d,1)}},KeyboardEvent.prototype.unsubscribeFromKeyPress=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a);for(var b in this.keyPressSubscribedBlocks)if(void 0!=this.keyPressSubscribedBlocks[b]){var c=this.keyPressSubscribedBlocks[b].indexOf(a);-1!=c&&this.keyPressSubscribedBlocks[b].splice(c,1)}},KeyboardEvent.prototype.subscribeToKeyDown=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,0);var c;c=KEYCODES.getStringFromKeyCode(0==b?KEYCODES.ANYKEY:b),void 0==this.keyDownSubscribedBlocks[c]&&(this.keyDownSubscribedBlocks[c]=new Array),-1==this.keyDownSubscribedBlocks[c].indexOf(a)&&this.keyDownSubscribedBlocks[c].push(a)},KeyboardEvent.prototype.unsubscribeFromKeyDownForKeyCode=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,0);var c;if(c=KEYCODES.getStringFromKeyCode(0==b?KEYCODES.ANYKEY:b),void 0!=this.keyDownSubscribedBlocks[c]){var d=this.keyDownSubscribedBlocks[c].indexOf(a);-1!=d&&this.keyDownSubscribedBlocks[c].splice(d,1)}},KeyboardEvent.prototype.unsubscribeFromKeyDown=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a);for(var b in this.keyDownSubscribedBlocks)if(void 0!=this.keyDownSubscribedBlocks[b]){var c=this.keyDownSubscribedBlocks[b].indexOf(a);-1!=c&&this.keyDownSubscribedBlocks[b].splice(c,1)}},KeyboardEvent.prototype.subscribeToKeyUp=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,0);var c;c=KEYCODES.getStringFromKeyCode(0==b?KEYCODES.ANYKEY:b),void 0==this.keyUpSubscribedBlocks[c]&&(this.keyUpSubscribedBlocks[c]=new Array),-1==this.keyUpSubscribedBlocks[c].indexOf(a)&&this.keyUpSubscribedBlocks[c].push(a)},KeyboardEvent.prototype.unsubscribeFromKeyUpForKeyCode=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,0);var c;if(c=KEYCODES.getStringFromKeyCode(0==b?KEYCODES.ANYKEY:b),void 0!=this.keyUpSubscribedBlocks[c]){var d=this.keyUpSubscribedBlocks[c].indexOf(a);-1!=d&&this.keyUpSubscribedBlocks[c].splice(d,1)}},KeyboardEvent.prototype.unsubscribeFromKeyUp=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a);for(var b in this.keyUpSubscribedBlocks)if(void 0!=this.keyUpSubscribedBlocks[b]){var c=this.keyUpSubscribedBlocks[b].indexOf(a);-1!=c&&this.keyUpSubscribedBlocks[b].splice(c,1)}},KeyboardEvent.prototype.subscribeToKeyCombination=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,b);var c=KEYCODES.getStringFromKeyCodes(b);void 0==this.keyDownSubscribedBlocks[c]&&(this.keyDownSubscribedBlocks[c]=new Array),-1==this.keyDownSubscribedBlocks[c].indexOf(a)&&this.keyDownSubscribedBlocks[c].push(a)},KeyboardEvent.prototype.unsubscribeFromKeyCombinationForKeyCodes=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),b=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,b);var c=KEYCODES.getStringFromKeyCodes(b);if(void 0!=this.keyDownSubscribedBlocks[c]){var d=this.keyDownSubscribedBlocks[c].indexOf(a);-1!=d&&this.keyDownSubscribedBlocks[c].splice(d,1)}},KeyboardEvent.prototype.unsubscribeFromKeyCombination=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a);for(var b in this.keyDownSubscribedBlocks)if(void 0!=this.keyDownSubscribedBlocks[b]){var c=this.keyDownSubscribedBlocks[b].indexOf(a);-1!=c&&this.keyDownSubscribedBlocks[b].splice(c,1)}},KeyboardEvent.prototype.unsubscribe=function(a){this.unsubscribeFromKeyPress(a),this.unsubscribeFromKeyDown(a),this.unsubscribeFromKeyUp(a),this.unsubscribeFromKeyCombination(a)};var AssetManager=function(){LOG.write("AssetManager constructor called",LOG.VERBOSE),this.xmlRequest=new XMLHttpRequest,this.imageAssets=new Object,this.audioAssets=new Object,this.videoAssets=new Object,this.imageAssetsFound=-1,this.imageAssetsLoaded=-1,this.audioAssetsFound=-1,this.audioAssetsLoaded=-1,this.videoAssetsFound=-1,this.videoAssetsLoaded=-1,this.imageAssetsLoadedEvent=new Event,this.audioAssetsLoadedEvent=new Event,this.videoAssetsLoadedEvent=new Event,this.assetsLoadedEvent=new Event};AssetManager.prototype.tryToFireAssetsLoadedEvent=function(){(this.imageAssetsFound<0||this.imageAssetsFound>0&&this.imageAssetsFound==this.imageAssetsLoaded&&this.audioAssetsFound<0||this.audioAssetsFound>0&&this.audioAssetsFound==this.audioAssetsLoaded&&this.videoAssetsFound<0||this.videoAssetsFound>0&&this.videoAssetsFound==this.videoAssetsLoaded)&&this.assetsLoadedEvent.fireEvent()},AssetManager.prototype.onImageAssetLoaded=function(){this.imageAssetsLoaded=this.imageAssetsLoaded+1,LOG.write("assetsFound: "+this.imageAssetsFound+" assetsLoaded: "+this.imageAssetsLoaded,LOG.VERBOSE),this.imageAssetsFound==this.imageAssetsLoaded&&(LOG.writeObject(this.imageAssets,LOG.VERBOSE),this.imageAssetsLoadedEvent.fireEvent(),this.tryToFireAssetsLoadedEvent())},AssetManager.prototype.onAudioAssetLoaded=function(){this.audioAssetsLoaded=this.audioAssetsLoaded+1,LOG.write("assetsFound: "+this.audioAssetsFound+" assetsLoaded: "+this.audioAssetsLoaded,LOG.VERBOSE),this.audioAssetsFound==this.audioAssetsLoaded&&(LOG.writeObject(this.audioAssets,LOG.VERBOSE),this.audioAssetsLoadedEvent.fireEvent(),this.tryToFireAssetsLoadedEvent())},AssetManager.prototype.onVideoAssetLoaded=function(){this.videoAssetsLoaded=this.videoAssetsLoaded+1,LOG.write("assetsFound: "+this.videoAssetsFound+" assetsLoaded: "+this.videoAssetsLoaded,LOG.VERBOSE),this.videoAssetsFound==this.videoAssetsLoaded&&(LOG.writeObject(this.videoAssets,LOG.VERBOSE),this.videoAssetsLoadedEvent.fireEvent(),this.tryToFireAssetsLoadedEvent())},AssetManager.prototype.loadImageAssetXML=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a);var b=this;this.xmlRequest.open("GET",a,!1),this.xmlRequest.send();var c=new DOMParser,d=c.parseFromString(this.xmlRequest.response,"text/xml"),e=d.getElementsByTagName("Image");this.imageAssetsFound=e.length;for(var f=0;f<e.length;f++){var g=(new Image,e[f].getElementsByTagName("Filename")[0].childNodes[0].nodeValue),h=e[f].getElementsByTagName("Alias")[0].childNodes[0].nodeValue;null==h&&(h=g),this.imageAssets[h]=new Object,this.imageAssets[h].img=new Image,this.imageAssets[h].img.name=h,this.imageAssets[h].img.onload=function(){LOG.write("Image onload reached with alias: "+this.name+" Width:"+b.imageAssets[this.name].img.width+" Height:"+b.imageAssets[this.name].img.height,LOG.INFO),CANVASMANAGER.workingCanvasFrame.resize(CANVASMANAGER.width,CANVASMANAGER.height,-1);var a=0,c=0,d=b.imageAssets[this.name].img.width,e=b.imageAssets[this.name].img.height;(CANVASMANAGER.width<b.imageAssets[this.name].img.width||CANVASMANAGER.height<b.imageAssets[this.name].img.height)&&(a=b.imageAssets[this.name].img.width/2-CANVASMANAGER.width/2,c=b.imageAssets[this.name].img.height/2-CANVASMANAGER.height/2,d=CANVASMANAGER.width,e=CANVASMANAGER.height),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,d,e),CANVASMANAGER.workingCanvasFrame.context.drawImage(b.imageAssets[this.name].img,a,c,d,e,0,0,d,e),b.imageAssets[this.name].imgdata=CANVASMANAGER.workingCanvasFrame.context.getImageData(0,0,b.imageAssets[this.name].img.width,b.imageAssets[this.name].img.height),b.onImageAssetLoaded()
},this.imageAssets[h].img.src=g,LOG.write("filename: "+g+" alias: "+h,LOG.VERBOSE)}},AssetManager.prototype.loadAudioAssetXML=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a);var b=this;this.xmlRequest.open("GET",a,!1),this.xmlRequest.send();var c=new DOMParser,d=c.parseFromString(this.xmlRequest.response,"text/xml"),e=d.getElementsByTagName("AudioTrack");this.audioAssetsFound=e.length;for(var f=0;f<e.length;f++){var g=e[f].getElementsByTagName("Filename")[0].childNodes[0].nodeValue,h=e[f].getElementsByTagName("Alias")[0].childNodes[0].nodeValue,i=new AudioTrack(g);null==h&&(h=g),this.audioAssets[h]=new Object,this.audioAssets[h].track=i,this.audioAssets[h].track.setName(h),this.audioAssets[h].track.onload=function(){LOG.writeObject(this),LOG.write("AudioTrack oncanplaythrough reached with alias: "+this.name,LOG.INFO),b.onAudioAssetLoaded()},this.audioAssets[h].track.load(g),LOG.write("filename: "+g+" alias: "+h,LOG.VERBOSE)}},AssetManager.prototype.loadVideoAssetXML=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a);var b=this;this.xmlRequest.open("GET",a,!1),this.xmlRequest.send();var c=new DOMParser,d=c.parseFromString(this.xmlRequest.response,"text/xml"),e=d.getElementsByTagName("Video");this.videoAssetsFound=e.length;for(var f=0;f<e.length;f++){var g=e[f].getElementsByTagName("Alias")[0].childNodes[0].nodeValue,h=new Video(k);null==g&&(g=k),this.videoAssets[g]=new Object,this.videoAssets[g].video=h,this.videoAssets[g].video.setName(g);var i=e[f].getElementsByTagName("Source");this.videoAssets[g].video.onload=function(){LOG.writeObject(this),LOG.write("Video oncanplaythrough reached with alias: "+this.name,LOG.INFO),b.onVideoAssetLoaded()};for(var j=0;j<i.length;j++){var k=i[f].getElementsByTagName("Filename")[0].childNodes[0].nodeValue,l=i[f].getElementsByTagName("Type")[0].childNodes[0].nodeValue;this.videoAssets[g].video.addSource(k,l)}LOG.write("filename: "+k+" alias: "+g,LOG.VERBOSE)}},AssetManager.prototype.loadAssets=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a,null),b=PARAMS.validateParam(PARAMS.STRING,b,null),c=PARAMS.validateParam(PARAMS.STRING,c,null),null==a?(this.imageAssetsFound=-1,this.imageAssetsLoaded=-1):(this.imageAssetsFound=0,this.imageAssetsLoaded=0),null==b?(this.audioAssetsFound=-1,this.audioAssetsLoaded=-1):(this.audioAssetsFound=0,this.audioAssetsLoaded=0),null==c?(this.videoAssetsFound=-1,this.videoAssetsLoaded=-1):(this.videoAssetsFound=0,this.videoAssetsLoaded=0),0==this.imageAssetsFound&&this.loadImageAssetXML(a),0==this.audioAssetsFound&&this.loadAudioAssetXML(b),0==this.videoAssetsFound&&this.loadVideoAssetXML(c)};var Block=function(){this.identity=null;var a=0,b=0,c=0,d=0,e=0,f=1,g=1,h=0,i=!0;if(this._getX=function(){return a},this._getY=function(){return b},this._getZ=function(){return c},this._getWidth=function(){return d},this._getHeight=function(){return e},this._getScaleX=function(){return f},this._getScaleY=function(){return g},this._getRotation=function(){return h},this._getVisible=function(){return i},this._setX=function(b){a=b},this._setY=function(a){b=a},this._setZ=function(a){c=a},this._setWidth=function(a){d=a},this._setHeight=function(a){e=a},this._setScaleX=function(a){f=a},this._setScaleY=function(a){g=a},this._setRotation=function(a){h=a},this._setVisible=function(a){i=a},this.x=a,this.y=b,this.z=c,this.width=d,this.height=e,this.scaleX=f,this.scaleY=g,this.rotation=h,this.visible=i,this.parent=null,this.children=new Array,this.showDebugDisplay=!1,this.initialized=!1,this.isMarkedForDestruction=!1,this.traits)for(var j=0;j<this.traits.length;j++)COMMON.extendInternalProperties(new this.traits[j],this)};Block.prototype.learn=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.TRAITS,a),COMMON.extend(new a,this),this.traits||(this.traits=[]),this.traits.push(a)},Block.prototype.globalX=function(){return null==this.parent?0:this.parent.globalX()+this.x},Block.prototype.globalY=function(){return null==this.parent?0:this.parent.globalY()+this.y},Block.prototype.globalZ=function(){return null==this.parent?0:this.parent.globalZ()+this.z},Block.prototype.globalScaleX=function(){return null==this.parent?0:this.parent.globalScaleX()+this.scaleX},Block.prototype.globalScaleY=function(){return null==this.parent?0:this.parent.globalScaleY()+this.scaleY},Block.prototype.adoptChild=function(a){null!=a.parent&&a.parent.orphanChild(a),this.children.push(a),a.parent=this,null==a.identity&&(a.identity="Block"+CANVASMANAGER.getIdentityNumber(),LOG.write("Child "+a.identity+" adopted by "+this.identity,LOG.VERBOSE))},Block.prototype.orphanChild=function(a){var b=this.children.indexOf(a);b>=0&&this.children.splice(b,1)},Block.prototype.toggleDebugDisplay=function(a){if(this.showDebugDisplay=!this.showDebugDisplay,void 0!=a&&a)for(var b=0;b<this.children.length;b++)this.children[b].showDebugDisplay=this.showDebugDisplay},Block.prototype.getZRatio=function(){var a=2*Math.tan(CANVASMANAGER.fov*(Math.PI/180)/2),b=1;return this._getZ()+a!=0&&(b=1/((this._getZ()+a)/a)),b},Block.prototype.undraw=function(a){if(this._getVisible()){var b=this.getZRatio();drawx=Math.round(-this._getWidth()/2+b*this._getX()),drawy=Math.round(-this._getHeight()/2+b*this._getY()),a.save(),a.translate(drawx+this._getWidth()/2-1,drawy+this._getHeight()/2-1),a.scale(b*this._getScaleX(),b*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180);for(var c=0;c<this.children.length;c++)this.children[c].undraw(a);a.restore()}},Block.prototype.update=function(){this._setX(this.x),this._setY(this.y),this._setZ(this.z),this._setWidth(this.width),this._setHeight(this.height),this._setScaleX(this.scaleX),this._setScaleY(this.scaleY),this._setRotation(this.rotation),this._setVisible(this.visible),this.isMarkedForDestruction&&this.destroy()},Block.prototype.draw=function(a){if(this._getVisible()){var b=this.getZRatio();drawx=Math.round(-this._getWidth()/2+b*this._getX()),drawy=Math.round(-this._getHeight()/2+b*this._getY()),a.save(),a.translate(drawx+this._getWidth()/2-1,drawy+this._getHeight()/2-1),a.scale(b*this._getScaleX(),b*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this.children.sort(function(a,b){return b.z-a.z});for(var c=0;c<this.children.length;c++)this.children[c].draw(a);a.restore()}},Block.prototype.destroy=function(){if(this.isMarkedForDestruction){this.identity=void 0,this._setX(void 0),this._setY(void 0),this._setZ(void 0),this._setWidth(void 0),this._setHeight(void 0),this._setScaleX(void 0),this._setScaleY(void 0),this._setRotation(void 0),this._setVisible(void 0),this.x=void 0,this.y=void 0,this.z=void 0,this.width=void 0,this.height=void 0,this.scaleX=void 0,this.scaleY=void 0,this.rotation=void 0,this.visible=void 0;for(var a=0;a<this.children.length;a++)this.children[a].destroy();this.children.splice(0,this.children.length),this.showDebugDisplay=void 0,this.parent.orphanChild(this),this.parent=void 0}else this.isMarkedForDestruction=!0};var ActorBlock=function(){LOG.write("ActorBlock constructor called",LOG.VERBOSE);Block.call(this),this.xvel=0,this.yvel=0,this.zvel=0,this.xacc=0,this.yacc=0,this.zacc=0,this.rotationVel=0,this.rotationAcc=0,this.behaviors=new Array,this.behaviorVars=new Object,this.constraints=new Array,this.constraintVars=new Object,this.isMouseOver=!1,this.mouseMoveReactions=new Array,this.mouseOverReactions=new Array,this.mouseOutReactions=new Array,this.mouseClickReactions=new Array,this.mouseDownReactions=new Array,this.mouseUpReactions=new Array,this.keyPressReactions=new Object,this.keyDownReactions=new Object,this.keyUpReactions=new Object,this.awake=!0,this.memoryCapacity=1,this.oldestMemoryIndex=0,this.currentMemoryIndex=0,this.memories=new Array(new Memory),this.shattered=!1};ActorBlock.prototype=new Block,ActorBlock.prototype.sleep=function(){this.awake=!1,this.currentMemoryIndex=this.oldestMemoryIndex-1,this.currentMemoryIndex<0&&(this.currentMemoryIndex+=this.memoryCapacity);for(var a=0;a<this.children.length;a++)this.children[a].sleep()},ActorBlock.prototype.wake=function(){this.awake=!0;var a=this.currentMemoryIndex+1;for(a>=this.memoryCapacity&&(a-=this.memoryCapacity);a!=this.oldestMemoryIndex;)this.forgetMemory(this.memories[a]),a++,a>=this.memoryCapacity&&(a-=this.memoryCapacity);this.oldestMemoryIndex=this.currentMemoryIndex+1,this.oldestMemoryIndex>=this.memoryCapacity&&(this.oldestMemoryIndex-=this.memoryCapacity);for(var b=0;b<this.children.length;b++)this.children[b].wake()},ActorBlock.prototype.forgetMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),a.x=null,a.y=null,a.z=null,a.xvel=null,a.yvel=null,a.zvel=null,a.xacc=null,a.yacc=null,a.zacc=null,a.rotation=null,a.rotationVel=null,a.rotationAcc=null},ActorBlock.prototype.isMemoryForgotten=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),null==a.x},ActorBlock.prototype.setMemoryCapacity=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),a>0){this.memoryCapacity=a,this.oldestMemoryIndex=0;for(var b=0;b<this.memoryCapacity;b++)null==this.memories[b]?this.memories[b]=new Memory:this.forgetMemory(this.memories[b])}},ActorBlock.prototype.recordMemory=function(){var a=this.memories[this.oldestMemoryIndex];return a.x=this._getX(),a.y=this._getY(),a.z=this._getZ(),a.xvel=this.xvel,a.yvel=this.yvel,a.zvel=this.zvel,a.xacc=this.xacc,a.yacc=this.yacc,a.zacc=this.zacc,a.rotation=this._getRotation(),a.rotationVel=this.rotationVel,a.rotationAcc=this.rotationAcc,a},ActorBlock.prototype.updateMemory=function(){this.initialized?(this.recordMemory(),this.oldestMemoryIndex++,this.oldestMemoryIndex>=this.memoryCapacity&&(this.oldestMemoryIndex=0)):this.initialized=!0},ActorBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),this.x=a.x,this.y=a.y,this.z=a.z,this.xvel=a.xvel,this.yvel=a.yvel,this.zvel=a.zvel,this.xacc=a.xacc,this.yacc=a.yacc,this.zacc=a.zacc,this.rotation=a.rotation,this.rotationVel=a.rotationVel,this.rotationAcc=a.rotationAcc},ActorBlock.prototype.setCurrentMemoryIndex=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),this.currentMemoryIndex=a},ActorBlock.prototype.getNthLatestMemory=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),a>=0&&a<this.memoryCapacity){var b=this.oldestMemoryIndex-1-a;0>b&&(b+=this.memoryCapacity);for(var c=this.memories[b];this.isMemoryForgotten(c)&&b!=this.oldestMemoryIndex;)b--,0>b&&(b+=this.memoryCapacity),c=this.memories[b];return this.isMemoryForgotten(c)?null:c}return null},ActorBlock.prototype.getLatestMemory=function(){return this.getNthLatestMemory(0)},ActorBlock.prototype.getNthEarliestMemory=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),a>=0&&a<this.memoryCapacity){var b=this.oldestMemoryIndex+a;b>=this.memoryCapacity&&(b-=this.memoryCapacity);for(var c=this.memories[b];this.isMemoryForgotten(c)&&b!=this.oldestMemoryIndex-1;)b++,b>=this.memoryCapacity&&(b-=this.memoryCapacity),c=this.memories[b];return this.isMemoryForgotten(c)?null:c}return null},ActorBlock.prototype.getEarliestMemory=function(){return this.getNthEarliestMemory(0)},ActorBlock.prototype.recallLaterMemory=function(){if(this.awake&&this.currentMemoryIndex==this.oldestMemoryIndex-1)return null;var a=this.currentMemoryIndex;a++,a>=this.memoryCapacity&&(a-=this.memoryCapacity);for(var b=this.memories[a];this.isMemoryForgotten(b)&&a!=this.oldestMemoryIndex-1;)a++,a>=this.memoryCapacity&&(a-=this.memoryCapacity),b=this.memories[a];for(var c=0;c<this.children.length;c++)this.children[c].recallLaterMemory();return this.isMemoryForgotten(b)?null:(this.currentMemoryIndex=a,b)},ActorBlock.prototype.recallEarlierMemory=function(){if(this.awake&&this.currentMemoryIndex==this.oldestMemoryIndex)return null;var a=this.currentMemoryIndex;a--,0>a&&(a+=this.memoryCapacity);for(var b=this.memories[a];this.isMemoryForgotten(b)&&a!=this.oldestMemoryIndex;)a--,0>a&&(a+=this.memoryCapacity),b=this.memories[a];for(var c=0;c<this.children.length;c++)this.children[c].recallEarlierMemory();return this.isMemoryForgotten(b)?null:(this.currentMemoryIndex=a,b)},ActorBlock.prototype.hasChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:!(a.x==this.x&&a.y==this.y&&a.z==this.z&&a.xvel==this.xvel&&a.yvel==this.yvel&&a.zvel==this.zvel&&a.xacc==this.xacc&&a.yacc==this.yacc&&a.zacc==this.zacc&&a.rotation==this.rotation&&a.rotationVel==this.rotationVel&&a.rotationAcc==this.rotationAcc)},ActorBlock.prototype.hasPositionChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:!(a.x==this.x&&a.y==this.y&&a.z==this.z&&a.rotation==this.rotation)},ActorBlock.prototype.update=function(){if(this.awake){this.updateMemory();for(var a=0;a<this.behaviors.length;a++)this.behaviors[a](this);for(var a=0;a<this.constraints.length;a++)this.constraints[a](this)}else if(this.currentMemoryIndex>=0&&this.currentMemoryIndex<this.memoryCapacity){var b=this.memories[this.currentMemoryIndex];null!=b&&this.changeMemoryIntoReality(b)}Block.prototype.update.call(this);for(var a=0;a<this.children.length;a++)this.children[a].update()},ActorBlock.prototype.addBehavior=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);var c=a.behaviorName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.behaviors.length;e++)if(c==this.behaviors[e].behaviorName){d=e;break}if(-1==d){var f=a.bind(b);f.behaviorName=c,this.behaviors.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addBehaviorToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addBehavior(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeBehavior=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.behaviorName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.behaviors.length;d++)if(b==this.behaviors[d].behaviorName){c=d;break}if(c>-1){this.behaviors.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}},ActorBlock.prototype.removeBehaviorFromChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].removeBehavior(a)},ActorBlock.prototype.removeAllBehaviors=function(){for(;this.behaviors.length>0;)this.removeBehavior(this.behaviors[0])},ActorBlock.prototype.removeAllBehaviorsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllBehaviors()},ActorBlock.prototype.addConstraint=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);var c=a.constraintName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.constraints.length;e++)if(c==this.constraints[e].constraintName){d=e;break}if(-1==d){var f=a.bind(b);f.constraintName=c,this.constraints.push(f),void 0!=b&&(this.constraintVars[c]=b)}},ActorBlock.prototype.addConstraintToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addConstraint(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeConstraint=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.constraintName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.constraints.length;d++)if(b==this.constraints[d].constraintName){c=d;break}if(c>-1){this.constraints.splice(c,1);for(var e in this.constraintVars[b])delete this.constraintVars[b][e];delete this.constraintVars[b]}},ActorBlock.prototype.removeConstraintFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeConstraint(a)},ActorBlock.prototype.removeAllConstraints=function(){for(;this.constraints.length>0;)this.removeConstraint(this.constraints[0])},ActorBlock.prototype.removeAllConstraintsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllConstraintsFromChildren()},ActorBlock.prototype.addTransformationsToMatrix=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MATRIX,a),null!=this.parent&&this.parent.addTransformationsToMatrix(a);var b=2*Math.tan(CANVASMANAGER.fov*(Math.PI/180)/2),c=1;this.z+b!=0&&(c=1/((this.z+b)/b));var d=Math.round(-this.width/2+c*this.x),e=Math.round(-this.height/2+c*this.y);a.addTranslation(d+this.width/2,e+this.height/2),a.addScale(c*this.scaleX,c*this.scaleY),a.addRotation(this.rotation)},ActorBlock.prototype.addInverseTransformationsToMatrix=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MATRIX,a),null!=this.parent&&this.parent.addInverseTransformationsToMatrix(a);var b=2*Math.tan(CANVASMANAGER.fov*(Math.PI/180)/2),c=1;this.z+b!=0&&(c=1/((this.z+b)/b));var d=Math.round(-this.width/2+c*this.x),e=Math.round(-this.height/2+c*this.y);a.addTranslation(-(d+this.width/2),-(e+this.height/2)),a.addScale(1/(c*this.scaleX),1/(c*this.scaleY)),a.addRotation(-this.rotation)},ActorBlock.prototype.addReverseTransformationsToMatrix=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MATRIX,a),null!=this.parent&&this.parent.addReverseTransformationsToMatrix(a);var b=2*Math.tan(CANVASMANAGER.fov*(Math.PI/180)/2),c=1;this.z+b!=0&&(c=1/((this.z+b)/b));var d=Math.round(-this.width/2+c*this.x),e=Math.round(-this.height/2+c*this.y);a.addRotation(-this.rotation),a.addScale(1/(c*this.scaleX),1/(c*this.scaleY)),a.addTranslation(-(d+this.width/2),-(e+this.height/2))},ActorBlock.prototype.transformGlobalXYToLocalCoordinates=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),MATRIX.clearTransformations(),this.addInverseTransformationsToMatrix(MATRIX);var c=MATRIX.applyTransformation(a,b);return c},ActorBlock.prototype.transformMouseEventToLocalCoordinates=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),this.transformGlobalXYToLocalCoordinates(a.x,a.y)},ActorBlock.prototype.isMouseEventWithinBlock=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),MATRIX.clearTransformations(),this.addInverseTransformationsToMatrix(MATRIX);var b=MATRIX.applyTransformation(a.x,a.y);return LOG.writeObject(b),b.x>-this.width/2&&b.x<this.width/2&&b.y>-this.height/2&&b.y<this.height/2?!0:!1},ActorBlock.prototype.reactToMouseMoveEvent=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),this.isMouseEventWithinBlock(a)){if(!this.isMouseOver){this.isMouseOver=!0;for(var b=0;b<this.mouseOverReactions.length;b++)this.mouseOverReactions[b](this,a)}}else if(this.isMouseOver){this.isMouseOver=!1;for(var b=0;b<this.mouseOutReactions.length;b++)this.mouseOutReactions[b](this,a)}for(var b=0;b<this.mouseMoveReactions.length;b++)this.mouseMoveReactions[b](this,a);return!0},ActorBlock.prototype.addMouseOverReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),CANVASMANAGER.mouseMoveEvent.subscribe(this);var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.mouseOverReactions.length;e++)if(c==this.mouseOverReactions[e].reactionName){d=e;break}if(-1==d){var f=a.bind(b);f.reactionName=c,this.mouseOverReactions.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addMouseOverReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addMouseOverReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeMouseOverReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.reactionName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.mouseOverReactions.length;d++)if(b==this.mouseOverReactions[d].reactionName){c=d;break}if(c>-1){this.mouseOverReactions.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}0==this.mouseOverReactions.length&&0==this.mouseOutReactions.length&&0==this.mouseMoveReactions.length&&CANVASMANAGER.mouseMoveEvent.unsubscribe(this)},ActorBlock.prototype.removeMouseOverReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeMouseOverReaction(a)},ActorBlock.prototype.removeAllMouseOverReactions=function(){for(;this.mouseOverReactions.length>0;)this.removeMouseOverReaction(this.mouseOverReactions[0])},ActorBlock.prototype.removeAllMouseOverReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllMouseOverReactions()},ActorBlock.prototype.addMouseOutReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),CANVASMANAGER.mouseMoveEvent.subscribe(this);var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.mouseOutReactions.length;e++)if(c==this.mouseOutReactions[e].reactionName){d=e;break}if(-1==d){var f=a.bind(b);f.reactionName=c,this.mouseOutReactions.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addMouseOutReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addMouseOutReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeMouseOutReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.reactionName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.mouseOutReactions.length;d++)if(b==this.mouseOutReactions[d].reactionName){c=d;break}if(c>-1){this.mouseOutReactions.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}0==this.mouseOverReactions.length&&0==this.mouseOutReactions.length&&0==this.mouseMoveReactions.length&&CANVASMANAGER.mouseMoveEvent.unsubscribe(this)},ActorBlock.prototype.removeMouseOutReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeMouseOutReaction(a)},ActorBlock.prototype.removeAllMouseOutReactions=function(){for(;this.mouseOutReactions.length>0;)this.removeMouseOutReaction(this.mouseOutReactions[0])},ActorBlock.prototype.removeAllMouseOutReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllMouseOutReactions()},ActorBlock.prototype.addMouseMoveReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),CANVASMANAGER.mouseMoveEvent.subscribe(this);var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.mouseMoveReactions.length;e++)if(c==this.mouseMoveReactions[e].reactionName){d=e;break}if(-1==d){var f=a.bind(b);f.reactionName=c,this.mouseMoveReactions.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addMouseMoveReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addMouseMoveReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeMouseMoveReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.reactionName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.mouseMoveReactions.length;d++)if(b==this.mouseMoveReactions[d].reactionName){c=d;break}if(c>-1){this.mouseMoveReactions.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}0==this.mouseOverReactions.length&&0==this.mouseOutReactions.length&&0==this.mouseMoveReactions.length&&CANVASMANAGER.mouseMoveEvent.unsubscribe(this)},ActorBlock.prototype.removeMouseMoveReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeMouseMoveReaction(a)},ActorBlock.prototype.removeAllMouseOverReactions=function(){for(;this.mouseOverReactions.length>0;)this.removeMouseOverReaction(this.mouseOverReactions[0])},ActorBlock.prototype.removeAllMouseOverReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllMouseMoveReactions()},ActorBlock.prototype.reactToMouseClickEvent=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),this.isMouseEventWithinBlock(a)){for(var b=0;b<this.mouseClickReactions.length;b++)this.mouseClickReactions[b](this,a);return!0}return!1},ActorBlock.prototype.addMouseClickReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),CANVASMANAGER.mouseClickEvent.subscribe(this);var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.mouseClickReactions.length;e++)if(c==this.mouseClickReactions[e].reactionName){d=e;break}if(-1==d){var f=a.bind(b);f.reactionName=c,this.mouseClickReactions.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addMouseClickReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addMouseClickReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeMouseClickReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.reactionName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.mouseClickReactions.length;d++)if(b==this.mouseClickReactions[d].reactionName){c=d;break}if(c>-1){this.mouseClickReactions.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}0==this.mouseClickReactions.length&&CANVASMANAGER.mouseClickEvent.unsubscribe(this)},ActorBlock.prototype.removeMouseClickReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeMouseClickReaction(a)},ActorBlock.prototype.removeAllMouseClickReactions=function(){for(;this.mouseClickReactions.length>0;)this.removeMouseClickReaction(this.mouseClickReactions[0])},ActorBlock.prototype.removeAllMouseClickReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllMouseClickReactions},ActorBlock.prototype.reactToMouseDownEvent=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),this.isMouseEventWithinBlock(a)){for(var b=0;b<this.mouseDownReactions.length;b++)this.mouseDownReactions[b](this,a);return!0}return!1},ActorBlock.prototype.addMouseDownReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),CANVASMANAGER.mouseDownEvent.subscribe(this);var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.mouseDownReactions.length;e++)if(c==this.mouseDownReactions[e].reactionName){d=e;break}if(-1==d){var f=a.bind(b);f.reactionName=c,this.mouseDownReactions.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addMouseDownReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addMouseDownReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeMouseDownReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.reactionName;b||(b=COMMON.getFunctionName(a));for(var c=-1,d=0;d<this.mouseDownReactions.length;d++)if(b==this.mouseDownReactions[d].reactionName){c=d;break}if(c>-1){this.mouseDownReactions.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}0==this.mouseDownReactions.length&&CANVASMANAGER.mouseDownEvent.unsubscribe(this)},ActorBlock.prototype.removeMouseDownReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeMouseDownReaction(a)},ActorBlock.prototype.removeAllMouseDownReactions=function(){for(;this.mouseDownReactions.length>0;)this.removeMouseDownReaction(this.mouseDownReactions[0])},ActorBlock.prototype.removeAllMouseDownReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllMouseDownReactions()},ActorBlock.prototype.reactToMouseUpEvent=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),this.isMouseEventWithinBlock(a)){for(var b=0;b<this.mouseUpReactions.length;b++)this.mouseUpReactions[b](this,a);return!0}return!1},ActorBlock.prototype.addMouseUpReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),CANVASMANAGER.mouseUpEvent.subscribe(this);var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.mouseUpReactions.length;e++)if(c==this.mouseUpReactions[e].reactionName){d=e;break}if(-1==d){var f=a.bind(b);f.reactionName=c,this.mouseUpReactions.push(f),void 0!=b&&(this.behaviorVars[c]=b)}},ActorBlock.prototype.addMouseUpReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addMouseUpReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeMouseUpReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=a.reactionName;b||(b=getFunctionName(a));for(var c=-1,d=0;d<this.mouseUpReactions.length;d++)if(b==this.mouseUpReactions[d].reactionName){c=d;break}if(c>-1){this.mouseUpReactions.splice(c,1);for(var e in this.behaviorVars[b])delete this.behaviorVars[b][e];delete this.behaviorVars[b]}0==this.mouseUpReactions.length&&CANVASMANAGER.mouseUpEvent.unsubscribe(this)},ActorBlock.prototype.removeMouseUpReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeMouseUpReaction(a)},ActorBlock.prototype.removeAllMouseUpReactions=function(){for(;this.mouseUpReactions.length>0;)this.removeMouseUpReaction(this.mouseUpReactions[0])},ActorBlock.prototype.removeAllMouseUpReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllMouseUpReactions()},ActorBlock.prototype.removeAllMouseReactions=function(){this.removeAllMouseOverReactions(),this.removeAllMouseOutReactions(),this.removeAllMouseClickReactions(),this.removeAllMouseDownReactions(),this.removeAllMouseUpReactions()},ActorBlock.prototype.removeAllMouseReactionsFromChildren=function(){this.removeAllMouseOverReactionsFromChildren(),this.removeAllMouseOutReactionsFromChildren(),this.removeAllMouseClickReactionsFromChildren(),this.removeAllMouseDownReactionsFromChildren(),this.removeAllMouseUpReactionsFromChildren()},ActorBlock.prototype.reactToKeyPressEvent=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.KEYBOARDEVENT,a),b=PARAMS.validateParam(PARAMS.STRING,b),void 0!=this.keyPressReactions[b]){for(var c=0;c<this.keyPressReactions[b].length;c++)this.keyPressReactions[b][c](this,a);
return!0}return!1},ActorBlock.prototype.addAnyKeyPressReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);var c=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);CANVASMANAGER.keyboardEvent.subscribeToKeyPress(this,KEYCODES.ANYKEY);var d=a.reactionName;d||(d=COMMON.getFunctionName(a)),void 0==this.keyPressReactions[c]&&(this.keyPressReactions[c]=new Array);for(var e=-1,f=0;f<this.keyPressReactions[c].length;f++)if(d==this.keyPressReactions[c][f].reactionName){e=f;break}if(-1==e){var g=a.bind(b);g.reactionName=d,this.keyPressReactions[c].push(g),void 0!=b&&(this.behaviorVars[d]=b)}},ActorBlock.prototype.addAnyKeyPressReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addAnyKeyPressReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeAnyKeyPressReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);if(void 0!=this.keyPressReactions[b]){var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.keyPressReactions[b].length;e++)if(c==this.keyPressReactions[b][e].reactionName){d=e;break}if(d>-1){this.keyPressReactions[b].splice(d,1);for(var f in this.behaviorVars[c])delete this.behaviorVars[c][f];delete this.behaviorVars[c]}}},ActorBlock.prototype.removeAnyKeyPressReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAnyKeyPressReaction(a)},ActorBlock.prototype.reactToKeyDownEvent=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.KEYBOARDEVENT,a),b=PARAMS.validateParam(PARAMS.STRING,b),void 0!=this.keyDownReactions[b]){for(var c=0;c<this.keyDownReactions[b].length;c++)this.keyDownReactions[b][c](this,a);return!0}return!1},ActorBlock.prototype.addAnyKeyDownReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);var c=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);CANVASMANAGER.keyboardEvent.subscribeToKeyDown(this,KEYCODES.ANYKEY);var d=a.reactionName;d||(d=COMMON.getFunctionName(a)),void 0==this.keyDownReactions[c]&&(this.keyDownReactions[c]=new Array);for(var e=-1,f=0;f<this.keyDownReactions[c].length;f++)if(d==this.keyDownReactions[c][f].reactionName){e=f;break}if(-1==e){var g=a.bind(b);g.reactionName=d,this.keyDownReactions[c].push(g),void 0!=b&&(this.behaviorVars[d]=b)}},ActorBlock.prototype.addAnyKeyDownReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addAnyKeyDownReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeAnyKeyDownReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);if(void 0!=this.keyDownReactions[b]){var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.keyDownReactions[b].length;e++)if(c==this.keyDownReactions[b][e].reactionName){d=e;break}if(d>-1){this.keyDownReactions[b].splice(d,1);for(var f in this.behaviorVars[c])delete this.behaviorVars[c][f];delete this.behaviorVars[c]}}},ActorBlock.prototype.removeAnyKeyDownReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAnyKeyDownReaction(a)},ActorBlock.prototype.reactToKeyUpEvent=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.KEYBOARDEVENT,a),b=PARAMS.validateParam(PARAMS.STRING,b),void 0!=this.keyUpReactions[b]){for(var c=0;c<this.keyUpReactions[b].length;c++)this.keyUpReactions[b][c](this,a);return!0}return!1},ActorBlock.prototype.addAnyKeyUpReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);var c=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);CANVASMANAGER.keyboardEvent.subscribeToKeyUp(this,KEYCODES.ANYKEY);var d=a.reactionName;d||(d=COMMON.getFunctionName(a)),void 0==this.keyUpReactions[c]&&(this.keyUpReactions[c]=new Array);for(var e=-1,f=0;f<this.keyUpReactions[c].length;f++)if(d==this.keyUpReactions[c][f].reactionName){e=f;break}if(-1==e){var g=a.bind(b);g.reactionName=d,this.keyUpReactions[c].push(g),void 0!=b&&(this.behaviorVars[d]=b)}},ActorBlock.prototype.addAnyKeyUpReactionToChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b);for(var c=0;c<this.children.length;c++)this.children[c].addAnyKeyUpReaction(a,COMMON.extend(b,{}))},ActorBlock.prototype.removeAnyKeyUpReaction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);var b=KEYCODES.getStringFromKeyCode(KEYCODES.ANYKEY);if(void 0!=this.keyUpReactions[b]){var c=a.reactionName;c||(c=COMMON.getFunctionName(a));for(var d=-1,e=0;e<this.keyUpReactions[b].length;e++)if(c==this.keyUpReactions[b][e].reactionName){d=e;break}if(d>-1){this.keyUpReactions[b].splice(d,1);for(var f in this.behaviorVars[c])delete this.behaviorVars[c][f];delete this.behaviorVars[c]}}},ActorBlock.prototype.removeAnyKeyUpReactionFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAnyKeyUpReaction(a)},ActorBlock.prototype.addKeyPressReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);var d=KEYCODES.getStringFromKeyCode(a);CANVASMANAGER.keyboardEvent.subscribeToKeyPress(this,a);var e=b.reactionName;e||(e=COMMON.getFunctionName(b)),void 0==this.keyPressReactions[d]&&(this.keyPressReactions[d]=new Array);for(var f=-1,g=0;g<this.keyPressReactions[d].length;g++)if(e==this.keyPressReactions[d][g].reactionName){f=g;break}if(-1==f){var h=b.bind(c);h.reactionName=e,this.keyPressReactions[d].push(h),void 0!=c&&(this.behaviorVars[e]=c)}},ActorBlock.prototype.addKeyPressReactionToChildren=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);for(var d=0;d<this.children.length;d++)this.children[d].addKeyPressReaction(a,b,COMMON.extend(c,{}))},ActorBlock.prototype.removeKeyPressReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);var c=KEYCODES.getStringFromKeyCode(a);if(void 0!=this.keyPressReactions[c]){var d=b.reactionName;d||(d=COMMON.getFunctionName(b));for(var e=-1,f=0;f<this.keyPressReactions[c].length;f++)if(d==this.keyPressReactions[c][f].reactionName){e=f;break}if(e>-1){this.keyPressReactions[c].splice(e,1);for(var g in this.behaviorVars[d])delete this.behaviorVars[d][g];delete this.behaviorVars[d]}}},ActorBlock.prototype.removeKeyPressReactionFromChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);for(var c=0;c<this.children.length;c++)this.children[c].removeKeyPressReaction(a,b)},ActorBlock.prototype.removeAllKeyPressReactionsForKeyCode=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=KEYCODES.getStringFromKeyCode(a);this.keyPressReactions[b].length>0;)this.removeKeyPressReaction(a,this.keyPressReactions[b][0])},ActorBlock.prototype.removeAllKeyPressReactionsForKeyCodeFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAllKeyPressReactionsForKeyCode(a)},ActorBlock.prototype.removeAllKeyPressReactions=function(){for(var a in this.keyPressReactions)this.removeAllKeyPressReactionsForKeyCode(KEYCODES.getKeyCodeFromString(a))},ActorBlock.prototype.removeAllKeyPressReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllKeyPressReactions()},ActorBlock.prototype.addKeyDownReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);var d=KEYCODES.getStringFromKeyCode(a);CANVASMANAGER.keyboardEvent.subscribeToKeyDown(this,a);var e=b.reactionName;e||(e=COMMON.getFunctionName(b)),void 0==this.keyDownReactions[d]&&(this.keyDownReactions[d]=new Array);for(var f=-1,g=0;g<this.keyDownReactions[d].length;g++)if(e==this.keyDownReactions[d][g].reactionName){f=g;break}if(-1==f){var h=b.bind(c);h.reactionName=e,this.keyDownReactions[d].push(h),void 0!=c&&(this.behaviorVars[e]=c)}},ActorBlock.prototype.addKeyDownReactionToChildren=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);for(var d=0;d<this.children.length;d++)this.children[d].addKeyDownReaction(a,b,COMMON.extend(c,{}))},ActorBlock.prototype.removeKeyDownReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);var c=KEYCODES.getStringFromKeyCode(a);if(void 0!=this.keyDownReactions[c]){var d=b.reactionName;d||(d=COMMON.getFunctionName(b));for(var e=-1,f=0;f<this.keyDownReactions[c].length;f++)if(d==this.keyDownReactions[c][f].reactionName){e=f;break}if(e>-1){this.keyDownReactions[c].splice(e,1);for(var g in this.behaviorVars[d])delete this.behaviorVars[d][g];delete this.behaviorVars[d]}}},ActorBlock.prototype.removeKeyDownReactionFromChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);for(var c=0;c<this.children.length;c++)this.children[c].removeKeyDownReaction(a,b)},ActorBlock.prototype.removeAllKeyDownReactionsForKeyCode=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=KEYCODES.getStringFromKeyCode(a);this.keyDownReactions[b].length>0;)this.removeKeyDownReaction(a,this.keyDownReactions[b][0])},ActorBlock.prototype.removeAllKeyDownReactionsForKeyCodeFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAllKeyDownReactionsForKeyCode(a)},ActorBlock.prototype.removeAllKeyDownReactions=function(){for(var a in this.keyDownReactions)1==a.length&&this.removeAllKeyDownReactionsForKeyCode(KEYCODES.getKeyCodeFromString(a))},ActorBlock.prototype.removeAllKeyDownReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllKeyDownReactions()},ActorBlock.prototype.addKeyUpReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);var d=KEYCODES.getStringFromKeyCode(a);CANVASMANAGER.keyboardEvent.subscribeToKeyUp(this,a);var e=b.reactionName;e||(e=COMMON.getFunctionName(b)),void 0==this.keyUpReactions[d]&&(this.keyUpReactions[d]=new Array);for(var f=-1,g=0;g<this.keyUpReactions[d].length;g++)if(e==this.keyUpReactions[d][g].reactionName){f=g;break}if(-1==f){var h=b.bind(c);h.reactionName=e,this.keyUpReactions[d].push(h),void 0!=c&&(this.behaviorVars[e]=c)}},ActorBlock.prototype.addKeyUpReactionToChildren=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);for(var d=0;d<this.children.length;d++)this.children[d].addKeyUpReaction(a,b,COMMON.extend(c,{}))},ActorBlock.prototype.removeKeyUpReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);var c=KEYCODES.getStringFromKeyCode(a);if(void 0!=this.keyUpReactions[c]){var d=b.reactionName;d||(d=COMMON.getFunctionName(b));for(var e=-1,f=0;f<this.keyUpReactions[c].length;f++)if(d==this.keyUpReactions[c][f].reactionName){e=f;break}if(e>-1){this.keyUpReactions[c].splice(e,1);for(var g in this.behaviorVars[d])delete this.behaviorVars[d][g];delete this.behaviorVars[d]}}},ActorBlock.prototype.removeKeyUpReactionFromChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);for(var c=0;c<this.children.length;c++)this.children[c].removeKeyUpReaction(a,b)},ActorBlock.prototype.removeAllKeyUpReactionsForKeyCode=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=KEYCODES.getStringFromKeyCode(a);this.keyUpReactions[b].length>0;)this.removeKeyUpReaction(a,this.keyUpReactions[b][0])},ActorBlock.prototype.removeAllKeyUpReactionsForKeyCodeFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAllKeyUpReactionsForKeyCode(a)},ActorBlock.prototype.removeAllKeyUpReactions=function(){for(var a in this.keyUpReactions)this.removeAllKeyUpReactionsForKeyCode(KEYCODES.getKeyCodeFromString(a))},ActorBlock.prototype.removeAllKeyUpReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllKeyUpReactions()},ActorBlock.prototype.addKeyCombinationReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);var d=KEYCODES.getStringFromKeyCodes(a);CANVASMANAGER.keyboardEvent.subscribeToKeyCombination(this,a);var e=b.reactionName;e||(e=COMMON.getFunctionName(b)),void 0==this.keyDownReactions[d]&&(this.keyDownReactions[d]=new Array);for(var f=-1,g=0;g<this.keyDownReactions[d].length;g++)if(e==this.keyDownReactions[d][g].reactionName){f=g;break}if(-1==f){var h=b.bind(c);h.reactionName=e,this.keyDownReactions[d].push(h),void 0!=c&&(this.behaviorVars[e]=c)}},ActorBlock.prototype.addKeyCombinationReactionToChildren=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c);for(var d=0;d<this.children.length;d++)this.children[d].addKeyCombinationReaction(a,b,COMMON.extend(c,{}))},ActorBlock.prototype.removeKeyCombinationReaction=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);var c=KEYCODES.getStringFromKeyCodes(a);if(void 0!=this.keyDownReactions[c]){var d=b.reactionName;d||(d=COMMON.getFunctionName(b));for(var e=-1,f=0;f<this.keyDownReactions[c].length;f++)if(d==this.keyDownReactions[c][f].reactionName){e=f;break}if(e>-1){this.keyDownReactions[c].splice(e,1);for(var g in this.behaviorVars[d])delete this.behaviorVars[d][g];delete this.behaviorVars[d]}}},ActorBlock.prototype.removeKeyCombinationReactionFromChildren=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b);for(var c=0;c<this.children.length;c++)this.children[c].removeKeyCombinationReaction(a,b)},ActorBlock.prototype.removeAllKeyCombinationReactionsForKeyCodes=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,a);for(var b=KEYCODES.getStringFromKeyCode(a);this.keyDownReactions[b].length>0;)this.removeKeyCombinationReaction(a,this.keyDownReactions[b][0])},ActorBlock.prototype.removeAllKeyCombinationReactionsForKeyCodesFromChildren=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,a);for(var b=0;b<this.children.length;b++)this.children[b].removeAllKeyCombinationReactionsForKeyCodes(a)},ActorBlock.prototype.removeAllKeyCombinationReactions=function(){for(var a in this.keyDownReactions)a.length>1&&this.removeAllKeyCombinationReactionsForKeyCodes(KEYCODES.getKeyCodesFromString(a))},ActorBlock.prototype.removeAllKeyCombinationReactionsFromChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeAllKeyCombinationReactions()},ActorBlock.prototype.removeAllKeyReactions=function(){this.removeAllKeyPressReactions(),this.removeAllKeyDownReactions(),this.removeAllKeyUpReactions(),this.removeAllKeyCombinationReactions()},ActorBlock.prototype.removeAllKeyReactionsFromChildren=function(){this.removeAllKeyPressReactionsFromChildren(),this.removeAllKeyDownReactionsFromChildren(),this.removeAllKeyUpReactionsFromChildren(),this.removeAllKeyCombinationReactionsFromChildren()},ActorBlock.prototype.removeAllReactions=function(){this.removeAllMouseReactions(),this.removeAllKeyReactions()},ActorBlock.prototype.removeAllReactionsFromChildren=function(){this.removeAllMouseReactionsFromChildren(),this.removeAllKeyReactionsFromChildren()},ActorBlock.prototype.destroy=function(){if(this.isMarkedForDestruction){this.xvel=void 0,this.yvel=void 0,this.zvel=void 0,this.xacc=void 0,this.yacc=void 0,this.zacc=void 0,this.rotationVel=void 0,this.rotationAcc=void 0,this.removeAllBehaviors(),this.behaviors=void 0,this.behaviorVars=void 0,this.removeAllConstraints(),this.constraints=void 0,this.constraintVars=void 0,this.isMouseOver=void 0,this.removeAllReactions(),this.mouseOverReactions=void 0,this.mouseOutReactions=void 0,this.mouseClickReactions=void 0,this.mouseDownReactions=void 0,this.mouseUpReactions=void 0,this.keyPressReactions=void 0,this.keyDownReactions=void 0,this.keyUpReactions=void 0,CANVASMANAGER.mouseMoveEvent.unsubscribe(this),CANVASMANAGER.mouseClickEvent.unsubscribe(this),CANVASMANAGER.mouseUpEvent.unsubscribe(this),CANVASMANAGER.mouseDownEvent.unsubscribe(this),CANVASMANAGER.keyboardEvent.unsubscribe(this),this.awake=void 0,this.memoryCapacity=void 0,this.oldestMemoryIndex=void 0,this.currentMemoryIndex=void 0;for(var a=0;a<this.memories.length;a++)this.forgetMemory(this.memories[a]);this.memories.splice(0,this.memories.length),this.memories=void 0}Block.prototype.destroy.call(this)};var PlayerTraits=function(){};PlayerTraits.prototype=new Traits,PlayerTraits.prototype.play=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'play' function.")},PlayerTraits.prototype.pause=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'pause' function.")},PlayerTraits.prototype.unpause=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'unpause' function.")},PlayerTraits.prototype.playPause=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'playPause' function.")},PlayerTraits.prototype.stop=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'stop' function.")},PlayerTraits.prototype.getVolume=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'getVolume' function.")},PlayerTraits.prototype.setVolume=function(){throw new Error("Block has learned PlayerTraits, but hasn't implemented the 'setVolume' function.")};var ShatterTraits=function(){var a=!1,b=0;this._getShattered=function(){return a},this._setShattered=function(c){a=c,b++},this.shattered=a};ShatterTraits.prototype=new Traits,ShatterTraits.prototype.getCurrentFrame=function(){throw new Error("Block has learned ShatterTraits, but hasn't implemented the 'getCurrentFrame' function.")},ShatterTraits.prototype.shatter=function(a,b,c){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b,this.width),c=PARAMS.validateParam(PARAMS.INTEGER,c,this.height),!this.shattered){for(var d=new Array,e=0,f=0;b>f;f+=a)for(var g=0;c>g;g+=a)void 0==d[e]&&(d[e]={x:Math.floor(f-b/2+a/2),y:Math.floor(g-c/2+a/2)}),e++;for(var f=0;f<d.length;f++){var h=new FragmentBlock(this,a,a,d[f].x,d[f].y,0);h.setMemoryCapacity(this.memoryCapacity),this.adoptChild(h)}this.shattered=!0}},ShatterTraits.prototype.unshatter=function(){for(var a=0;a<this.children.length;a++)this.children[a]instanceof FragmentBlock&&(this.children[a].destroy(),this.children.splice(a,1),a--);this.shattered=!1};var CanvasTraits=function(){};CanvasTraits.prototype=new Traits,CanvasTraits.prototype.parseCanvasCommands=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a),b=PARAMS.validateParam(PARAMS.ARRAYOFOBJECT,b);for(var c=0,d=0,e=0;e<b.length;e++){var f=b[e].command,g=b[e].parameters;switch(f){case"arc":5==g.length?(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.arc(g[0],g[1],g[2],g[3],g[4])):6==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.BOOLEAN],g),a.arc(g[0],g[1],g[2],g[3],g[4],g[5]));break;case"arcTo":5==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.arcTo(g[0],g[1],g[2],g[3],g[4]));break;case"beginPath":a.beginPath();break;case"bezierCurveTo":6==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5]));break;case"clearRect":4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.clearRect(g[0]-1,g[1]-1,g[2]+2,g[3]+2));break;case"clip":a.clip();break;case"closePath":a.closePath();break;case"createImageData":break;case"createLinearGradient":break;case"createPattern":break;case"createRadialGradient":break;case"drawCustomFocusRing":break;case"drawImage":3==g.length?(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.OBJECT,PARAMS.NUMBER,PARAMS.NUMBER],g),a.drawImage(g[0],g[1],g[2])):5==g.length?(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.OBJECT,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.drawImage(g[0],g[1],g[2],g[3],g[4])):9==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.OBJECT,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.drawImage(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8]));break;case"drawSystemFocusRing":break;case"fill":a.fill();break;case"fillRect":4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.fillRect(g[0],g[1],g[2],g[3]));break;case"fillText":3==g.length?(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING,PARAMS.NUMBER,PARAMS.NUMBER],g),a.fillText(g[0],g[1],g[2])):4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.fillText(g[0],g[1],g[2],g[3]));break;case"getImageData":break;case"getLineDash":break;case"isPointInPath":break;case"isPointInStroke":break;case"lineTo":2==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER],g),a.lineTo(g[0],g[1]));break;case"measureText":break;case"moveTo":2==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER],g),a.moveTo(g[0],g[1]));break;case"putImageData":3==g.length?(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.OBJECT,PARAMS.NUMBER,PARAMS.NUMBER],g),a.putImageData(g[0],g[1],g[2])):7==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.OBJECT,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER],g),a.putImageData(g[0],g[1],g[2],g[3],g[4],g[5],g[6]));break;case"quadraticCurveTo":4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.putImageData(g[0],g[1],g[2],g[3]));break;case"rect":4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.rect(g[0],g[1],g[2],g[3]));break;case"restore":c>d&&(a.restore(),d++);break;case"rotate":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.rotate(g[0]));break;case"save":a.save(),c++;break;case"scale":2==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER],g),a.scale(g[0],g[1]));break;case"scrollPathIntoView":break;case"setFillStyle":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.fillStyle=g[0]);break;case"setFont":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.font=g[0]);break;case"setGlobalAlpha":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.globalAlpha=g[0]);break;case"setGlobalCompositeOperation":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.globalCompositeOperation=g[0]);break;case"setLineCap":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.lineCap=g[0]);break;case"setLineDashOffset":break;case"setLineJoin":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.lineJoin=g[0]);break;case"setLineWidth":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.lineWidth=g[0]);break;case"setMiterLimit":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.miterLimit=g[0]);break;case"setShadowBlur":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.shadowBlur=g[0]);break;case"setShadowOffsetX":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.shadowOffsetX=g[0]);break;case"setShadowOffsetY":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER],g),a.shadowOffsetY=g[0]);break;case"setStrokeStyle":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.strokeStyle=g[0]);break;case"setTextAlign":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.textAlign=g[0]);break;case"setTextBaseline":1==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING],g),a.textBaseline=g[0]);break;case"setLineDash":break;case"setTransform":6==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.setTransform(g[0],g[1],g[2],g[3],g[4],g[5]));break;case"stroke":a.stroke();break;case"strokeRect":4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.strokeRect(g[0],g[1],g[2],g[3]));break;case"strokeText":3==g.length?(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING,PARAMS.NUMBER,PARAMS.NUMBER],g),a.strokeText(g[0],g[1],g[2])):4==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.STRING,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.strokeText(g[0],g[1],g[2],g[3]));break;case"transform":6==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER,PARAMS.NUMBER],g),a.transform(g[0],g[1],g[2],g[3],g[4],g[5]));break;case"translate":2==g.length&&(PARAMS.initializeValidation(f),PARAMS.validateArguments([PARAMS.NUMBER,PARAMS.NUMBER],g),a.translate(g[0],g[1]))}}if(c>d)for(var e=0;c-d>e;e++)a.restore()};var FragmentBlock=function(a,b,c,d,e,f){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.BLOCK,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER],arguments),LOG.write("FragmentBlock constructor called",LOG.VERBOSE),ActorBlock.call(this),this.sourceBlock=a;var g=0,h=0,i=0,j=!1;this._getHomeX=function(){return g},this._getHomeY=function(){return h},this._getHomeZ=function(){return i},this._getShattered=function(){return j},this._setHomeX=function(a){g=a},this._setHomeY=function(a){h=a},this._setHomeZ=function(a){i=a},this._setShattered=function(a){j=a},this.width=b,this.height=c,this.x=d,this.y=e,this.z=f,this.homeX=d,this.homeY=e,this.homeZ=f,this.shattered=!1};FragmentBlock.prototype=new ActorBlock,FragmentBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.homeX=this._getHomeX(),a.homeY=this._getHomeY(),a.homeZ=this._getHomeZ(),a},FragmentBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.homeX=a.homeX,this.homeY=a.homeY,this.homeZ=a.homeZ},FragmentBlock.prototype.hasChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(a.homeX==this.homeX&&a.homeY==this.homeY&&a.homeZ==this.homeZ)},FragmentBlock.prototype.shatter=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),a>this.width||a>this.height)return void LOG.write("Tried to shatter FragmentBlock into blocks of size: "+a+", but FragmentBlock only has a width of "+this.width+".",LOG.WARN);if(!this.shattered){for(var b=new Array,c=this.width,d=this.height,e=0;c>e;e+=a)for(var f=0;d>f;f+=a)b.push({x:Math.floor(e-c/2+a/2),y:Math.floor(f-d/2+a/2)});for(var e=0;e<b.length;e++){var g=new FragmentBlock(this.sourceBlock,a,a,b[e].x,b[e].y,0);g.setMemoryCapacity(this.memoryCapacity),this.adoptChild(g)}this.shattered=!0}},FragmentBlock.prototype.unshatter=function(){for(var a=0;a<this.children.length;a++)this.children[a]instanceof FragmentBlock&&(this.children[a].destroy(),this.children.splice(a,1),a--);this.shattered=!1},FragmentBlock.prototype.getCurrentFrameFromSourceBlock=function(){return this.sourceBlock?this.sourceBlock.getCurrentFrameFromSourceBlock?this.sourceBlock.getCurrentFrameFromSourceBlock():this.sourceBlock.getCurrentFrame():null},FragmentBlock.prototype.undraw=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a),this.sourceBlock){var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2);for(var e=0;e<this.children.length;e++)this.children[e].undraw(a);a.restore()}}catch(f){LOG.write("error in FragmentBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}}},FragmentBlock.prototype.update=function(){ActorBlock.prototype.update.call(this),this._setHomeX(this.homeX),this._setHomeY(this.homeY),this._setHomeZ(this.homeZ),this._setShattered(this.shattered)},FragmentBlock.prototype.draw=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a),this.sourceBlock){var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();if(b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),!this.shattered){var e=this.getCurrentFrameFromSourceBlock();null!=e&&a.drawImage(e,(this.getWidthInSourceBlock()-this._getWidth()/2)/this.getHorizontalVideoScalingInSourceBlock(),(this.getHeightInSourceBlock()-this._getHeight()/2)/this.getVerticalVideoScalingInSourceBlock(),this._getWidth()/this.getHorizontalVideoScalingInSourceBlock(),this._getHeight()/this.getVerticalVideoScalingInSourceBlock(),-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight())
}this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var f=0;f<this.children.length;f++)this.children[f].draw(a);a.restore()}}catch(g){LOG.write("error in FragmentBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(g,LOG.ERROR)}}},FragmentBlock.prototype.getWidthInSourceBlock=function(){return this.sourceBlock?this.sourceBlock.getWidthInSourceBlock?this.sourceBlock.getWidthInSourceBlock()+this._getHomeX():this.sourceBlock._getWidth()/2+this._getHomeX():this._getWidth()/2},FragmentBlock.prototype.getHeightInSourceBlock=function(){return this.sourceBlock?this.sourceBlock.getHeightInSourceBlock?this.sourceBlock.getHeightInSourceBlock()+this._getHomeY():this.sourceBlock._getHeight()/2+this._getHomeY():this._getHeight()/2},FragmentBlock.prototype.getHorizontalVideoScalingInSourceBlock=function(){return this.sourceBlock?this.sourceBlock.getHorizontalVideoScalingInSourceBlock?this.sourceBlock.getHorizontalVideoScalingInSourceBlock():this.sourceBlock.getHorizontalVideoScaling?this.sourceBlock.getHorizontalVideoScaling():1:1},FragmentBlock.prototype.getVerticalVideoScalingInSourceBlock=function(){return this.sourceBlock?this.sourceBlock.getVerticalVideoScalingInSourceBlock?this.sourceBlock.getVerticalVideoScalingInSourceBlock():this.sourceBlock.getVerticalVideoScaling?this.sourceBlock.getVerticalVideoScaling():1:1},FragmentBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.sourceBlock=void 0,this._setHomeX(void 0),this._setHomeY(void 0),this._setHomeZ(void 0),this.homeX=void 0,this.homeY=void 0,this.homeZ=void 0,this._setShattered(void 0),this.shattered=void 0),ActorBlock.prototype.destroy.call(this)};var PlayerBlock=function(){LOG.write("PlayerBlock constructor called",LOG.VERBOSE),ActorBlock.call(this)};PlayerBlock.prototype=new ActorBlock,PlayerBlock.prototype.play=function(){},PlayerBlock.prototype.pause=function(){},PlayerBlock.prototype.unpause=function(){},PlayerBlock.prototype.playPause=function(){},PlayerBlock.prototype.stop=function(){},PlayerBlock.prototype.getVolume=function(){},PlayerBlock.prototype.setVolume=function(){},PlayerBlock.prototype.destroy=function(){ActorBlock.prototype.destroy.call(this)};var SoundBlock=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),LOG.write("SoundBlock constructor called",LOG.VERBOSE),PlayerBlock.call(this),this.track=CANVASMANAGER.getAudioAsset(a)};SoundBlock.prototype=new PlayerBlock,SoundBlock.prototype.play=function(){this.track.play()},SoundBlock.prototype.pause=function(){this.track.pause()},SoundBlock.prototype.unpause=function(){this.track.unpause()},SoundBlock.prototype.playPause=function(){this.track.playPause()},SoundBlock.prototype.stop=function(){this.track.play(),this.track.pause()},SoundBlock.prototype.getVolume=function(){return this.track.getVolume()},SoundBlock.prototype.setVolume=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,a),this.track.setVolume(a)},SoundBlock.prototype.setLooping=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a),this.track.setLooping(a)};var StereoBlock=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments),LOG.write("SoundBlock constructor called",LOG.VERBOSE),PlayerBlock.call(this),this.tracks=new Array;for(var a=0;a<arguments.length;a++){var b=CANVASMANAGER.getAudioAsset(arguments[a]);null!=b&&this.tracks.push(b)}this.currentTrackIndex=0,this.volume=100,this.looping=!1};StereoBlock.prototype=new PlayerBlock,StereoBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.currentTrackIndex=this.currentTrackIndex,a},StereoBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.currentTrackIndex=a.currentTrackIndex},StereoBlock.prototype.hasChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(a.currentTrackIndex==this.currentTrackIndex)},StereoBlock.prototype.getTrack=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a);for(var b=0;b<this.tracks.length;b++)if(this.tracks[b].getName()==a)return this.tracks[b];return null},StereoBlock.prototype.getTrackIndex=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a);for(var b=0;b<this.tracks.length;b++)if(this.tracks[b].getName()==a)return b;return-1},StereoBlock.prototype.play=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),null!=a){var b=this.getTrackIndex(a);b>=0&&b!=this.currentTrackIndex&&(this.stop(),this.currentTrackIndex=b)}this.tracks[this.currentTrackIndex].play()},StereoBlock.prototype.pause=function(){this.tracks[this.currentTrackIndex].pause()},StereoBlock.prototype.unpause=function(){this.tracks[this.currentTrackIndex].unpause()},StereoBlock.prototype.playPause=function(){this.tracks[this.currentTrackIndex].playPause()},StereoBlock.prototype.stop=function(){this.tracks[this.currentTrackIndex].play(),this.tracks[this.currentTrackIndex].pause()},StereoBlock.prototype.getVolume=function(){return this.volume},StereoBlock.prototype.setVolume=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,a),this.volume=a;for(var b=0;b<this.tracks.length;b++)this.tracks[b].setVolume(this.volume)},StereoBlock.prototype.setLooping=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a),this.looping=a;for(var b=0;b<this.tracks.length;b++)this.tracks[b].setLooping(this.looping)};var MovieBlock=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments),LOG.write("MovieBlock constructor called",LOG.VERBOSE),PlayerBlock.call(this),this.frameAliases=new Array;for(var a=0;a<arguments.length;a++)this.frameAliases[a]=arguments[a];this.frames=new Array,this.filters=new Array,this.windowMasks=new Array,this.wallMasks=new Array,this.filtersUpdate=!1,this.masksUpdate=!1,this.isPlaying=!0,this.currentFrameIndex=-1,this.maskMode="none"};MovieBlock.prototype=new ActorBlock,MovieBlock.prototype.learn(PlayerTraits),MovieBlock.prototype.learn(ShatterTraits),MovieBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.currentFrameIndex=this.currentFrameIndex,a},MovieBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.currentFrameIndex=a.currentFrameIndex},MovieBlock.prototype.hasChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(a.currentFrameIndex==this.currentFrameIndex)},MovieBlock.prototype.shatter=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);for(var b=0,c=0,d=this.frameAliases.length,e=0;d>e;e++){var f=this.getFrame(e);f.width>b&&(b=f.width),f.height>c&&(c=f.height)}ShatterTraits.prototype.shatter.call(this,a,b,c)},MovieBlock.prototype.getCurrentFrame=function(){return this.currentFrameIndex>=0&&(this.currentFrameIndex<this.frames.length||this.currentFrameIndex<this.frameAliases.length)?null!=this.frames[this.currentFrameIndex]?this.frames[this.currentFrameIndex]:CANVASMANAGER.getSingleImageAsset(this.frameAliases[this.currentFrameIndex]):null},MovieBlock.prototype.getFrame=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),a>=0&&(a<this.frames.length||a<this.frameAliases.length)?null!=this.frames[a]?this.frames[a]:CANVASMANAGER.getSingleImageAsset(this.frameAliases[a]):null},MovieBlock.prototype.play=function(){this.isPlaying=!0,this.currentFrameIndex=-1},MovieBlock.prototype.pause=function(){this.isPlaying=!1},MovieBlock.prototype.unpause=function(){this.isPlaying=!0},MovieBlock.prototype.playPause=function(){this.isPlaying=!this.isPlaying},MovieBlock.prototype.stop=function(){this.play(),this.pause()},MovieBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2);for(var e=0;e<this.children.length;e++)this.children[e].undraw(a);a.restore()}}catch(f){LOG.write("error in MovieBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},MovieBlock.prototype.update=function(){ActorBlock.prototype.update.call(this),this.isPlaying&&(this.currentFrameIndex++,(this.frameAliases.length>0&&this.currentFrameIndex>=this.frameAliases.length||this.frames.length>0&&this.currentFrameIndex>=this.frames.length)&&(this.currentFrameIndex=0)),this.currentFrameIndex<0&&(this.currentFrameIndex=0);var a=this.getCurrentFrame();null!=a&&(this.width=a.width,this.height=a.height),this._setWidth(this.width),this._setHeight(this.height),this._setShattered(this.shattered),this.applyFiltersAndMasks()},MovieBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();switch(b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this.maskMode){case"window":a.globalCompositeOperation="destination-in";break;case"wall":a.globalCompositeOperation="destination-out"}if(!this._getShattered()){var e=this.getCurrentFrame();null!=e&&a.drawImage(e,-this._getWidth()/2,-this._getHeight()/2)}this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var f=0;f<this.children.length;f++)this.children[f].draw(a);a.restore()}}catch(g){LOG.write("error in MovieBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(g,LOG.ERROR)}},MovieBlock.prototype.addColorFilter=function(a,b,c,d){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),c=PARAMS.validateParam(PARAMS.INTEGER,c),d=PARAMS.validateParam(PARAMS.NUMBER,d,1);var e;if(e=this.frames.length>0?this.frames.length:this.frameAliases.length,0==e)this.width>0&&this.height>0&&(CANVASMANAGER.workingCanvasFrame.resize(this.width,this.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,this.width,this.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.filters[f]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.filters[f],0,0),CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.fillStyle="rgba("+a+","+b+","+c+","+d+")",CANVASMANAGER.workingCanvasFrame.context.fillRect(0,0,this.width,this.height),CANVASMANAGER.workingCanvasFrame.context.restore(),null==this.filters[f]&&(this.filters[f]=new Image),this.filters[f].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL());else for(var f=0;e>f;f++){var g=this.getFrame(f);CANVASMANAGER.workingCanvasFrame.resize(g.width,g.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,g.width,g.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.filters[f]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.filters[f],0,0),CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.fillStyle="rgba("+a+","+b+","+c+","+d+")",CANVASMANAGER.workingCanvasFrame.context.fillRect(0,0,g.width,g.height),CANVASMANAGER.workingCanvasFrame.context.restore(),null==this.filters[f]&&(this.filters[f]=new Image),this.filters[f].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.filtersUpdate=!0},MovieBlock.prototype.addImageFilter=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);var a,b=CANVASMANAGER.getImageAssets(arguments);a=this.frames.length>0?this.frames.length:this.frameAliases.length;for(var c=0;a>c;c++){var d=this.getFrame(c);CANVASMANAGER.workingCanvasFrame.resize(d.width,d.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,d.width,d.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.filters[c]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.filters[c],0,0),1==b.length?CANVASMANAGER.workingCanvasFrame.context.drawImage(b[0],0,0):CANVASMANAGER.workingCanvasFrame.context.drawImage(b[c],0,0),null==this.filters[c]&&(this.filters[c]=new Image),this.filters[c].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.filtersUpdate=!0},MovieBlock.prototype.addWindowMask=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);var a,b=CANVASMANAGER.getImageAssets(arguments);a=this.frames.length>0?this.frames.length:this.frameAliases.length;for(var c=0;a>c;c++){var d=this.getFrame(c);CANVASMANAGER.workingCanvasFrame.resize(d.width,d.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,d.width,d.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.windowMasks[c]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.windowMasks[c],0,0),1==b.length?CANVASMANAGER.workingCanvasFrame.context.drawImage(b[0],0,0):CANVASMANAGER.workingCanvasFrame.context.drawImage(b[c],0,0),null==this.windowMasks[c]&&(this.windowMasks[c]=new Image),this.windowMasks[c].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.masksUpdate=!0},MovieBlock.prototype.addWallMask=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);var a,b=CANVASMANAGER.getImageAssets(arguments);a=this.frames.length>0?this.frames.length:this.frameAliases.length;for(var c=0;a>c;c++){var d=this.getFrame(c);CANVASMANAGER.workingCanvasFrame.resize(d.width,d.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,d.width,d.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.wallMasks[c]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.wallMasks[c],0,0),1==b.length?CANVASMANAGER.workingCanvasFrame.context.drawImage(b[0],0,0):CANVASMANAGER.workingCanvasFrame.context.drawImage(b[c],0,0),null==this.wallMasks[c]&&(this.wallMasks[c]=new Image),this.wallMasks[c].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.masksUpdate=!0},MovieBlock.prototype.applyFiltersAndMasks=function(){if(this.masksUpdate||this.filtersUpdate){for(var a=0;null!=this.getFrame(a);){var b=this.getFrame(a);CANVASMANAGER.workingCanvasFrame.resize(b.width,b.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,b.width,b.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.windowMasks[a]?CANVASMANAGER.workingCanvasFrame.context.drawImage(this.windowMasks[a],0,0):(CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.fillStyle="rgba(0,0,0,1)",CANVASMANAGER.workingCanvasFrame.context.fillRect(0,0,b.width,b.height),CANVASMANAGER.workingCanvasFrame.context.restore()),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-in",CANVASMANAGER.workingCanvasFrame.context.drawImage(b,0,0),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-atop",null!=this.filters[a]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.filters[a],0,0),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="destination-out",null!=this.wallMasks[a]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.wallMasks[a],0,0),null==this.frames[a]&&(this.frames[a]=new Image),this.frames[a].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL(),a++}this.masksUpdate=!1,this.filtersUpdate=!1}},MovieBlock.prototype.resetFrames=function(){for(var a=0;a<this.frames.length;a++)this.frames[a]=null;this.frames.splice(0,this.frames.length)},MovieBlock.prototype.resetFilters=function(){for(var a=0;a<this.filters.length;a++)this.filters[a]=null;this.filters.splice(0,this.filters.length),this.resetFrames(),this.filtersUpdate=!0},MovieBlock.prototype.resetMasks=function(){for(var a=0;a<this.windowMasks.length;a++)this.windowMasks[a]=null;this.windowMasks.splice(0,this.windowMasks.length),this.resetFrames(),this.masksUpdate=!0},MovieBlock.prototype.resetFiltersAndMasks=function(){this.resetFilters(),this.resetMasks()},MovieBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.frameAliases.length=0,this.frameAliases=void 0,this.frames.length=0,this.frames=void 0,this.filters.length=0,this.filters=void 0,this.windowMasks.length=0,this.windowMasks=void 0,this.wallMasks.length=0,this.wallMasks=void 0,this.filtersUpdate=void 0,this.masksUpdate=void 0,this.isPlaying=void 0,this.currentFrameIndex=void 0,this.maskMode=void 0,this.shattered=void 0,this._setShattered(void 0)),PlayerBlock.prototype.destroy.call(this)};var CinemaBlock=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING,PARAMS.ARRAYOFSTRING],arguments),LOG.write("CinemaBlock constructor called",LOG.VERBOSE),PlayerBlock.call(this),this.movieFrameAliases=new Object;for(var a=0;a<arguments.length;a+=2)this.movieFrameAliases[arguments[a]]=arguments[a+1];this.movieFrameData=new Object,this.movieFrames=new Object,this.movieFilters=new Object,this.movieWindowMasks=new Object,this.movieWallMasks=new Object,this.movieFiltersUpdate=new Object,this.movieMasksUpdate=new Object,this.isPlaying=!0,this.currentMovie=void 0==arguments[0]?"":arguments[0],this.currentFrameIndex=-1,this.maskMode="none"};CinemaBlock.prototype=new ActorBlock,CinemaBlock.prototype.learn(PlayerTraits),CinemaBlock.prototype.learn(ShatterTraits),CinemaBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.currentMovie=this.currentMovie,a.currentFrameIndex=this.currentFrameIndex,a},CinemaBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.currentMovie=a.currentMovie,this.currentFrameIndex=a.currentFrameIndex},CinemaBlock.prototype.hasChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(a.currentMovie==this.currentMovie&&a.currentFrameIndex==this.currentFrameIndex)},CinemaBlock.prototype.play=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a);var b=!1;for(var c in this.movieFrameAliases)c==a&&(b=!0);for(var c in this.movieFrameData)c==a&&(b=!0);b?(this.currentMovie=a,this.currentFrameIndex=-1):(LOG.write("CinemaBlock with identity "+this.identity+" has no Movie named '"+a+"' to play. Defaulting to '"+this.currentMovie+"'.",LOG.WARN),this.currentFrameIndex=-1)},CinemaBlock.prototype.pause=function(){this.isPlaying=!1},CinemaBlock.prototype.unpause=function(){this.isPlaying=!0},CinemaBlock.prototype.playPause=function(){this.isPlaying=!this.isPlaying},CinemaBlock.prototype.stop=function(){this.play(),this.pause()},CinemaBlock.prototype.shatter=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);var b=0,c=0;for(var d in this.movieFrameAliases)for(var e=0;e<this.movieFrameAliases[d].length;e++){var f=this.getFrame(d,e);f.width>b&&(b=f.width),f.height>c&&(c=f.height)}ShatterTraits.prototype.shatter.call(this,a,b,c)},CinemaBlock.prototype.isLastMovieFrame=function(){return this.currentFrameIndex>=0&&(null!=this.movieFrames[this.currentMovie]&&this.currentFrameIndex+1==this.movieFrames[this.currentMovie].length||null!=this.movieFrameAliases[this.currentMovie]&&this.currentFrameIndex+1==this.movieFrameAliases[this.currentMovie].length)?!0:!1},CinemaBlock.prototype.getCurrentFrame=function(){return this.currentFrameIndex>=0&&(null!=this.movieFrames[this.currentMovie]&&this.currentFrameIndex<this.movieFrames[this.currentMovie].length||null!=this.movieFrameAliases[this.currentMovie]&&this.currentFrameIndex<this.movieFrameAliases[this.currentMovie].length)?null!=this.movieFrames[this.currentMovie]&&null!=this.movieFrames[this.currentMovie][this.currentFrameIndex]?this.movieFrames[this.currentMovie][this.currentFrameIndex]:CANVASMANAGER.getSingleImageAsset(this.movieFrameAliases[this.currentMovie][this.currentFrameIndex]):null},CinemaBlock.prototype.getFrame=function(a,b){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),b>=0&&(null!=this.movieFrames[a]&&b<this.movieFrames[a].length||null!=this.movieFrameAliases[a]&&b<this.movieFrameAliases[a].length)?null!=this.movieFrames[a]&&null!=this.movieFrames[a][b]?this.movieFrames[a][b]:CANVASMANAGER.getSingleImageAsset(this.movieFrameAliases[a][b]):null},CinemaBlock.prototype.undraw=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a),null!=this.currentMovie&&(this.movieFrameAliases[this.currentMovie].length>0||this.movieFrames[this.currentMovie].length>0)){var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2);for(var e=0;e<this.children.length;e++)this.children[e].undraw(a);a.restore()}}catch(f){LOG.write("error in CinemaBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}}},CinemaBlock.prototype.update=function(){ActorBlock.prototype.update.call(this),this.isPlaying&&(this.currentFrameIndex++,(null!=this.movieFrameAliases[this.currentMovie]&&this.movieFrameAliases[this.currentMovie].length>0&&this.currentFrameIndex>=this.movieFrameAliases[this.currentMovie].length||null!=this.movieFrameData[this.currentMovie]&&this.movieFrameData[this.currentMovie].length>0&&this.currentFrameIndex>=this.movieFrameData[this.currentMovie].length)&&(this.currentFrameIndex=0)),this.currentFrameIndex<0&&(this.currentFrameIndex=0);var a=this.getCurrentFrame();null!=a&&(this.width=a.width,this.height=a.height),this._setWidth(this.width),this._setHeight(this.height),this._setShattered(this.shattered),this.applyFiltersAndMasks()},CinemaBlock.prototype.draw=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a),null!=this.currentMovie&&(this.movieFrameAliases[this.currentMovie].length>0||this.movieFrames[this.currentMovie].length>0)){var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();switch(b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this.maskMode){case"window":a.globalCompositeOperation="destination-in";break;case"wall":a.globalCompositeOperation="destination-out"}if(!this._getShattered()){var e=this.getCurrentFrame();null!=e&&a.drawImage(e,-this._getWidth()/2,-this._getHeight()/2)}this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var f=0;f<this.children.length;f++)this.children[f].draw(a);a.restore()}}catch(g){LOG.write("error in CinemaBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(g,LOG.ERROR)}}},CinemaBlock.prototype.addColorFilterToMovie=function(a,b,c,d,e){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),c=PARAMS.validateParam(PARAMS.INTEGER,c),d=PARAMS.validateParam(PARAMS.INTEGER,d),e=PARAMS.validateParam(PARAMS.NUMBER,e,1);var f;f=null!=this.movieFrames[a]&&this.movieFrames[a].length>0?this.movieFrames[a].length:this.movieFrameAliases[a].length;for(var g=0;f>g;g++){var h=this.getFrame(a,g);CANVASMANAGER.workingCanvasFrame.resize(h.width,h.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,h.width,h.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.movieFilters[a]&&null!=this.movieFilters[a][g]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieFilters[a][g],0,0),CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.fillStyle="rgba("+b+","+c+","+d+","+e+")",CANVASMANAGER.workingCanvasFrame.context.fillRect(0,0,h.width,h.height),CANVASMANAGER.workingCanvasFrame.context.restore(),null==this.movieFilters[a]&&(this.movieFilters[a]=new Array),null==this.movieFilters[a][g]&&(this.movieFilters[a][g]=new Image),this.movieFilters[a][g].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.movieFiltersUpdate[a]=!0},CinemaBlock.prototype.addColorFilterToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.NUMBER,PARAMS.REST,PARAMS.STRING],arguments,[0,0,0,1,""]);for(var a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=4;e<arguments.length;e++)this.addColorFilterToMovie(arguments[e],a,b,c,d)},CinemaBlock.prototype.addColorFiltersToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.INTEGER,PARAMS.NUMBER,PARAMS.STRING],arguments,[0,0,0,1,""]);for(var a=0;a<arguments.length;a+=5)this.addColorFilterToMovie(arguments[a],arguments[a+1],arguments[a+2],arguments[a+3],arguments[a+4])},CinemaBlock.prototype.addColorFilter=function(a,b,c,d){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),c=PARAMS.validateParam(PARAMS.INTEGER,c),d=PARAMS.validateParam(PARAMS.NUMBER,d,1);for(var e in this.movieFrameAliases)this.addColorFilterToMovie(e,a,b,c,d)},CinemaBlock.prototype.addImageFilterToMovie=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.STRING,PARAMS.REST,PARAMS.STRING],arguments);for(var a=arguments[0],b=new Array,c=1;c<arguments.length;c++)b[c-1]=CANVASMANAGER.getSingleImageAsset(arguments[c]);var d;d=null!=this.movieFrames[a]&&this.movieFrames[a].length>0?this.movieFrames[a].length:this.movieFrameAliases[a].length;for(var c=0;d>c;c++){var e=this.getFrame(a,c);CANVASMANAGER.workingCanvasFrame.resize(e.width,e.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,e.width,e.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.movieFilters[a]&&null!=this.movieFilters[a][c]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieFilters[a][c],0,0),1==b.length?CANVASMANAGER.workingCanvasFrame.context.drawImage(b[0],0,0):CANVASMANAGER.workingCanvasFrame.context.drawImage(b[c],0,0),null==this.movieFilters[a]&&(this.movieFilters[a]=new Array),null==this.movieFilters[a][c]&&(this.movieFilters[a][c]=new Image),this.movieFilters[a][c].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.movieFiltersUpdate[a]=!0},CinemaBlock.prototype.addImageFilterToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.ARRAYOFSTRING,PARAMS.REST,PARAMS.STRING],arguments);var a=arguments[0],b=new Array;b[0]="",b=b.concat(a);for(var c=1;c<arguments.length;c++)b[0]=arguments[c],this.addImageFilterToMovie.apply(this,b)},CinemaBlock.prototype.addImageFiltersToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.ARRAYOFSTRING,PARAMS.ARRAYOFSTRING],arguments);for(var a=0;a<arguments.length;a+=2){var b=arguments[a],c=arguments[a+1];filterArgs=new Array,filterArgs[0]=b,filterArgs=filterArgs.concat(c),this.addImageFilterToMovie.apply(this,filterArgs)}},CinemaBlock.prototype.addImageFilter=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);for(var a in this.movieFrameAliases){var b=[].slice.call(arguments,0),c=new Array;c[0]=a,c=c.concat(b),this.addImageFilterToMovie.apply(this,c)}},CinemaBlock.prototype.addWindowMaskToMovie=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.STRING,PARAMS.REST,PARAMS.STRING],arguments);for(var a=arguments[0],b=new Array,c=1;c<arguments.length;c++)b[c-1]=CANVASMANAGER.getSingleImageAsset(arguments[c]);var d;d=null!=this.movieFrames[a]&&this.movieFrames[a].length>0?this.movieFrames[a].length:this.movieFrameAliases[a].length;for(var c=0;d>c;c++){var e=this.getFrame(a,c);CANVASMANAGER.workingCanvasFrame.resize(e.width,e.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,e.width,e.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.movieWindowMasks[a]&&null!=this.movieWindowMasks[a][c]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieWindowMasks[a][c],0,0),1==b.length?CANVASMANAGER.workingCanvasFrame.context.drawImage(b[0],0,0):CANVASMANAGER.workingCanvasFrame.context.drawImage(b[c],0,0),null==this.movieWindowMasks[a]&&(this.movieWindowMasks[a]=new Array),null==this.movieWindowMasks[a][c]&&(this.movieWindowMasks[a][c]=new Image),this.movieWindowMasks[a][c].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.movieMasksUpdate[a]=!0},CinemaBlock.prototype.addWindowMaskToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.ARRAYOFSTRING,PARAMS.REST,PARAMS.STRING],arguments);var a=arguments[0],b=new Array;b[0]="",b=b.concat(a);for(var c=1;c<arguments.length;c++)b[0]=arguments[c],this.addWindowMaskToMovie.apply(this,b)},CinemaBlock.prototype.addWindowMasksToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING,PARAMS.ARRAYOFSTRING],arguments);for(var a=0;a<arguments.length;a+=2){var b=arguments[a],c=arguments[a+1];maskArgs=new Array,maskArgs[0]=b,maskArgs=maskArgs.concat(c),this.addWindowMaskToMovie.apply(this,maskArgs)}},CinemaBlock.prototype.addWindowMask=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);for(var a in this.movieFrameAliases){var b=new Array,c=[].slice.call(arguments,0);b[0]=a,b=b.concat(c),this.addWindowMaskToMovie.apply(this,b)}},CinemaBlock.prototype.addWallMaskToMovie=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.STRING,PARAMS.REST,PARAMS.STRING],arguments);for(var a=arguments[0],b=new Array,c=1;c<arguments.length;c++)b[c-1]=CANVASMANAGER.getSingleImageAsset(arguments[c]);
var d;d=null!=this.movieFrames[a]&&this.movieFrames[a].length>0?this.movieFrames[a].length:this.movieFrameAliases[a].length;for(var c=0;d>c;c++){var e=this.getFrame(a,c);CANVASMANAGER.workingCanvasFrame.resize(e.width,e.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,e.width,e.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.movieWallMasks[a]&&null!=this.movieWallMasks[a][c]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieWallMasks[a][c],0,0),1==b.length?CANVASMANAGER.workingCanvasFrame.context.drawImage(b[0],0,0):CANVASMANAGER.workingCanvasFrame.context.drawImage(b[c],0,0),null==this.movieWallMasks[a]&&(this.movieWallMasks[a]=new Array),null==this.movieWallMasks[a][c]&&(this.movieWallMasks[a][c]=new Image),this.movieWallMasks[a][c].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()}this.movieMasksUpdate[a]=!0},CinemaBlock.prototype.addWallMaskToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.ARRAYOFSTRING,PARAMS.REST,PARAMS.STRING],arguments);var a=arguments[0],b=new Array;b[0]="",b=b.concat(a);for(var c=1;c<arguments.length;c++)b[0]=arguments[c],this.addWallMaskToMovie.apply(this,b)},CinemaBlock.prototype.addWallMasksToMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING,PARAMS.ARRAYOFSTRING],arguments);for(var a=0;a<arguments.length;a+=2){var b=arguments[a],c=arguments[a+1];maskArgs=new Array,maskArgs[0]=b,maskArgs=maskArgs.concat(c),this.addWallMaskToMovie.apply(this,maskArgs)}},CinemaBlock.prototype.addWallMask=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);for(var a in this.movieFrameAliases){var b=new Array,c=[].slice.call(arguments,0);b[0]=a,b=b.concat(c),this.addWallMaskToMovie.apply(this,b)}},CinemaBlock.prototype.applyFiltersAndMasks=function(){for(var a in this.movieFrameAliases)if(this.movieMasksUpdate[a]||this.movieFiltersUpdate[a]){for(var b=0;null!=this.getFrame(a,b);){var c=this.getFrame(a,b);CANVASMANAGER.workingCanvasFrame.resize(c.width,c.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,c.width,c.height),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-over",null!=this.movieWindowMasks[a]&&null!=this.movieWindowMasks[a][b]?CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieWindowMasks[a][b],0,0):(CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.fillStyle="rgba(0,0,0,1)",CANVASMANAGER.workingCanvasFrame.context.fillRect(0,0,c.width,c.height),CANVASMANAGER.workingCanvasFrame.context.restore()),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-in",CANVASMANAGER.workingCanvasFrame.context.drawImage(c,0,0),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="source-atop",null!=this.movieFilters[a]&&null!=this.movieFilters[a][b]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieFilters[a][b],0,0),CANVASMANAGER.workingCanvasFrame.context.globalCompositeOperation="destination-out",null!=this.movieWallMasks[a]&&null!=this.movieWallMasks[a][b]&&CANVASMANAGER.workingCanvasFrame.context.drawImage(this.movieWallMasks[a][b],0,0),null==this.movieFrames[a]&&(this.movieFrames[a]=new Array),null==this.movieFrames[a][b]&&(this.movieFrames[a][b]=new Image),this.movieFrames[a][b].src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL(),b++}this.movieMasksUpdate[a]=!1,this.movieFiltersUpdate[a]=!1}},CinemaBlock.prototype.resetFramesForMovie=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),void 0!=this.movieFrames[a]){for(var b=0;b<this.movieFrames[a].length;b++)this.movieFrames[a][b]=null;this.movieFrames[a].splice(0,this.movieFrames[a].length)}},CinemaBlock.prototype.resetFramesForMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);for(var a=0;a<arguments.length;a++)this.resetFramesForMovie(arguments[a])},CinemaBlock.prototype.resetFrames=function(){for(var a in this.movieFrames)this.resetFramesForMovie(a)},CinemaBlock.prototype.resetFiltersForMovie=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),void 0!=this.movieFilters[a]){for(var b=0;b<this.movieFilters[a].length;b++)this.movieFilters[a][b]=null;this.movieFilters[a].splice(0,this.movieFilters[a].length),this.resetFramesForMovie(a),this.movieFiltersUpdate[a]=!0}},CinemaBlock.prototype.resetFiltersForMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);for(var a=0;a<arguments.length;a++)this.resetFiltersForMovie(arguments[a])},CinemaBlock.prototype.resetFilters=function(){for(var a in this.movieFrameAliases)this.resetFiltersForMovie(a)},CinemaBlock.prototype.resetMasksForMovie=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),void 0!=this.movieWindowMasks[a]){for(var b=0;b<this.movieWindowMasks[a].length;b++)this.movieWindowMasks[a][b]=null;this.movieWindowMasks[a].splice(0,this.movieWindowMasks[a].length),this.resetFramesForMovie(a),this.movieMasksUpdate[a]=!0}},CinemaBlock.prototype.resetMasksForMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments);for(var a=0;a<arguments.length;a++)this.resetMasksForMovie(arguments[a])},CinemaBlock.prototype.resetMasks=function(){for(var a in this.movieFrameAliases)this.resetMasksForMovie(a)},CinemaBlock.prototype.resetFiltersAndMasksForMovie=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.resetFiltersForMovie(a),this.resetMasksForMovie(a)},CinemaBlock.prototype.resetFiltersAndMasksForMovies=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING],arguments),this.resetFiltersForMovies.apply(this,[].slice.call(arguments,0)),this.resetMasksForMovies.apply(this,[].slice.call(arguments,0))},CinemaBlock.prototype.resetFiltersAndMasks=function(){this.resetFilters(),this.resetMasks()},CinemaBlock.prototype.destroy=function(){this.movieFrameAliases=void 0,this.movieFrameData=void 0,this.movieFrames=void 0,this.movieFilters=void 0,this.movieWindowMasks=void 0,this.movieWallMasks=void 0,this.movieFiltersUpdate=void 0,this.movieMasksUpdate=void 0,this.isPlaying=void 0,this.currentMovie=void 0,this.currentFrameIndex=void 0,this.maskMode=void 0,this.shattered=void 0,this._setShattered(void 0),PlayerBlock.prototype.destroy.call(this)};var TextBlock=function(a,b,c,d,e){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.STRING,b,"Arial, Helvetica, sans-serif"),c=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,c,12),d=PARAMS.validateParam(PARAMS.STRING,d,"#000"),e=PARAMS.validateParam(PARAMS.STRING,e,"center"),LOG.write("TextBlock constructor called",LOG.VERBOSE),ActorBlock.call(this);var f="",g="",h=0,i=0,j="";switch(this._getText=function(){return f},this._getFont=function(){return g},this._getSize=function(){return h},this._getColor=function(){return i},this._getAlignment=function(){return j},this._setText=function(a){f=a},this._setFont=function(a){g=a},this._setSize=function(a){h=a},this._setColor=function(a){i=a},this._setAlignment=function(a){switch(a){case"left":case"right":case"center":j=a}},this.text=a,this.font=b,this.size=c,this.color=d,this.alignment="center",e){case"left":case"right":case"center":this.alignment=e}this.ascent=0,this.descent=0,this.maskMode="none"};TextBlock.prototype=new ActorBlock,TextBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.text=this._getText(),a.font=this._getFont(),a.size=this._getSize(),a.color=this._getColor(),a.alignment=this._getAlignment(),a},TextBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.text=a.text,this.font=a.font,this.size=a.size,this.color=a.color,this.alignment=a.alignment},TextBlock.prototype.hasChangedFromLatestMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a);var b=this.getLatestMemory();return null==b?!0:a?!(b.text==this.text&&b.font==this.font&&b.size==this.size&&b.alignment==this.alignment&&b.color==this.color):ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(b.text==this.text&&b.font==this.font&&b.size==this.size&&b.alignment==this.alignment&&b.color==this.color)},TextBlock.prototype.isMouseEventWithinBlock=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),MATRIX.clearTransformations(),this.addInverseTransformationsToMatrix(MATRIX);var b=MATRIX.applyTransformation(a.x,a.y);switch(LOG.writeObject(b),this._getAlignment()){case"center":return b.x>-this.width/2&&b.x<this.width/2&&b.y>-this.ascent&&b.y<this.height-this.ascent?!0:!1;case"left":return b.x>0&&b.x<this.width&&b.y>-this.ascent&&b.y<this.height-this.ascent?!0:!1;case"right":return b.x>-this.width&&b.x<0&&b.y>-this.ascent&&b.y<this.height-this.ascent?!0:!1}},TextBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d,e;switch(this._getAlignment()){case"center":d=this._getWidth()/2,e=0;break;case"left":d=0,e=0;break;case"right":d=this._getWidth(),e=0}var f=this.getZRatio();b=Math.round(-d+f*this._getX()),c=Math.round(-e+f*this._getY()),a.save(),a.translate(b+d,c+e),a.scale(f*this._getScaleX(),f*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),a.clearRect(-d-12,-e-this.ascent-10,this._getWidth()+14,this._getHeight()+24),this.showDebugDisplay&&a.clearRect(-3,-3,6,6);for(var g=0;g<this.children.length;g++)this.children[g].undraw(a);a.restore()}}catch(h){LOG.write("error in TextBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(h,LOG.ERROR)}},TextBlock.prototype.update=function(){if(ActorBlock.prototype.update.call(this),this._setText(this.text),this._setFont(this.font),this._setSize(this.size),this._setColor(this.color),this._setAlignment(this.alignment),this.hasChangedFromLatestMemory(!0)){CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.font=this.size+"px "+this.font,CANVASMANAGER.workingCanvasFrame.context.fillStyle=this.color,CANVASMANAGER.workingCanvasFrame.context.fillText(this.text,0,0),this.width=CANVASMANAGER.workingCanvasFrame.context.measureText(this.text).width,CANVASMANAGER.workingCanvasFrame.context.restore();var a=TEXTHELPER.measureTextHeight(this.text,this.font,this.size);this.height=a.height,this.ascent=a.ascent,this.descent=a.descent}0==this.width&&(this.width=1),0==this.height&&(this.height=1),this._setWidth(this.width),this._setHeight(this.height)},TextBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d,e;switch(this._getAlignment()){case"center":d=this._getWidth()/2,e=0;break;case"left":d=0,e=0;break;case"right":d=this._getWidth(),e=0}var f=this.getZRatio();switch(b=Math.round(-d+f*this._getX()),c=Math.round(-e+f*this._getY()),a.save(),a.translate(b+d,c+e),a.scale(f*this._getScaleX(),f*this._getScaleY()),a.rotate((this._getRotation()+.019)*Math.PI/180),this.maskMode){case"window":a.globalCompositeOperation="destination-in";break;case"wall":a.globalCompositeOperation="destination-out"}a.font=this._getSize()+"px "+this._getFont(),a.fillStyle=this._getColor(),a.fillText(this._getText(),-d,-e),this.showDebugDisplay&&(a.save(),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-d,-e-this.ascent,this._getWidth(),this._getHeight()),a.stroke(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this.ascent),a.stroke(),a.fillStyle="Red",a.fillRect(-2,-2,4,4),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var g=0;g<this.children.length;g++)this.children[g].draw(a);a.restore()}}catch(h){LOG.write("error in TextBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(h,LOG.ERROR)}},TextBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.text=void 0,this.font=void 0,this.size=void 0,this.color=void 0,this._setText(void 0),this._setFont(void 0),this._setSize(void 0),this._setColor(void 0),this._setAlignment(void 0),this.ascent=void 0,this.descent=void 0,this.maskMode=void 0),ActorBlock.prototype.destroy.call(this)};var ImageTextBlock=function(a,b,c,d,e){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.STRING,b,"Arial, Helvetica, sans-serif"),c=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,c,12),d=PARAMS.validateParam(PARAMS.STRING,d,"#000"),e=PARAMS.validateParam(PARAMS.STRING,e,"center"),LOG.write("ImageTextBlock constructor called",LOG.VERBOSE),ActorBlock.call(this);var f="",g="",h=0,i=0,j="";switch(this._getText=function(){return f},this._getFont=function(){return g},this._getSize=function(){return h},this._getColor=function(){return i},this._getAlignment=function(){return j},this._setText=function(a){f=a},this._setFont=function(a){g=a},this._setSize=function(a){h=a},this._setColor=function(a){i=a},this._setAlignment=function(a){switch(a){case"left":case"right":case"center":j=a}},this.text=a,this.font=b,this.size=c,this.color=d,this.alignment="center",e){case"left":case"right":case"center":this.alignment=e}this.textImage=new Image,this.maskMode="none",this.createTextData()};ImageTextBlock.prototype=new ActorBlock,ImageTextBlock.prototype.learn(ShatterTraits),ImageTextBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.text=this._getText(),a.font=this._getFont(),a.size=this._getSize(),a.color=this._getColor(),a.alignment=this._getAlignment(),a},ImageTextBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.text=a.text,this.font=a.font,this.size=a.size,this.color=a.color,this.alignment=a.alignment},ImageTextBlock.prototype.hasChangedFromLatestMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a);var b=this.getLatestMemory();return null==b?!0:a?!(b.text==this.text&&b.font==this.font&&b.size==this.size&&b.alignment==this.alignment&&b.color==this.color):ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(b.text==this.text&&b.font==this.font&&b.size==this.size&&b.alignment==this.alignment&&b.color==this.color)},ImageTextBlock.prototype.createTextData=function(){LOG.write("creating text data"),CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.font=this.size+"px "+this.font,CANVASMANAGER.workingCanvasFrame.context.fillStyle=this.color,CANVASMANAGER.workingCanvasFrame.context.textBaseline="top",CANVASMANAGER.workingCanvasFrame.context.textAlign="left";var a=CANVASMANAGER.workingCanvasFrame.context.measureText("M").width;this.width=CANVASMANAGER.workingCanvasFrame.context.measureText(this.text).width+a,0==this.width&&(this.width=1);var b=TEXTHELPER.measureTextHeight(this.text,this.font,this.size);this.height=b.height+1+a,CANVASMANAGER.workingCanvasFrame.resize(this.width,this.height,-1),CANVASMANAGER.workingCanvasFrame.context.font=this.size+"px "+this.font,CANVASMANAGER.workingCanvasFrame.context.fillStyle=this.color,CANVASMANAGER.workingCanvasFrame.context.textBaseline="top",CANVASMANAGER.workingCanvasFrame.context.textAlign="left",CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,this.width,this.height),CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.translate(a/2,a/2),CANVASMANAGER.workingCanvasFrame.context.rotate(.1*Math.PI/180),this.text.length>0?CANVASMANAGER.workingCanvasFrame.context.fillText(this.text,0,0):CANVASMANAGER.workingCanvasFrame.context.fillText(" ",0,0),CANVASMANAGER.workingCanvasFrame.context.restore(),CANVASMANAGER.workingCanvasFrame.context.restore(),this.textImage.src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()},ImageTextBlock.prototype.getCurrentFrame=function(){return this.text&&this.textImage?this.textImage:null},ImageTextBlock.prototype.isMouseEventWithinBlock=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),MATRIX.clearTransformations(),this.addInverseTransformationsToMatrix(MATRIX);var b=MATRIX.applyTransformation(a.x,a.y);return LOG.writeObject(b),b.x>-this.width/2&&b.x<this.width/2&&b.y>-this.height/2&&b.y<this.height/2?!0:!1},ImageTextBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d,e;d=this._getWidth()/2,e=this._getHeight()/2;var f=this.getZRatio();b=Math.round(-d+f*this._getX()),c=Math.round(-e+f*this._getY()),a.save(),a.translate(b+d,c+e),a.scale(f*this._getScaleX(),f*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2),this.showDebugDisplay&&a.clearRect(-5,-5,10,10);for(var g=0;g<this.children.length;g++)this.children[g].undraw(a);a.restore()}}catch(h){LOG.write("error in ImageTextBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(h,LOG.ERROR)}},ImageTextBlock.prototype.update=function(){ActorBlock.prototype.update.call(this),this._setText(this.text),this._setFont(this.font),this._setSize(this.size),this._setColor(this.color),this._setAlignment(this.alignment),this.hasChangedFromLatestMemory(!0)&&this.createTextData(),this._setWidth(this.width),this._setHeight(this.height),this._setShattered(this.shattered)},ImageTextBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d,e;d=this._getWidth()/2,e=this._getHeight()/2;var f=this.getZRatio();switch(b=Math.round(-d+f*this._getX()),c=Math.round(-e+f*this._getY()),a.save(),a.translate(b+d,c+e),a.scale(f*this._getScaleX(),f*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this.maskMode){case"window":a.globalCompositeOperation="destination-in";break;case"wall":a.globalCompositeOperation="destination-out"}if(!this._getShattered()){var g=this.getCurrentFrame();null!=g&&a.drawImage(g,-this._getWidth()/2,-this._getHeight()/2)}this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-d,-e,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var h=0;h<this.children.length;h++)this.children[h].draw(a);a.restore()}}catch(i){a.restore(),LOG.write("error in ImageTextBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(i,LOG.ERROR)}},ImageTextBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.text=void 0,this.font=void 0,this.size=void 0,this.color=void 0,this._setText(void 0),this._setFont(void 0),this._setSize(void 0),this._setColor(void 0),this._setAlignment(void 0),this.shattered=void 0,this._setShattered(void 0),delete this.textImage,this.textImage=void 0,this.ascent=void 0,this.descent=void 0,this.maskMode=void 0),ActorBlock.prototype.destroy.call(this)};var ParagraphBlock=function(a,b,c,d,e,f,g){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,a),b=PARAMS.validateParam(PARAMS.STRING,b),c=PARAMS.validateParam(PARAMS.STRING,c,"Arial, Helvetica, sans-serif"),d=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,d,12),e=PARAMS.validateParam(PARAMS.STRING,e,"#000"),f=PARAMS.validateParam(PARAMS.STRING,f,"center"),g=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,g),LOG.write("ParagraphBlock constructor called",LOG.VERBOSE),ActorBlock.call(this);var h="",i="",j=0,k=0,l=0,m=0,n="";switch(this._getText=function(){return h},this._getFont=function(){return i},this._getSize=function(){return j},this._getColor=function(){return k},this._getLineSpacing=function(){return l},this._getLineHeight=function(){return m},this._getAlignment=function(){return n},this._setText=function(a){h=a},this._setFont=function(a){i=a},this._setSize=function(a){j=a},this._setColor=function(a){k=a},this._setLineSpacing=function(a){l=a},this._setLineHeight=function(a){m=a},this._setAlignment=function(a){switch(a){case"left":case"right":case"center":n=a}},this.width=a,this.lineHeight=0,this.height=0,this.text=b,this.textFragments=new Array(this.text),this.font=c,this.size=d,this.color=e,this.lineSpacing=g,this.alignment="center",f){case"left":case"right":case"center":this.alignment=f}this.ascent=0,this.descent=0,this.maskMode="none"};ParagraphBlock.prototype=new ActorBlock,ParagraphBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.width=this._getWidth(),a.text=this._getText(),a.font=this._getFont(),a.size=this._getSize(),a.color=this._getColor(),a.lineSpacing=this._getLineSpacing(),a.alignment=this._getAlignment(),a},ParagraphBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.width=a.width,this.text=a.text,this.font=a.font,this.size=a.size,this.color=a.color,this.lineSpacing=a.lineSpacing,this.alignment=a.alignment},ParagraphBlock.prototype.hasChangedFromLatestMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a);var b=this.getLatestMemory();return null==b?!0:a?!(b.width==this.width&&b.text==this.text&&b.font==this.font&&b.size==this.size&&b.lineSpacing==this.lineSpacing&&b.alignment==this.alignment&&b.color==this.color):ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(b.width==this.width&&b.text==this.text&&b.font==this.font&&b.size==this.size&&b.lineSpacing==this.lineSpacing&&b.alignment==this.alignment&&b.color==this.color)},ParagraphBlock.prototype.isMouseEventWithinBlock=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),MATRIX.clearTransformations(),this.addInverseTransformationsToMatrix(MATRIX);var b=MATRIX.applyTransformation(a.x,a.y);switch(LOG.writeObject(b),this.alignment){case"center":return b.x>-this.width/2&&b.x<this.width/2&&b.y>-this.lineHeight&&b.y<this.height-this.lineHeight?!0:!1;case"left":return b.x>0&&b.x<this.width&&b.y>-this.lineHeight&&b.y<this.height-this.lineHeight?!0:!1;case"right":return b.x>-this.width&&b.x<0&&b.y>-this.lineHeight&&b.y<this.height-this.lineHeight?!0:!1}},ParagraphBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(d*this._getX()),c=Math.round(d*this._getY()),a.save(),a.translate(b,c),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180);var e=0,f=0;switch(this._getAlignment()){case"center":e=this._getWidth()/2;break;case"left":e=0;break;case"right":e=this._getWidth()}a.clearRect(-e-12,-f-this._getLineHeight()-1,this._getWidth()+14,this._getHeight()+24),this.showDebugDisplay&&a.clearRect(-3,-3,6,6);for(var g=0;g<this.children.length;g++)this.children[g].undraw(a);a.restore()}}catch(h){LOG.write("error in ParagraphBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(h,LOG.ERROR)}},ParagraphBlock.prototype.update=function(){if(ActorBlock.prototype.update.call(this),this._setText(this.text),this._setFont(this.font),this._setSize(this.size),this._setColor(this.color),this._setLineSpacing(this.lineSpacing),this._setAlignment(this.alignment),this.hasChangedFromLatestMemory(!0)){CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.font=this.size+"px "+this.font,CANVASMANAGER.workingCanvasFrame.context.fillStyle=this.color,CANVASMANAGER.workingCanvasFrame.context.fillText(this.text,0,0),this.textFragments.length=0,this.textFragments[0]={text:"",width:0};for(var a=0,b=this.text.split("\n"),c=0;c<b.length;c++){for(var d=b[c].split(" "),e=0;e<d.length;e++){var f=this.textFragments[a].text+d[e],g=CANVASMANAGER.workingCanvasFrame.context.measureText(f).width;if(g<=this.width)this.textFragments[a].text=f+" ",this.textFragments[a].width=g;else if(f.length==d[e].length){for(var h=0;h<f.length;h++){var i=this.textFragments[a].text+f.charAt(h),j=CANVASMANAGER.workingCanvasFrame.context.measureText(i).width;j<=this.width?(this.textFragments[a].text+=f.charAt(h),this.textFragments[a].width=j):1==i.length?(this.textFragments[a].text=i,this.textFragments[a].width=j,a++,this.textFragments[a]={text:"",width:0}):(a++,this.textFragments[a]={text:"",width:0},h--)}this.textFragments[a].text.length>0&&(this.textFragments[a].text+=" ")}else a++,this.textFragments[a]={text:"",width:0},e--}a++,this.textFragments[a]={text:"",width:0}}""==this.textFragments[a].text&&this.textFragments.pop(),CANVASMANAGER.workingCanvasFrame.context.restore();var k=TEXTHELPER.measureTextHeight(this.textFragments[0].text,this.font,this.size);this.lineHeight=k.height,this.ascent=k.ascent,this.descent=k.descent,0==this.lineHeight&&(this.lineHeight=1),this._setLineHeight(this.lineHeight);var l=CANVASMANAGER.workingCanvasFrame.context.measureText("M").width;this.height=this.textFragments.length*this.lineHeight+(this.textFragments.length-1)*this.lineSpacing+l}0==this.width&&(this.width=1),0==this.height&&(this.height=1),this._setWidth(this.width),this._setHeight(this.height)},ParagraphBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();switch(b=Math.round(d*this._getX()),c=Math.round(d*this._getY()),a.save(),a.translate(b,c),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate((this._getRotation()+.019)*Math.PI/180),this.maskMode){case"window":a.globalCompositeOperation="destination-in";break;case"wall":a.globalCompositeOperation="destination-out"}a.font=this._getSize()+"px "+this._getFont(),a.fillStyle=this._getColor();for(var e=0,f=0,g=0;g<this.textFragments.length;g++){switch(this._getAlignment()){case"center":e=this.textFragments[g].width/2;break;case"left":e=0;break;case"right":e=this.textFragments[g].width}a.fillText(this.textFragments[g].text,-e,f),f+=this._getLineHeight()+this._getLineSpacing()}if(this.showDebugDisplay){a.save(),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1;var h=0;switch(this._getAlignment()){case"center":h=this._getWidth()/2;break;case"left":h=0;break;case"right":h=this._getWidth()}a.rect(-h,-this._getLineHeight(),this._getWidth(),this._getHeight()),a.stroke(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this.ascent),a.stroke(),a.fillStyle="Red",a.fillRect(-2,-2,4,4),a.restore()}this.children.sort(function(a,b){return b.z-a.z});for(var g=0;g<this.children.length;g++)this.children[g].draw(a);a.restore()}}catch(i){LOG.write("error in ParagraphBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(i,LOG.ERROR)}},ParagraphBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.text=void 0,this.font=void 0,this.size=void 0,this.color=void 0,this.lineHeight=void 0,this.lineSpacing=void 0,this.textFragments.splice(0,this.textFragments.length),this.textFragments=void 0,this._setText(void 0),this._setFont(void 0),this._setSize(void 0),this._setColor(void 0),this._setAlignment(void 0),this._setLineHeight(void 0),this._setLineSpacing(void 0),this.ascent=void 0,this.descent=void 0,this.maskMode=void 0),ActorBlock.prototype.destroy.call(this)};var ImageParagraphBlock=function(a,b,c,d,e,f,g){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,a),b=PARAMS.validateParam(PARAMS.STRING,b),c=PARAMS.validateParam(PARAMS.STRING,c,"Arial, Helvetica, sans-serif"),d=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,d,12),e=PARAMS.validateParam(PARAMS.STRING,e,"#000"),f=PARAMS.validateParam(PARAMS.STRING,f,"center"),g=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,g,0),LOG.write("ImageParagraphBlock constructor called",LOG.VERBOSE),ActorBlock.call(this);var h="",i="",j=0,k=0,l=0,m=0,n="";switch(this._getText=function(){return h},this._getFont=function(){return i},this._getSize=function(){return j},this._getColor=function(){return k},this._getLineSpacing=function(){return l},this._getLineHeight=function(){return m},this._getAlignment=function(){return n},this._setText=function(a){h=a},this._setFont=function(a){i=a},this._setSize=function(a){j=a},this._setColor=function(a){k=a},this._setLineSpacing=function(a){l=a},this._setLineHeight=function(a){m=a},this._setAlignment=function(a){switch(a){case"left":case"right":case"center":n=a}},this.width=a,this.lineHeight=0,this.height=0,this.text=b,this.textFragments=new Array(this.text),this.font=c,this.size=d,this.color=e,this.lineSpacing=g,this.alignment="center",f){case"left":case"right":case"center":this.alignment=f}this.ascent=0,this.descent=0,this.textImage=new Image,this.maskMode="none"};ImageParagraphBlock.prototype=new ActorBlock,ImageParagraphBlock.prototype.learn(ShatterTraits),ImageParagraphBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.width=this._getWidth(),a.text=this._getText(),a.font=this._getFont(),a.size=this._getSize(),a.color=this._getColor(),a.alignment=this._getAlignment(),a},ImageParagraphBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.width=a.width,this.text=a.text,this.font=a.font,this.size=a.size,this.color=a.color,this.alignment=a.alignment},ImageParagraphBlock.prototype.hasChangedFromLatestMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a);var b=this.getLatestMemory();return null==b?!0:a?!(b.width==this.width&&b.text==this.text&&b.font==this.font&&b.size==this.size&&b.alignment==this.alignment&&b.color==this.color):ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(b.width==this.width&&b.text==this.text&&b.font==this.font&&b.size==this.size&&b.alignment==this.alignment&&b.color==this.color)},ImageParagraphBlock.prototype.isMouseEventWithinBlock=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MOUSEEVENT,a),MATRIX.clearTransformations(),this.addInverseTransformationsToMatrix(MATRIX);var b=MATRIX.applyTransformation(a.x,a.y);return LOG.writeObject(b),b.x>-this.width/2&&b.x<this.width/2&&b.y>-this.height/2&&b.y<this.height/2?!0:!1},ImageParagraphBlock.prototype.getCurrentFrame=function(){return this.text&&this.textImage?this.textImage:null},ImageParagraphBlock.prototype.createTextData=function(){LOG.write("creating text data"),0==this.width&&(this.width=1),CANVASMANAGER.workingCanvasFrame.resize(this.width,this.height,-1),CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.font=this.size+"px "+this.font,CANVASMANAGER.workingCanvasFrame.context.fillStyle=this.color,CANVASMANAGER.workingCanvasFrame.context.textBaseline="top",CANVASMANAGER.workingCanvasFrame.context.textAlign="left",CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,this.width,this.height),CANVASMANAGER.workingCanvasFrame.context.rotate(.1*Math.PI/180);for(var a=0,b=0,c=0;c<this.textFragments.length;c++){switch(this.alignment){case"center":a=(this.width-this.textFragments[c].width)/2;break;case"left":a=0;break;case"right":a=this.width-this.textFragments[c].width}CANVASMANAGER.workingCanvasFrame.context.fillText(this.textFragments[c].text,a,b),b+=this.lineHeight+this.lineSpacing}CANVASMANAGER.workingCanvasFrame.context.restore(),this.textImage.src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL()
},ImageParagraphBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d,e;d=this._getWidth()/2,e=this._getHeight()/2;var f=this.getZRatio();b=Math.round(-d+f*this._getX()),c=Math.round(-e+f*this._getY()),a.save(),a.translate(b+d,c+e),a.scale(f*this._getScaleX(),f*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2),this.showDebugDisplay&&a.clearRect(-5,-5,10,10);for(var g=0;g<this.children.length;g++)this.children[g].undraw(a);a.restore()}}catch(h){LOG.write("error in TextBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(h,LOG.ERROR)}},ImageParagraphBlock.prototype.update=function(){if(ActorBlock.prototype.update.call(this),this._setText(this.text),this._setFont(this.font),this._setSize(this.size),this._setColor(this.color),this._setLineSpacing(this.lineSpacing),this._setAlignment(this.alignment),this.hasChangedFromLatestMemory(!0)){CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.context.font=this.size+"px "+this.font,CANVASMANAGER.workingCanvasFrame.context.fillStyle=this.color,CANVASMANAGER.workingCanvasFrame.context.fillText(this.text,0,0),this.textFragments.length=0,this.textFragments[0]={text:"",width:0};for(var a=0,b=this.text.split("\n"),c=0;c<b.length;c++){for(var d=b[c].split(" "),e=0;e<d.length;e++){var f=this.textFragments[a].text+d[e],g=CANVASMANAGER.workingCanvasFrame.context.measureText(f).width;if(g<=this.width)this.textFragments[a].text=f+" ",this.textFragments[a].width=g;else if(f.length==d[e].length){for(var h=0;h<f.length;h++){var i=this.textFragments[a].text+f.charAt(h),j=CANVASMANAGER.workingCanvasFrame.context.measureText(i).width;j<=this.width?(this.textFragments[a].text+=f.charAt(h),this.textFragments[a].width=j):1==i.length?(this.textFragments[a].text=i,this.textFragments[a].width=j,a++,this.textFragments[a]={text:"",width:0}):(a++,this.textFragments[a]={text:"",width:0},h--)}this.textFragments[a].text.length>0&&(this.textFragments[a].text+=" ")}else a++,this.textFragments[a]={text:"",width:0},e--}a++,this.textFragments[a]={text:"",width:0}}""==this.textFragments[a].text&&this.textFragments.pop(),0==this.lineHeight&&(this.lineHeight=1);var k=CANVASMANAGER.workingCanvasFrame.context.measureText("M").width,l=TEXTHELPER.measureTextHeight(this.textFragments[0].text,this.font,this.size);this.lineHeight=l.height,this._setLineHeight(this.lineHeight),this.ascent=l.ascent,this.descent=l.descent,this.height=this.textFragments.length*this.lineHeight+(this.textFragments.length-1)*this.lineSpacing+k/2,CANVASMANAGER.workingCanvasFrame.context.restore(),this.createTextData()}0==this.width&&(this.width=1),0==this.height&&(this.height=1),this._setWidth(this.width),this._setHeight(this.height),this._setShattered(this.shattered)},ImageParagraphBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d,e;d=this._getWidth()/2,e=this._getHeight()/2;var f=this.getZRatio();switch(b=Math.round(-d+f*this._getX()),c=Math.round(-e+f*this._getY()),a.save(),a.translate(b+d,c+e),a.scale(f*this._getScaleX(),f*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this.maskMode){case"window":a.globalCompositeOperation="destination-in";break;case"wall":a.globalCompositeOperation="destination-out"}this._getShattered()||a.drawImage(this.textImage,-this._getWidth()/2,-this._getHeight()/2),this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-d,-e,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var g=0;g<this.children.length;g++)this.children[g].draw(a);a.restore()}}catch(h){LOG.write("error in ImageParagraphBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(h,LOG.ERROR)}},ImageParagraphBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.lineHeight=void 0,this.text=void 0,this.font=void 0,this.size=void 0,this.color=void 0,this.lineSpacing=void 0,this.alignment=void 0,this._setText(void 0),this._setFont(void 0),this._setSize(void 0),this._setColor(void 0),this._setAlignment(void 0),this._setLineHeight(void 0),this._setLineSpacing(void 0),this.textFragments.splice(0,this.textFragments.length),this.textFragments=void 0,this.ascent=void 0,this.descent=void 0,this.textImage=void 0,this.maskMode=void 0),ActorBlock.prototype.destroy.call(this)};var VideoBlock=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a,null),b=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,b),c=PARAMS.validateParam(PARAMS.UNSIGNEDINTEGER,c),LOG.write("VideoBlock constructor called",LOG.VERBOSE),PlayerBlock.call(this);var d=null;this._getVideo=function(){return d},this._setVideo=function(a){d=a},null!=a&&(this.video=CANVASMANAGER.getVideoAsset(a)),this.width=b,this.height=c,this.currentTime=this.video?0:this.video.getCurrentTime()};VideoBlock.prototype=new ActorBlock,VideoBlock.prototype.learn(PlayerTraits),VideoBlock.prototype.learn(ShatterTraits),VideoBlock.prototype.sleep=function(){ActorBlock.prototype.sleep.call(this),this.video.pause()},VideoBlock.prototype.wake=function(){ActorBlock.prototype.wake.call(this),this.video.unpause()},VideoBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);return a.currentTime=void 0==this.video?0:this.video.getCurrentTime(),a},VideoBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.currentTime=a.currentTime,this.video.setCurrentTime(this.currentTime)},VideoBlock.prototype.hasChangedFromLatestMemory=function(){var a=this.getLatestMemory();return null==a?!1:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||!(a.currentTime==this.currentTime)},VideoBlock.prototype.play=function(){this.awake&&this.video.play()},VideoBlock.prototype.pause=function(){this.awake&&this.video.pause()},VideoBlock.prototype.unpause=function(){this.awake&&this.video.unpause()},VideoBlock.prototype.playPause=function(){this.awake&&this.video.playPause()},VideoBlock.prototype.stop=function(){this.awake&&(this.video.play(),this.video.pause())},VideoBlock.prototype.getVolume=function(){return this.video.getVolume()},VideoBlock.prototype.setVolume=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.NUMBER,a),this.awake&&this.video.setVolume(a)},VideoBlock.prototype.setLooping=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a),this.awake&&this.video.setLooping(a)},VideoBlock.prototype.shatter=function(a){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),!this.shattered){for(var b=new Array,c=0,d=0;d<this.width;d+=a)for(var e=0;e<this.height;e+=a)void 0==b[c]&&(b[c]={x:Math.floor(d-this.width/2+a/2),y:Math.floor(e-this.height/2+a/2)}),c++;for(var d=0;d<b.length;d++){var f=new FragmentBlock(this,a,a,b[d].x,b[d].y,0);f.setMemoryCapacity(this.memoryCapacity),this.adoptChild(f)}this.shattered=!0}},VideoBlock.prototype.unshatter=function(){for(var a=0;a<this.children.length;a++)this.children[a]instanceof FragmentBlock&&(this.children[a].destroy(),this.children.splice(a,1),a--);this.shattered=!1},VideoBlock.prototype.getCurrentFrame=function(){return this.video&&this.video.video?this.video.video:null},VideoBlock.prototype.getHorizontalVideoScaling=function(){return this._getWidth()/this.video.video.videoWidth},VideoBlock.prototype.getVerticalVideoScaling=function(){return this._getHeight()/this.video.video.videoHeight},VideoBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),!this._getShattered()&&this._getVideo()&&a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2);for(var e=0;e<this.children.length;e++)this.children[e].undraw(a);a.restore()}}catch(f){LOG.write("error in VideoBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},VideoBlock.prototype.update=function(){ActorBlock.prototype.update.call(this),this._setVideo(this.video),this._setShattered(this.shattered)},VideoBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),!this._getShattered()&&this._getVideo()&&a.drawImage(this._getVideo().video,-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var e=0;e<this.children.length;e++)this.children[e].draw(a);a.restore()}}catch(f){LOG.write("error in MovieBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},VideoBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.video.destroy(),this._getVideo().destroy(),this._setVideo(void 0),this.currentTime=void 0,this.shattered=void 0,this._setShattered(void 0)),PlayerBlock.prototype.destroy.call(this)};var DrawingBlock=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),LOG.write("DrawingBlock constructor called",LOG.VERBOSE),ActorBlock.call(this),this._setWidth(0),this._setHeight(0),this.width=a,this.height=b,this.drawingCommands=new Array,this.undrawingCommands=new Array};DrawingBlock.prototype=new ActorBlock,DrawingBlock.prototype.learn(CanvasTraits),DrawingBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);void 0==a.drawingCommands?a.drawingCommands=new Array:a.drawingCommands.splice(0,a.drawingCommands.length);for(var b=0;b<this.drawingCommands.length;b++)if(void 0==a.drawingCommands[b]&&(a.drawingCommands[b]=new Object),a.drawingCommands[b].command=this.drawingCommands[b].command,void 0!=this.drawingCommands[b].parameters){void 0==a.drawingCommands[b].parameters?a.drawingCommands[b].parameters=new Array:a.drawingCommands[b].parameters.splice(0,a.drawingCommands[b].parameters.length);for(var c=0;c<this.drawingCommands[b].parameters.length;c++)a.drawingCommands[b].parameters[c]=this.drawingCommands[b].parameters[c]}void 0==a.undrawingCommands?a.undrawingCommands=new Array:a.undrawingCommands.splice(0,a.undrawingCommands.length);for(var b=0;b<this.undrawingCommands.length;b++)if(void 0==a.undrawingCommands[b]&&(a.undrawingCommands[b]=new Object),a.undrawingCommands[b].command=this.undrawingCommands[b].command,void 0!=this.undrawingCommands[b].parameters){void 0==a.undrawingCommands[b].parameters?a.undrawingCommands[b].parameters=new Array:a.undrawingCommands[b].parameters.splice(0,a.undrawingCommands[b].parameters.length);for(var c=0;c<this.undrawingCommands[b].parameters.length;c++)a.undrawingCommands[b].parameters[c]=this.undrawingCommands[b].parameters[c]}return a},DrawingBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.drawingCommands=a.drawingCommands,this.undrawingCommands=a.undrawingCommands},DrawingBlock.prototype.hasChangedFromLatestMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a);var b=this.getLatestMemory(),c=!1,d=!1;if(null!=b){b.drawingCommands!=this.drawingCommands&&(c=!0);for(var e in b.drawingCommands){if(void 0==this.drawingCommands[e]){c=!0;break}if(this.drawingCommands[e].command!=b.drawingCommands[e].command){c=!0;break}if(null!=this.drawingCommands[e].parameters&&null!=b.drawingCommands[e].parameters&&this.drawingCommands[e].parameters.length!=b.drawingCommands[e].parameters.length){c=!0;break}if(null!=this.drawingCommands[e].parameters&&null!=b.drawingCommands[e].parameters)for(var f=0;f<this.drawingCommands[e].parameters.length;f++)if(this.drawingCommands[e].parameters[f]!=b.drawingCommands[e].parameters[f]){c=!0;break}}b.undrawingCommands!=this.undrawingCommands&&(d=!0);for(var g in b.undrawingCommands){if(void 0==this.undrawingCommands[g]){d=!0;break}if(this.undrawingCommands[g].command!=b.undrawingCommands[g].command){d=!0;break}if(null!=this.undrawingCommands[g].parameters&&null!=b.undrawingCommands[g].parameters&&this.undrawingCommands[g].parameters.length!=b.undrawingCommands[g].parameters.length){d=!0;break}if(null!=this.undrawingCommands[g].parameters&&null!=b.undrawingCommands[g].parameters)for(var f=0;f<this.undrawingCommands[g].parameters.length;f++)if(this.undrawingCommands[g].parameters[f]!=b.undrawingCommands[g].parameters[f]){d=!0;break}}}else c=!0,d=!0;return null==b?!0:a?c||d:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||c||d},DrawingBlock.prototype.addDrawingCommand=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.ARRAY,b),a.length>0){var c=new Object;c.command=a,c.parameters=b,this.drawingCommands.push(c)}},DrawingBlock.prototype.addUndrawingCommand=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.ARRAY,b),a.length>0){var c=new Object;c.command=a,c.parameters=b,this.undrawingCommands.push(c)}},DrawingBlock.prototype.addDrawingCommands=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING,PARAMS.ARRAYOFOBJECT],arguments);for(var a=0;a<arguments.length;a+=2){var b=arguments[a],c=arguments[a+1];if(b.length>0){var d=new Object;d.command=b,d.parameters=c,this.drawingCommands.push(d)}}},DrawingBlock.prototype.setDrawingCommands=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFOBJECT,a),this.clearDrawingCommands();for(var b=0;b<a.length;b++)this.drawingCommands.push(a[b])},DrawingBlock.prototype.getDrawingCommands=function(){for(var a=new Array,b=0;b<this.drawingCommands.length;b++)if(void 0==a[b]&&(a[b]=new Object),a[b].command=this.drawingCommands[b].command,void 0!=this.drawingCommands[b].parameters){void 0==a[b].parameters&&(a[b].parameters=new Array);for(var c=0;c<this.drawingCommands[b].parameters.length;c++)a[b].parameters[c]=this.drawingCommands[b].parameters[c]}return a},DrawingBlock.prototype.clearDrawingCommands=function(){this.drawingCommands.splice(0,this.drawingCommands.length)},DrawingBlock.prototype.clearUndrawingCommands=function(){this.undrawingCommands.splice(0,this.undrawingCommands.length)},DrawingBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2),this.parseCanvasCommands(a,this.undrawingCommands);for(var e=0;e<this.children.length;e++)this.children[e].undraw(a);a.restore()}}catch(f){LOG.write("error in TextBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},DrawingBlock.prototype.update=function(){ActorBlock.prototype.update.call(this)},DrawingBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),a.translate(-this._getWidth()/2,-this._getHeight()/2),this.parseCanvasCommands(a,this.drawingCommands),a.translate(this._getWidth()/2,this._getHeight()/2),this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.closePath(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var e=0;e<this.children.length;e++)this.children[e].draw(a);a.restore()}}catch(f){LOG.write("error in TextBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},DrawingBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.drawingCommands.splice(0,this.drawingCommands.length),this.drawingCommands=void 0,this.undrawingCommands.splice(0,this.undrawingCommands.length),this.undrawingCommands=void 0),ActorBlock.prototype.destroy.call(this)};var ImageDrawingBlock=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),LOG.write("DrawingBlock constructor called",LOG.VERBOSE),ActorBlock.call(this),this.width=a,this.height=b,this.drawingCommands=new Array,this.canvasImage=new Image};ImageDrawingBlock.prototype=new ActorBlock,ImageDrawingBlock.prototype.learn(CanvasTraits),ImageDrawingBlock.prototype.learn(ShatterTraits),ImageDrawingBlock.prototype.recordMemory=function(){var a=ActorBlock.prototype.recordMemory.call(this);void 0==a.drawingCommands?a.drawingCommands=new Array:a.drawingCommands.splice(0,a.drawingCommands.length);for(var b=0;b<this.drawingCommands.length;b++)if(void 0==a.drawingCommands[b]&&(a.drawingCommands[b]=new Object),a.drawingCommands[b].command=this.drawingCommands[b].command,void 0!=this.drawingCommands[b].parameters){void 0==a.drawingCommands[b].parameters?a.drawingCommands[b].parameters=new Array:a.drawingCommands[b].parameters.splice(0,a.drawingCommands[b].parameters.length);for(var c=0;c<this.drawingCommands[b].parameters.length;c++)a.drawingCommands[b].parameters[c]=this.drawingCommands[b].parameters[c]}return a},ImageDrawingBlock.prototype.changeMemoryIntoReality=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.MEMORY,a),ActorBlock.prototype.changeMemoryIntoReality.call(this,a),this.drawingCommands=a.drawingCommands},ImageDrawingBlock.prototype.hasChangedFromLatestMemory=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BOOLEAN,a);var b=this.getLatestMemory(),c=!1;if(null!=b){b.drawingCommands!=this.drawingCommands&&(c=!0);for(var d=0;d<b.drawingCommands.length;d++){if(void 0==this.drawingCommands[d]){c=!0;break}if(this.drawingCommands[d].command!=b.drawingCommands[d].command){c=!0;break}if(null!=this.drawingCommands[d].parameters&&null!=b.drawingCommands[d].parameters&&this.drawingCommands[d].parameters.length!=b.drawingCommands[d].parameters.length){c=!0;break}if(null!=this.drawingCommands[d].parameters&&null!=b.drawingCommands[d].parameters)for(var e=0;e<this.drawingCommands[d].parameters.length;e++)if(this.drawingCommands[d].parameters[e]!=b.drawingCommands[d].parameters[e]){c=!0;break}}}else c=!0;return null==b?!0:a?c:ActorBlock.prototype.hasChangedFromLatestMemory.call(this)||c},ImageDrawingBlock.prototype.getCurrentFrame=function(){return this.drawingCommands.length>0&&this.canvasImage?this.canvasImage:null},ImageDrawingBlock.prototype.addDrawingCommand=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),b=PARAMS.validateParam(PARAMS.ARRAY,b),a.length>0){var c=new Object;c.command=a,c.parameters=b,this.drawingCommands.push(c)}},ImageDrawingBlock.prototype.addDrawingCommands=function(){PARAMS.initializeValidation(),PARAMS.validateArguments([PARAMS.REST,PARAMS.STRING,PARAMS.ARRAYOFOBJECT],arguments);for(var a=0;a<arguments.length;a+=2){var b=arguments[a],c=arguments[a+1];if(b.length>0){var d=new Object;d.command=b,d.parameters=c,this.drawingCommands.push(d)}}},ImageDrawingBlock.prototype.setDrawingCommands=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFOBJECT,a),this.clearDrawingCommands();for(var b=0;b<a.length;b++)this.drawingCommands.push(a[b])},ImageDrawingBlock.prototype.getDrawingCommands=function(){for(var a=new Array,b=0;b<this.drawingCommands.length;b++)if(void 0==a[b]&&(a[b]=new Object),a[b].command=this.drawingCommands[b].command,void 0!=this.drawingCommands[b].parameters){void 0==a[b].parameters&&(a[b].parameters=new Array);for(var c=0;c<this.drawingCommands[b].parameters.length;c++)a[b].parameters[c]=this.drawingCommands[b].parameters[c]}return a},ImageDrawingBlock.prototype.clearDrawingCommands=function(){this.drawingCommands.splice(0,this.drawingCommands.length)},ImageDrawingBlock.prototype.createDrawingData=function(){this.drawingCommands.length>0&&(CANVASMANAGER.workingCanvasFrame.context.save(),CANVASMANAGER.workingCanvasFrame.resize(this.width,this.height,-1),CANVASMANAGER.workingCanvasFrame.context.clearRect(0,0,this.width,this.height),this.parseCanvasCommands(CANVASMANAGER.workingCanvasFrame.context,this.drawingCommands),CANVASMANAGER.workingCanvasFrame.context.restore(),this.canvasImage.src=CANVASMANAGER.workingCanvasFrame.canvas.toDataURL())},ImageDrawingBlock.prototype.undraw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.clearRect(-this._getWidth()/2-1,-this._getHeight()/2-1,this._getWidth()+2,this._getHeight()+2),this.showDebugDisplay&&a.clearRect(-3,-3,6,6);for(var e=0;e<this.children.length;e++)this.children[e].undraw(a);a.restore()}}catch(f){LOG.write("error in ImageDrawingBlock.undraw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},ImageDrawingBlock.prototype.update=function(){ActorBlock.prototype.update.call(this),this.hasChangedFromLatestMemory(!0)&&this.createDrawingData(),this._setShattered(this.shattered)},ImageDrawingBlock.prototype.draw=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVAS2DCONTEXT,a);var b=0,c=0;try{if(this._getVisible()){var d=this.getZRatio();b=Math.round(-this._getWidth()/2+d*this._getX()),c=Math.round(-this._getHeight()/2+d*this._getY()),a.save(),a.translate(b+this._getWidth()/2,c+this._getHeight()/2),a.scale(d*this._getScaleX(),d*this._getScaleY()),a.rotate(this._getRotation()*Math.PI/180),this._getShattered()||a.drawImage(this.canvasImage,-this._getWidth()/2,-this._getHeight()/2),this.showDebugDisplay&&(a.save(),a.strokeStyle="Green",a.lineWidth=1,a.beginPath(),a.moveTo(0,0),a.lineTo(0,-this._getHeight()/2),a.stroke(),a.closePath(),a.fillStyle="Red",a.fillRect(-4,-4,8,8),a.beginPath(),a.strokeStyle="Blue",a.lineWidth=1,a.rect(-this._getWidth()/2,-this._getHeight()/2,this._getWidth(),this._getHeight()),a.stroke(),a.restore()),this.children.sort(function(a,b){return b.z-a.z});for(var e=0;e<this.children.length;e++)this.children[e].draw(a);a.restore()}}catch(f){LOG.write("error in ImageDrawingBlock.draw at: "+b+" "+c,LOG.ERROR),LOG.writeBlock(this,LOG.ERROR),LOG.writeObject(f,LOG.ERROR)}},ImageDrawingBlock.prototype.destroy=function(){this.isMarkedForDestruction&&(this.drawingCommands.splice(0,this.drawingCommands.length),this.drawingCommands=void 0,this.shattered=void 0,this._setShattered(void 0),delete this.canvasImage,this.canvasImage=void 0),ActorBlock.prototype.destroy.call(this)};var CanvasFrame=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),c=PARAMS.validateParam(PARAMS.INTEGER,c),LOG.write("CanvasFrame constructor called",LOG.VERBOSE),this.canvas=document.createElement("canvas"),this.canvas.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index:"+c),this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b),this.canvas.setAttribute("z-index",c),this.context=this.canvas.getContext("2d"),this.masterBlock=new ActorBlock,this.masterBlock.width=a,this.masterBlock.height=b,this.masterBlock.x=a/2,this.masterBlock.y=b/2,this.masterBlock.identity="MasterBlock"+c,this.shouldClearCanvas=!1};CanvasFrame.prototype.adoptBlockChild=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ACTORBLOCK,a),this.masterBlock.adoptChild(a)},CanvasFrame.prototype.addBehavior=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addBehavior(a,b,c)},CanvasFrame.prototype.addMouseOverReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addMouseOverReaction(a,b,c)},CanvasFrame.prototype.addMouseClickReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addMouseClickReaction(a,b,c)},CanvasFrame.prototype.addMouseDownReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addMouseDownReaction(a,b,c)},CanvasFrame.prototype.addMouseUpReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addMouseUpReaction(a,b,c)},CanvasFrame.prototype.addAnyKeyDownReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addAnyKeyDownReaction(a,b,c)},CanvasFrame.prototype.addAnyKeyUpReaction=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),b=PARAMS.validateParam(PARAMS.OBJECT,b),c=PARAMS.validateParam(PARAMS.BOOLEAN,c,!1),this.masterBlock.addAnyKeyUpReaction(a,b,c)},CanvasFrame.prototype.addKeyDownReaction=function(a,b,c,d){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c),d=PARAMS.validateParam(PARAMS.BOOLEAN,d,!1),this.masterBlock.addKeyDownReaction(a,b,c,d)},CanvasFrame.prototype.addKeyUpReaction=function(a,b,c,d){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c),d=PARAMS.validateParam(PARAMS.BOOLEAN,d,!1),this.masterBlock.addKeyUpReaction(a,b,c,d)},CanvasFrame.prototype.addKeyCombinationReaction=function(a,b,c,d){PARAMS.initializeValidation(),keyCode=PARAMS.validateParam(PARAMS.ARRAYOFINTEGER,keyCode),b=PARAMS.validateParam(PARAMS.FUNCTION,b),c=PARAMS.validateParam(PARAMS.OBJECT,c),d=PARAMS.validateParam(PARAMS.BOOLEAN,d,!1),this.masterBlock.addKeyCombinationReaction(a,b,c,d)},CanvasFrame.prototype.resize=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),c=PARAMS.validateParam(PARAMS.INTEGER,c),(a!=this.masterBlock.width||b!=this.masterBlock.height)&&(this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b),this.canvas.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index:"+c),this.context=this.canvas.getContext("2d"),this.masterBlock.width=a,this.masterBlock.height=b,this.shouldClearCanvas=!0)},CanvasFrame.prototype.clearCanvas=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasFrame.prototype.refresh=function(){this.shouldClearCanvas&&(this.clearCanvas(),this.shouldClearCanvas=!1),this.masterBlock.undraw(this.context),this.masterBlock.update(this.context),this.masterBlock.draw(this.context)};var CanvasManager=function(){LOG.write("CanvasManager constructor function called",LOG.VERBOSE);var a=this;this.width=0,this.height=0,this.identityNumber=0,this.startUpFunction=null,this.fov=75,this.frameRate=30,this.canvasFrameStack=new Array,this.mouseMoveEvent=new MouseEvent("MouseMoveEvent"),this.mouseClickEvent=new MouseEvent("MouseClickEvent"),this.mouseDownEvent=new MouseEvent("MouseDownEvent"),this.mouseUpEvent=new MouseEvent("MouseUpEvent"),this.keyboardEvent=new KeyboardEvent("KeyboardEvent"),window.onload=function(){LOG.write("Window loaded and ready for action. Window width: "+window.innerWidth+" Window height: "+window.innerHeight,LOG.VERBOSE),a.width=window.innerWidth,a.height=window.innerHeight,a.workingCanvasFrame=new CanvasFrame(a.width,a.height,-1);var b=new CanvasFrame(a.width,a.height,0);a.canvasFrameStack.push(b),document.body.appendChild(b.canvas),null!=a.startUpFunction&&a.startUpFunction()},window.onresize=function(){LOG.write("Window resize detected. width: "+window.innerWidth+" height: "+window.innerHeight,LOG.VERBOSE);var b=!1;if(a.isFixedWidth||(a.width=window.innerWidth,b=!0),a.isFixedHeight||(a.height=window.innerHeight,b=!0),b)for(var c=0;c<a.canvasFrameStack.length;c++)document.body.removeChild(a.canvasFrameStack[c].canvas),a.canvasFrameStack[c].resize(a.width,a.height,c),document.body.appendChild(a.canvasFrameStack[c].canvas),a.canvasFrameStack[c].masterBlock.x=a.width/2,a.canvasFrameStack[c].masterBlock.y=a.height/2},window.onmousemove=function(b){LOG.write("Mouse move detected. moveX:"+b.pageX+" moveY:"+b.pageY,LOG.VERBOSE),a.mouseMoveEvent.consumeEvent(Math.round(b.pageX),Math.round(b.pageY))},window.onclick=function(b){LOG.write("Mouse click detected. clickX:"+b.pageX+" clickY:"+b.pageY,LOG.VERBOSE),a.mouseClickEvent.fireEvent(Math.round(b.pageX),Math.round(b.pageY))},window.onmousedown=function(b){LOG.write("Mouse down detected. downX:"+b.pageX+" downY:"+b.pageY,LOG.VERBOSE),a.mouseDownEvent.fireEvent(Math.round(b.pageX),Math.round(b.pageY))},window.onmouseup=function(b){LOG.write("Mouse up detected. upX:"+b.pageX+" upY:"+b.pageY,LOG.VERBOSE),a.mouseUpEvent.fireEvent(Math.round(b.pageX),Math.round(b.pageY))},window.onkeypress=function(b){LOG.write("Key press detected. keycode:"+b.keyCode+" key:"+KEYCODES.getStringFromKeyCode(b.keyCode),LOG.VERBOSE),a.keyboardEvent.fireEvent(b.keyCode,a.keyboardEvent.KEYPRESSEVENT)},window.onkeydown=function(b){return LOG.write("Key down detected. keycode:"+b.keyCode+" key:"+KEYCODES.getStringFromKeyCode(b.keyCode),LOG.VERBOSE),a.keyboardEvent.fireEvent(b.keyCode,a.keyboardEvent.KEYDOWNEVENT),b.keyCode==KEYCODES.BACKSPACE?(a.keyboardEvent.fireEvent(b.keyCode,a.keyboardEvent.KEYPRESSEVENT),!1):void 0
},window.onkeyup=function(b){return LOG.write("Key up detected. keycode:"+b.keyCode+" key:"+KEYCODES.getStringFromKeyCode(b.keyCode),LOG.VERBOSE),a.keyboardEvent.fireEvent(b.keyCode,a.keyboardEvent.KEYUPEVENT),b.keyCode==KEYCODES.BACKSPACE?!1:void 0},this.assetManager=new AssetManager};CanvasManager.prototype.getIdentityNumber=function(){return this.identityNumber++},CanvasManager.prototype.setStartUpFunction=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.FUNCTION,a),this.startUpFunction=a},CanvasManager.prototype.addCanvasFrame=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVASFRAME,a);var b=this.canvasFrameStack.indexOf(a);b>-1&&(this.canvasFrameStack[b]=void 0,document.body.removeChild(a.canvas)),this.canvasFrameStack.push(a),document.body.appendChild(a.canvas)},CanvasManager.prototype.insertCanvasFrame=function(a,b){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.CANVASFRAME,a);var c=this.canvasFrameStack.indexOf(a);c>-1&&(this.canvasFrameStack[c]=void 0,document.body.removeChild(a.canvas)),this.canvasFrameStack[b]=a,document.body.appendChild(a.canvas)},CanvasManager.prototype.addNewCanvasFrame=function(){var a=new CanvasFrame(this.width,this.height,this.canvasFrameStack.length);this.canvasFrameStack.push(a),document.body.appendChild(a.canvas)},CanvasManager.prototype.adoptBlockChild=function(a,b){if(PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.BLOCK,a),b=PARAMS.validateParam(PARAMS.INTEGER,b),!this.canvasFrameStack[b]){var c=new CanvasFrame(this.width,this.height,b);this.insertCanvasFrame(c,b)}this.canvasFrameStack[b].adoptBlockChild(a)},CanvasManager.prototype.refreshAll=function(){this.mouseMoveEvent.fireEvent();for(var a=0;a<this.canvasFrameStack.length;a++)this.canvasFrameStack[a].refresh()},CanvasManager.prototype.start=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.INTEGER,a);var b=this;null!=a&&(this.frameRate=a),setInterval(function(){window.requestAnimationFrame(function(){b.refreshAll()})},1e3/this.frameRate)},CanvasManager.prototype.showVerboseMessages=function(){LOG.setLogThreshold(LOG.VERBOSE)},CanvasManager.prototype.showInfoMessages=function(){LOG.setLogThreshold(LOG.INFO)},CanvasManager.prototype.showWarningMessages=function(){LOG.setLogThreshold(LOG.WARN)},CanvasManager.prototype.showErrorMessages=function(){LOG.setLogThreshold(LOG.ERROR)},CanvasManager.prototype.showFatalMessages=function(){LOG.setLogThreshold(LOG.FATAL)},CanvasManager.prototype.showNoMessages=function(){LOG.setLogThreshold(LOG.NONE)},CanvasManager.prototype.loadAssets=function(a,b,c){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a,null),b=PARAMS.validateParam(PARAMS.STRING,b,null),c=PARAMS.validateParam(PARAMS.STRING,c,null),this.assetManager.loadAssets(a,b,c)},CanvasManager.prototype.getSingleImageAsset=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.assetManager.imageAssets[a].img},CanvasManager.prototype.getImageAssets=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFSTRING,a);for(var b=new Array,c=0;c<a.length;c++)b.push(this.assetManager.imageAssets[a[c]].img);return b},CanvasManager.prototype.getSingleImageAssetData=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.assetManager.imageAssets[a].imgdata},CanvasManager.prototype.getImageAssetData=function(a){PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.ARRAYOFSTRING,a);for(var b=new Array,c=0;c<a.length;c++)b.push(this.assetManager.imageAssets[a[c]].imgdata);return b},CanvasManager.prototype.getAudioAsset=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.assetManager.audioAssets[a].track},CanvasManager.prototype.getVideoAsset=function(a){return PARAMS.initializeValidation(),a=PARAMS.validateParam(PARAMS.STRING,a),this.assetManager.videoAssets[a].video};var CANVASMANAGER=new CanvasManager;